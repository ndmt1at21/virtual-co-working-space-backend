(()=>{"use strict";var e={650:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveTokenErrorMessages=void 0,t.ActiveTokenErrorMessages={INVALID_TOKEN:"Token is not valid or has expired. Please request a new one"}},495:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserToken=void 0;var c=r(5250),u=r(777),s=r(4614),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)({name:"user_id"}),a("design:type",Number)],t.prototype,"userId",void 0),i([(0,c.Column)({unique:!0}),a("design:type",String)],t.prototype,"token",void 0),i([(0,c.OneToOne)((function(){return s.User})),a("design:type",s.User)],t.prototype,"user",void 0),i([(0,c.Entity)({name:"active_user_token"}),(0,c.Index)(["token"],{unique:!0})],t)}(u.BaseEntity);t.ActiveUserToken=f},389:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createActiveUserTokenService=void 0;var n=r(5250),o=r(6476),i=r(8762);t.createActiveUserTokenService=function(){var e=(0,n.getCustomRepository)(o.ActiveUserTokenRepository);return(0,i.ActiveUserTokenService)(e)}},6476:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserTokenRepository=void 0;var u=r(5250),s=r(7325),f=r(495),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.findOne({where:{token:e}})];case 1:return[2,t.sent()]}}))}))},t.prototype.deleteByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder().delete().where("token = :token",{token:e}).execute()];case 1:return[2,t.sent().affected||0]}}))}))},t.prototype.findByUserIdAndToken=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.findOne({where:{userId:e,token:t}})];case 1:return[2,r.sent()]}}))}))},i([(0,u.EntityRepository)(f.ActiveUserToken)],t)}(s.BaseRepository);t.ActiveUserTokenRepository=l},8762:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserTokenService=void 0;var c=a(r(6113)),u=a(r(2275)),s=r(2720),f=r(650);t.ActiveUserTokenService=function(e){return{createToken:function(t){return o(void 0,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return r=c.default.randomBytes(u.default.auth.ACTIVE_USER_TOKEN_LENGTH).toString("hex"),[4,e.save({userId:t,token:r})];case 1:return o=i.sent(),[2,n({},o)]}}))}))},validateToken:function(t,r){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.findByUserIdAndToken(t,r)];case 1:if(!n.sent())throw new s.IllegalArgumentError(f.ActiveTokenErrorMessages.INVALID_TOKEN);return[2,!0]}}))}))},deleteToken:function(t){return o(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,e.deleteByToken(t)];case 1:return[2,r.sent()]}}))}))}}}},4925:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.socketServerLoader=t.httpServerLoader=t.mainAppLoaders=void 0;var i=r(3952),a=r(7886),c=r(8483),u=r(4188),s=r(5141),f=r(8309);t.mainAppLoaders=function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,(0,c.connectDatabase)()];case 1:return r.sent(),t.info("Database connection has been established successfully."),[4,(0,c.initDatabase)()];case 2:return r.sent(),t.info("Database has been initialized successfully."),[4,(0,s.createMessageQueues)()];case 3:return r.sent(),t.info("Message queues have been created successfully."),[4,(0,u.loadServices)()];case 4:return r.sent(),t.info("Services have been loaded successfully."),(0,u.loadBackgroundJobs)(),t.info("Background jobs have been loaded successfully."),(0,u.mainMiddleware)(e,t),t.info("Middleware has been loaded."),(0,u.mainRoutes)(e),t.info("Routes have been loaded."),e.use(a.globalErrorHandler),t.info("Global error handler has been loaded."),[2]}}))}))},t.httpServerLoader=function(e,t,r){return e.listen(t,(function(){r.info("Http server is listening on port ".concat(t))})),process.on("uncaughtException",(function(t){r.error("UNCAUGHT EXCEPTION: "+t.message),e.close((function(){process.exit(1)}))})),e},t.socketServerLoader=function(e,t){var r=new i.Server(e,{cors:{origin:["http://localhost:3000","https://vispace.tech"]},transports:["polling","websocket"],path:"/socket.io"});return t.info("Socket server is initialized."),(0,f.socketEventHandlers)(r),t.info("Socket event handlers has been loaded."),r}},366:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createCacheConnection=t.getCacheConnection=void 0;var i=r(7558),a={};function c(e,t){return n(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,(r=(0,i.createClient)(t)).connect()];case 1:return n.sent(),a[e]=r,r.on("error",(function(e){throw e})),r.on("connect",(function(){a[e]=r})),[2,r]}}))}))}t.getCacheConnection=function(e){var t=a[e];if(!t)throw new Error("Cache connection not found");return t},t.createCacheConnection=function(e){return n(void 0,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return t=e.map((function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,c(e.connName,e.options)];case 1:return t.sent(),[2]}}))}))})),[4,Promise.all(t)];case 1:return r.sent(),[2]}}))}))}},8483:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectDatabase=void 0;var u=c(r(2275)),s=r(495),f=r(1993),l=r(2965),d=r(5970),p=r(1230),h=r(1500),v=r(4843),y=r(3134),b=r(3669),_=r(4614),m=r(5250),w=r(366),O=r(478),g={type:"postgres",host:u.default.db.pg.DB_HOST,port:u.default.db.pg.DB_PORT,username:u.default.db.pg.DB_USERNAME,password:u.default.db.pg.DB_PASSWORD,database:u.default.db.pg.DB_NAME,dropSchema:!1,synchronize:!0,entities:[_.User,b.RefreshToken,s.ActiveUserToken,y.PasswordResetToken,f.Item,v.Office,l.OfficeItem,d.OfficeMember,h.OfficeRole,p.OfficeMemberTransform,O.OfficeMemberRole]},E=(u.default.db.mongo.DB_HOST,u.default.db.mongo.DB_PORT,u.default.db.mongo.DB_USERNAME,u.default.db.mongo.DB_PASSWORD,u.default.db.mongo.DB_NAME,{connName:"officeMemberTransform",options:{socket:{port:6379,host:"localhost"}}}),R={connName:"mail",options:{socket:{port:6380,host:"localhost"}}},I={connName:"officeMember",options:{socket:{port:6381,host:"localhost"}}};t.connectDatabase=function(){return i(void 0,void 0,void 0,(function(){return a(this,(function(e){return[2,new Promise((function(e,t){return i(void 0,void 0,void 0,(function(){var r;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,(0,m.createConnection)(g)];case 1:return n.sent(),[4,(0,w.createCacheConnection)([E,R,I])];case 2:return n.sent(),e(),[3,4];case 3:return r=n.sent(),t("Unable to connect to database: "+r.message),[3,4];case 4:return[2]}}))}))}))]}))}))},o(r(5370),t)},5370:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.initDatabase=void 0;var i=r(3913),a=r(5250);t.initDatabase=function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,a.getCustomRepository)(i.OfficeRoleRepository).save([{name:"OWNER"},{name:"ADMIN"},{name:"MEMBER"}])];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))}},4188:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadServices=t.loadBackgroundJobs=t.mainRoutes=t.mainMiddleware=void 0;var n=r(2494);Object.defineProperty(t,"mainMiddleware",{enumerable:!0,get:function(){return n.mainMiddleware}});var o=r(2435);Object.defineProperty(t,"mainRoutes",{enumerable:!0,get:function(){return o.mainRoutes}});var i=r(5074);Object.defineProperty(t,"loadBackgroundJobs",{enumerable:!0,get:function(){return i.loadBackgroundJobs}});var a=r(1567);Object.defineProperty(t,"loadServices",{enumerable:!0,get:function(){return a.loadServices}})},5074:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadBackgroundJobs=void 0;var n=r(3574);t.loadBackgroundJobs=function(){(0,n.loadAuthBackgroundJobs)()}},2494:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mainMiddleware=void 0;var o=n(r(3582)),i=n(r(7806)),a=n(r(9470)),c=n(r(6860)),u=r(206),s=r(4420);t.mainMiddleware=function(e,t){var r="production"===u.appConfig.NODE_ENV;e.use(c.default.json()),e.use(c.default.urlencoded({extended:!0})),e.use(c.default.static("public")),e.use((0,s.rateLimiting)({maxPerIp:50,timeMs:1e4})),e.use((0,i.default)({contentSecurityPolicy:r,crossOriginEmbedderPolicy:r})),e.use((0,o.default)({origin:["http://localhost:3000","https://vispace.tech"],credentials:!0,exposedHeaders:["x-total-count","x-refresh-token","x-access-token"]})),e.use((0,a.default)(':remote-addr - :remote-user ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent" - :response-time ms',{stream:{write:function(e){return t.info(e)}}}))}},2435:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mainRoutes=void 0;var n=r(4860),o=r(6146),i=r(2067),a=r(1747),c=r(9817),u=r(7114),s=r(6571);t.mainRoutes=function(e){var t="/api/v1",r=(0,n.AuthRouter)(),f=(0,o.UserRouter)(),l=(0,i.ItemRouter)(),d=(0,a.OfficeRouter)(),p=(0,c.OfficeItemRouter)(),h=(0,u.OfficeMemberRouter)(),v=(0,s.CloudUploadRouter)();e.use("".concat(t,"/auth"),r),e.use("".concat(t,"/users"),f),e.use("".concat(t,"/items"),l),e.use("".concat(t,"/offices"),d),e.use("".concat(t,"/office-items"),p),e.use("".concat(t,"/office-members"),h),e.use("".concat(t,"/uploads"),v)}},1567:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadServices=void 0;var i=r(1186),a=r(1876);function c(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,(0,a.createMailService)().initialize()];case 1:return e.sent(),[2]}}))}))}function u(){return n(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,(0,i.createCloudUploadService)().initialize()];case 1:return e.sent(),[2]}}))}))}t.loadServices=function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,c()];case 1:return e.sent(),[4,u()];case 2:return e.sent(),[2]}}))}))}},5141:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageQueues=void 0;var i=r(247),a={queueName:"auth_mail",options:{redis:{host:"localhost",port:6379}}};t.createMessageQueues=function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){return(0,i.createQueues)([a]),[2]}))}))}},247:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createQueues=t.getQueue=void 0;var a=i(r(7068)),c={};t.getQueue=function(e){var t=c[e];if(!t)throw new Error("Queue not found");return t},t.createQueues=function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){return e.forEach((function(e){return n(void 0,void 0,void 0,(function(){var t,r,n;return o(this,(function(o){return t=e.queueName,r=e.options,n=function(e,t){return new a.default(e,t)}(t,r),c[t]=n,[2]}))}))})),[2]}))}))}},8309:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketEventHandlers=t.socketMiddleware=void 0;var n=r(8801);Object.defineProperty(t,"socketMiddleware",{enumerable:!0,get:function(){return n.socketMiddleware}});var o=r(8084);Object.defineProperty(t,"socketEventHandlers",{enumerable:!0,get:function(){return o.socketEventHandlers}})},8084:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketEventHandlers=void 0;var n=r(1689),o=r(4903);t.socketEventHandlers=function(e){var t=(0,n.createSocketMiddleware)();e.use(t.protect),e.on("connection",(function(t){(0,o.createOfficeSocketHandler)(e,t)}))}},8801:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketMiddleware=void 0;var n=r(1689);t.socketMiddleware=function(e,t){var r=(0,n.createSocketMiddleware)();e.use(r.protect)}},4420:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.rateLimiting=void 0;var i=r(2720),a=r(7558),c=r(6970),u=(0,a.createClient)();function s(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){return[2,u.incr(e)]}))}))}function f(e,t){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,u.expire(e,t/1e3)]}))}))}u.connect(),u.on("connect",(function(){return console.log("Redis for rate limiting is connected")})),u.on("error",(function(e){return console.log("Redis for rate limiting error: ",e)})),t.rateLimiting=function(e){var t=e.timeMs,r=e.maxPerIp;return u.flushAll(),function(e,a,u){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return[4,s(n=e.connection.remoteAddress||e.headers["x-forward-for"]||"127.0.0.1")];case 1:return 1!==(a=o.sent())?[3,3]:[4,f(n,t)];case 2:o.sent(),o.label=3;case 3:return a>r?[2,u(new i.TooManyRequestError(c.RateLimitErrorMessages.RATE_LIMIT_EXCEEDED))]:(u(),[2])}}))}))}}},6970:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RateLimitErrorMessages=void 0,t.RateLimitErrorMessages={RATE_LIMIT_EXCEEDED:"Too many requests. Please try again later."}},9124:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ForgotPasswordDto=void 0;var i=r(136),a=r(5849),c=r(1204),u=function(){function e(){}return n([(0,a.IsDefined)({message:c.AuthErrorMessages.LOGIN_MISSING_EMAIL_PASSWORD}),(0,a.IsEmail)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"email",void 0),e}();t.ForgotPasswordDto=u},8134:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,a.IsDefined)(),(0,a.IsEmail)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"email",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"password",void 0),e}();t.LoginDto=c},6833:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,a.IsDefined)(),(0,i.Expose)(),(0,a.Length)(1,255),o("design:type",String)],e.prototype,"name",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),(0,a.IsEmail)(),o("design:type",String)],e.prototype,"email",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),(0,a.MinLength)(8,{message:"Password must have minimum eight characters"}),(0,a.Matches)(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[`~.,_=+@$!%*?&])[A-Za-z\d`~.,_=+@$!%*?&]{8,}$/,{message:"Password must have at least one uppercase letter, one lowercase letter, one number and one special character"}),o("design:type",String)],e.prototype,"password",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"passwordConfirm",void 0),e}();t.RegisterDto=c},3136:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ResetPasswordContentDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,a.IsDefined)(),(0,i.Expose)(),(0,a.Matches)(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[`~.,_=+@$!%*?&])[A-Za-z\d`~.,_=+@$!%*?&]{8,}$/,{message:"Password must have at least one uppercase letter, one lowercase letter, one number and one special character"}),o("design:type",String)],e.prototype,"password",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"confirmPassword",void 0),e}();t.ResetPasswordContentDto=c},3204:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthRouter=void 0;var n=r(6860),o=r(7242),i=r(6901);t.AuthRouter=function(){var e=(0,i.createAuthController)(),t=(0,i.createAuthMiddleware)(),r=t.restrictToGuest,a=t.protect;(0,o.loadStrategies)();var c=(0,n.Router)();return c.post("/login",r,e.localLogin).post("/register",r,e.localRegister).get("/google",r,e.googleLogin).get("/facebook",r,e.facebookLogin).get("/google/callback",r,e.googleLoginCallback).get("/facebook/callback",r,e.facebookLoginCallback).post("/forgot",r,e.forgotPassword).patch("/reset/:token",r,e.resetPassword).post("/refreshToken",r,e.refreshAccessToken),c.get("/activate/:token",a,e.activateNewUser).get("/logout",a,e.logout),c}},7579:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;var c=a(r(3511)),u=a(r(2275)),s=a(r(9103)),f=r(7500),l=r(1204),d=r(2720),p=r(3015),h=r(6775),v=r(5718),y=r(8134),b=r(3136),_=r(9124),m=r(6833);t.AuthController=function(e,t,r){function a(e,n,o,i){c.default.authenticate(e,{session:!1},(function(n,a,c,f){n&&(r.error("Authenticating external user with provider ".concat(e," failed. Message ").concat(n.message)),i(n));var p=a;if(!p)throw r.error("Invalid external user information. Message ".concat(n.message)),new d.UnauthorizedError(l.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EXTERNAL);t.oauth2LoginCallback(p).then((function(t){var n=t[0],i=t[1],a=i.accessToken,c=i.refreshToken,f=s.default.stringifyUrl({url:u.default.auth.BASE_FRONTEND_URL,query:{access_token:a,refresh_token:c}});r.info("User with id ".concat(n.id," logged in (oauth2, provider: ").concat(e,") successfully")),o.redirect(f)})).catch((function(t){var n=s.default.stringifyUrl({url:u.default.auth.BASE_FRONTEND_URL,query:{error:t.message.toLowerCase()}});r.error("User with id ".concat(a.id," logged in (oauth2, provider: ").concat(e,") failed. Message: ").concat(t.message)),o.redirect(n)}))}))(n,o,i)}return{localLogin:(0,p.catchAsyncRequestHandler)((function(e,n,a){return o(void 0,void 0,void 0,(function(){var o,a,c,u,s,l,p;return i(this,(function(i){switch(i.label){case 0:return[4,(0,v.validateRequestBody)(y.LoginDto,e.body)];case 1:if((o=i.sent()).length>0)throw r.error("User cannot login: ".concat(o)),new d.IllegalArgumentError("Invalid login data",o);return a=e.body,[4,t.localLogin(a)];case 2:return c=i.sent(),u=c[0],s=c[1],l=s.accessToken,p=s.refreshToken,r.info("User with id ".concat(u.id," logged in successfully")),n.status(f.HttpStatusCode.OK).json({user:u,accessToken:l,refreshToken:p}),[2]}}))}))})),localRegister:(0,p.catchAsyncRequestHandler)((function(n,a,c){return o(void 0,void 0,void 0,(function(){var o,c,u,s,l;return i(this,(function(i){switch(i.label){case 0:return[4,(0,v.validateRequestBody)(m.RegisterDto,n.body)];case 1:if((o=i.sent()).length>0)throw r.error("User create login: ".concat(o)),new d.IllegalArgumentError("Invalid register data",o);return c=n.body,[4,t.localRegister(c)];case 2:return u=i.sent(),s=u.user,l=u.activeToken,r.info("User with email ".concat(s.email," registered successfully has id ").concat(s.id)),e.addRegisterConfirmationJob(s,l),a.status(f.HttpStatusCode.CREATED).json({user:s,message:"User created successfully"}),[2]}}))}))})),googleLogin:(0,p.catchAsyncRequestHandler)((function(e,t,n){return o(void 0,void 0,void 0,(function(){return i(this,(function(o){return c.default.authenticate("google",{session:!1,scope:["email","profile"]})(e,t,n),r.info("Success redirect to google login page"),[2]}))}))})),facebookLogin:(0,p.catchAsyncRequestHandler)((function(e,t,n){return o(void 0,void 0,void 0,(function(){return i(this,(function(o){return c.default.authenticate("facebook",{session:!1,scope:["email","public_profile"]})(e,t,n),r.info("Success redirect to facebook login page"),[2]}))}))})),googleLoginCallback:(0,p.catchAsyncRequestHandler)((function(e,t,r){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){return a("google",e,t,r),[2]}))}))})),facebookLoginCallback:(0,p.catchAsyncRequestHandler)((function(e,t,r){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){return a("facebook",e,t,r),[2]}))}))})),logout:(0,p.catchAsyncRequestHandler)((function(e,n,a){return o(void 0,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:if(!(o=e.headers[h.HeaderConstants.REFRESH_TOKEN]))throw r.error("Cannot logout: missing refresh token"),new d.IllegalArgumentError(l.AuthErrorMessages.LOGOUT_MISSING_REFRESH_TOKEN);return[4,t.logout(o)];case 1:return i.sent(),n.status(f.HttpStatusCode.OK).json({message:"User logged out successfully"}),[2]}}))}))})),refreshAccessToken:(0,p.catchAsyncRequestHandler)((function(e,n,a){return o(void 0,void 0,void 0,(function(){var o,a,c,u,s;return i(this,(function(i){switch(i.label){case 0:if(!(o=e.headers[h.HeaderConstants.REFRESH_TOKEN]))throw r.error("Cannot refresh access token: missing refresh token"),new d.IllegalArgumentError(l.AuthErrorMessages.REFRESH_ACCESS_TOKEN_MISSING_REFRESH_TOKEN);return a=e.user.id,[4,t.refreshAccessToken(a,o)];case 1:return c=i.sent(),u=c.accessToken,s=c.refreshToken,n.status(f.HttpStatusCode.OK).json({message:"Access token renew successfully",accessToken:u,refreshToken:s}),[2]}}))}))})),forgotPassword:(0,p.catchAsyncRequestHandler)((function(n,a,c){return o(void 0,void 0,void 0,(function(){var o,c,u;return i(this,(function(i){switch(i.label){case 0:return[4,(0,v.validateRequestBody)(_.ForgotPasswordDto,n.body)];case 1:if((o=i.sent()).length>0)throw r.error("Cannot reset password: ".concat(o)),new d.IllegalArgumentError("Invalid forgot password request",o);return c=n.body,[4,t.forgotPassword(c)];case 2:return u=i.sent(),r.info("Reset password token sent to email ".concat(c.email)),e.addResetPasswordMailJob(c.email,u.passwordResetToken),a.status(f.HttpStatusCode.OK).json({message:"Password reset token created successfully"}),[2]}}))}))})),resetPassword:(0,p.catchAsyncRequestHandler)((function(e,a,c){return o(void 0,void 0,void 0,(function(){var o,c,u;return i(this,(function(i){switch(i.label){case 0:if(!(o=e.params.token))throw r.error("Cannot reset password: missing reset token"),new d.IllegalArgumentError(l.AuthErrorMessages.RESET_PASSWORD_MISSING_RESET_TOKEN);return[4,(0,v.validateRequestBody)(b.ResetPasswordContentDto,e.body)];case 1:if((c=i.sent()).length>0)throw r.error("Cannot reset password: ".concat(c)),new d.IllegalArgumentError("Invalid reset password request",c);return u=e.body,[4,t.resetPassword(n({resetToken:o},u))];case 2:return i.sent(),a.status(f.HttpStatusCode.OK).json({message:"Password reset successfully"}),[2]}}))}))})),activateNewUser:(0,p.catchAsyncRequestHandler)((function(e,r,n){return o(void 0,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=e.user.id,o=e.params.token,[4,t.activeNewUser(n,o)];case 1:return i.sent(),r.status(f.HttpStatusCode.OK).json({message:"User activated successfully"}),[2]}}))}))}))}}},1204:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthErrorMessages=void 0,t.AuthErrorMessages={UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD:"Your email or password were incorrect",UNAUTHORIZED_INCORRECT_EXTERNAL:"Your external login was incorrect",UNAUTHORIZED_USER_BLOCKED:"User is blocked",UNAUTHORIZED_USER_NOT_FOUND:"User not found",UNAUTHORIZED_MISSING_TOKEN:"Access token is required",UNAUTHORIZED_INVALID_TOKEN:"Access token has expired or is not yet valid",UNAUTHORIZED_ALREADY_LOGGED_IN:"You are already logged in",UNAUTHORIZED_PERMISSION_DENIED:"You do not have permission to access this resource",UNAUTHORIZED_EMAIL_NOT_VERIFIED:"Email is not verified",LOGIN_MISSING_EMAIL_PASSWORD:"Email and password are required",LOGIN_EXTERNAL_MISSING_EMAIL:"Email is required",LOGIN_EXTERNAL_USER_NOT_FOUND:"User not found",REGISTER_MISSING_EMAIL:"Email is required for registration",REGISTER_MISSING_DISPLAY_NAME:"Email is required for registration",REGISTER_MISSING_PASSWORD_OR_CONFIRM_PASSWORD:"Password and confirm password are required for registration",REGISTER_MISMATCH_CONFIRM_PASSWORD:"Password and confirm password must match",FORGOT_PASSWORD_MISSING_EMAIL:"Email is required for forgot password",RESET_PASSWORD_MISSING_RESET_TOKEN:"Reset token is required for password reset",RESET_PASSWORD_MISSING_PASSWORD_OR_CONFIRM_PASSWORD:"Password and confirm password are required for password reset",RESET_PASSWORD_MISMATCH:"Password and confirm password must match",RESET_PASSWORD_TOKEN_EXPIRED:"Reset token has expired",RESET_PASSWORD_TOKEN_INVALID:"Reset token is invalid",LOGOUT_MISSING_REFRESH_TOKEN:"Refresh token is required for logout",REFRESH_ACCESS_TOKEN_MISSING_REFRESH_TOKEN:"Refresh token is required for renew access token"}},6901:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthMailQueue=t.createAuthMailQueueProducer=t.createAuthMailWorker=t.createAuthValidate=t.createAuthMiddleware=t.createAuthService=t.createAuthController=void 0;var n=r(3241),o=r(7767),i=r(6586),a=r(7579),c=r(5658),u=r(305),s=r(9640),f=r(1538),l=r(389),d=r(5703),p=r(247),h=r(1876),v=r(8888);function y(){var e=(0,i.createUserService)(),t=(0,f.createPasswordResetTokenService)(),r=(0,n.createAuthTokenService)(),o=(0,l.createActiveUserTokenService)(),a=b();return(0,u.AuthService)(e,r,t,o,a)}function b(){var e=(0,i.createUserRepository)();return(0,s.AuthValidate)(e)}function _(){var e=m();return(0,d.AuthMailQueueProducer)(e)}function m(){return(0,p.getQueue)("auth_mail")}t.createAuthController=function(){var e=y(),t=_();return(0,a.AuthController)(t,e,o.authLogger)},t.createAuthService=y,t.createAuthMiddleware=function(){var e=(0,i.createUserRepository)(),t=(0,n.createAuthTokenService)(),r=b();return(0,c.AuthMiddleware)(e,t,r)},t.createAuthValidate=b,t.createAuthMailWorker=function(){var e=m(),t=(0,h.createMailService)(),r=o.authLogger;return(0,v.AuthMailWorker)(e,t,r)},t.createAuthMailQueueProducer=_,t.createAuthMailQueue=m},3574:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadAuthBackgroundJobs=void 0;var n=r(6901);t.loadAuthBackgroundJobs=function(){(0,n.createAuthMailWorker)().load()}},5658:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMiddleware=void 0;var i=r(3015),a=r(1204),c=r(2720),u=r(6648);t.AuthMiddleware=function(e,t,r){function s(i){return n(this,void 0,void 0,(function(){var n,u;return o(this,(function(o){switch(o.label){case 0:return[4,t.validateAccessToken(i)];case 1:return o.sent(),[4,t.getUserIdFromAccessToken(i)];case 2:return n=o.sent(),[4,r.validateUserCanAccessResourceById(n)];case 3:return o.sent(),[4,e.findById(n)];case 4:if(!(u=o.sent()))throw new c.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_USER_NOT_FOUND);return[2,u]}}))}))}return{protect:(0,i.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){var t,n,i,f,l,d,p;return o(this,(function(o){switch(o.label){case 0:if(!(t=null===(p=e.headers.authorization)||void 0===p?void 0:p.split(" ")[1]))throw new c.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_MISSING_TOKEN);return[4,s(t)];case 1:return n=o.sent(),i=n.id,f=n.type,l=n.email,d=n.status,e.user={id:i,roles:[f],email:l,emailVerified:d===u.UserStatus.INACTIVE},r(),[2]}}))}))})),restrictTo:function(e){return function(t,r,n){var o=e.every((function(e){var r;return null===(r=t.user)||void 0===r?void 0:r.roles.includes(e)}));o&&n(),o||n(new c.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_PERMISSION_DENIED))}},restrictToGuest:(0,i.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){var t,n;return o(this,(function(o){switch(o.label){case 0:if(!(t=null===(n=e.headers.authorization)||void 0===n?void 0:n.split(" ")[1])||"null"===t||"undefined"===t)return r(),[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s(t)];case 2:if(o.sent())throw new c.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_ALREADY_LOGGED_IN);return[3,4];case 3:return o.sent(),r(),[3,4];case 4:return[2]}}))}))})),restrictToEmailVerified:(0,i.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){var t;return o(this,(function(r){if(!(null===(t=e.user)||void 0===t?void 0:t.emailVerified))throw new c.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_EMAIL_NOT_VERIFIED);return[2]}))}))}))}}},305:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0,t.AuthService=function(e,t,o,i,a){function c(t){return r(this,void 0,void 0,(function(){var r,o,i,a,c,u;return n(this,(function(n){switch(n.label){case 0:return r=t.profileId,o=t.email,i=t.provider,a=t.name,c=t.avatar,u=t.phone,[4,e.findOrCreateUserByExternal({externalId:r,email:o,provider:i,name:a,avatar:c,phone:u})];case 1:return[2,n.sent()]}}))}))}return{localLogin:function(o){return r(void 0,void 0,void 0,(function(){var r,i,c,u;return n(this,(function(n){switch(n.label){case 0:return[4,a.validateLocalUserCanLogin(o)];case 1:return n.sent(),[4,e.findUserByEmail(o.email)];case 2:return r=n.sent(),[4,t.createAccessTokenAndRefreshToken(r.id)];case 3:return i=n.sent(),c=i[0],u=i[1],[2,[r,{accessToken:c,refreshToken:u}]]}}))}))},oauth2LoginCallback:function(e){return r(void 0,void 0,void 0,(function(){var r,o,i,u;return n(this,(function(n){switch(n.label){case 0:return[4,a.validateExternalUserCanLogin(e)];case 1:return n.sent(),[4,c(e)];case 2:return r=n.sent(),[4,t.createAccessTokenAndRefreshToken(r.id)];case 3:return o=n.sent(),i=o[0],u=o[1],[2,[r,{accessToken:i,refreshToken:u}]]}}))}))},localRegister:function(t){return r(void 0,void 0,void 0,(function(){var r,o;return n(this,(function(n){switch(n.label){case 0:return[4,e.createLocalUser(t)];case 1:return r=n.sent(),[4,i.createToken(r.id)];case 2:return o=n.sent().token,[2,{user:r,activeToken:o}]}}))}))},refreshAccessToken:function(e,o){return r(void 0,void 0,void 0,(function(){var r,i,a;return n(this,(function(n){switch(n.label){case 0:return[4,t.validateRefreshTokenCanRenewAccessToken(e,o)];case 1:return n.sent(),[4,t.blockRefreshToken(o)];case 2:return n.sent(),[4,t.createAccessTokenAndRefreshToken(e)];case 3:return r=n.sent(),i=r[0],a=r[1],[2,{accessToken:i,refreshToken:a}]}}))}))},logout:function(e){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,t.deleteRefreshToken(e)];case 1:return r.sent(),[2]}}))}))},forgotPassword:function(t){return r(void 0,void 0,void 0,(function(){var r,i;return n(this,(function(n){switch(n.label){case 0:return r=t.email,[4,a.validateUserForgotPassword(r)];case 1:return n.sent(),[4,e.findUserByEmail(r)];case 2:return i=n.sent(),[4,o.createToken(i.id)];case 3:return[2,n.sent()]}}))}))},resetPassword:function(t){return r(void 0,void 0,void 0,(function(){var r,i,a,c,u;return n(this,(function(n){switch(n.label){case 0:return r=t.resetToken,i=t.password,a=t.confirmPassword,[4,o.validateToken(r)];case 1:return n.sent(),[4,o.findByToken(r)];case 2:return c=n.sent(),[4,e.findUserById(c.userId)];case 3:return u=n.sent(),[4,e.updatePasswordById(u.id,{password:i,confirmPassword:a})];case 4:return n.sent(),[4,o.deleteByUserId(u.id)];case 5:return n.sent(),[2]}}))}))},activeNewUser:function(t,o){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,i.validateToken(t,o)];case 1:return r.sent(),[4,e.activeNewUser(t)];case 2:return r.sent(),[4,i.deleteToken(o)];case 3:return r.sent(),[2]}}))}))}}}},7242:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadStrategies=void 0;var o=n(r(3511)),i=n(r(2275)),a=r(8117),c=r(3210),u=r(6237),s=r(1204);t.loadStrategies=function(){var e;e=new a.Strategy({callbackURL:"/api/v1/auth/google/callback",clientID:i.default.auth.GOOGLE_CLIENT_ID,clientSecret:i.default.auth.GOOGLE_CLIENT_SECRET},(function(e,t,r,n){return 0===r.emails.length?n(s.AuthErrorMessages.LOGIN_EXTERNAL_USER_NOT_FOUND,null):n(null,{email:r.emails[0],avatar:r.picture,profileId:r.id,phone:r.phone,name:r.displayName,provider:u.UserLoginProvider.GOOGLE})})),o.default.use("google",e),function(){var e=new c.Strategy({callbackURL:"/api/v1/auth/facebook/callback",clientID:i.default.auth.FACEBOOK_CLIENT_ID,clientSecret:i.default.auth.FACEBOOK_CLIENT_SECRET,profileFields:["id","email","displayName","name","photos"]},(function(e,t,r,n){return 0===r.emails.length?n(s.AuthErrorMessages.LOGIN_EXTERNAL_USER_NOT_FOUND,null):n(null,{email:r.emails[0].value,avatar:r.photos[0].value,profileId:r.id,phone:r.phone,name:r.displayName,provider:u.UserLoginProvider.FACEBOOK})}));o.default.use("facebook",e)}()}},9640:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthValidate=void 0;var i=r(2720),a=r(7096),c=r(6237),u=r(6648),s=r(1204),f=r(2148);t.AuthValidate=function(e){function t(e){if(!e)throw new i.UnauthorizedError(f.UserErrorMessage.USER_NOT_FOUND)}function r(e,t){if(e.provider!==t)throw new i.UnauthorizedError(s.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD)}function l(e){if(e.status===u.UserStatus.BLOCKED)throw new i.UnauthorizedError(s.AuthErrorMessages.UNAUTHORIZED_USER_BLOCKED)}return{validateLocalUserCanLogin:function(u){return n(void 0,void 0,void 0,(function(){var n,f,d;return o(this,(function(o){switch(o.label){case 0:return n=u.email,f=u.password,[4,e.findUserByEmail(n)];case 1:return t(d=o.sent()),r(d,c.UserLoginProvider.LOCAL),l(d),function(e,t){if(!(0,a.compareSync)(t,e.password))throw new i.UnauthorizedError(s.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD)}(d,f),[2,!0]}}))}))},validateExternalUserCanLogin:function(t){return n(void 0,void 0,void 0,(function(){var n,i,a;return o(this,(function(o){switch(o.label){case 0:return n=t.email,i=t.provider,[4,e.findUserByEmail(n)];case 1:return(a=o.sent())&&(r(a,i),l(a)),[2,!0]}}))}))},validateUserCanAccessResourceById:function(r){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,e.findById(r)];case 1:return t(n=o.sent()),l(n),[2,!0]}}))}))},validateUserForgotPassword:function(r){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,e.findUserByEmail(r)];case 1:return t(n=o.sent()),l(n),[2,!0]}}))}))}}}},4860:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(3204),t)},5703:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMailQueueProducer=void 0,t.AuthMailQueueProducer=function(e){return{addRegisterConfirmationJob:function(t,r){e.add("auth_register_activate",{user:t,activeToken:r})},addResetPasswordMailJob:function(t,r){e.add("auth_reset_password",{email:t,resetToken:r})}}}},8888:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMailWorker=void 0;var a=i(r(1017)),c=i(r(2275));t.AuthMailWorker=function(e,t,r){return{load:function(){!function(){var i=this;e.process("auth_register_activate",10,(function(e){return n(i,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:if(n=e.data.user,i=e.data.activeToken,!n||!i)throw new Error("User or active token is undefined");return r.info("Start sending activation link to email: ".concat(n.email)),[4,t.sendMail({from:"ViSpace <noreply@authentication.vispace.tech>",to:n.email,subject:"Welcome to our app",templateUrl:a.default.resolve("src/components/mailTemplates/accountActivate.html"),context:{activationUrl:"".concat(c.default.app.SERVER_DOMAIN,"/auth/activate/").concat(i),receiver:"".concat(n.name)}})];case 1:return o.sent(),r.info("Activation link sent to email: ".concat(n.email," successfully")),[2]}}))}))}))}(),function(){var i=this;e.process("auth_reset_password",10,(function(e){return n(i,void 0,void 0,(function(){var n,i,u;return o(this,(function(o){switch(o.label){case 0:return n=e.data,i=n.email,u=n.resetToken,r.info("Start sending reset password link to email: ".concat(i)),[4,t.sendMail({from:"ViSpace <noreply@authentication.vispace.tech>",to:i,subject:"Reset password",templateUrl:a.default.resolve("src/components/mailTemplates/resetPassword.html"),context:{resetPasswordUrl:"".concat(c.default.app.SERVER_DOMAIN,"/auth/reset/").concat(u)}})];case 1:return o.sent(),r.info("Reset password link sent to email: ".concat(i," successfully")),[2]}}))}))}))}()}}}},1689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSocketMiddleware=void 0;var n=r(6901),o=r(3241),i=r(6586),a=r(2578);t.createSocketMiddleware=function(){var e=(0,i.createUserRepository)(),t=(0,o.createAuthTokenService)(),r=(0,n.createAuthValidate)();return(0,a.AuthSocketMiddleware)(e,t,r)}},2578:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthSocketMiddleware=void 0;var i=r(1204),a=r(5021),c=r(2720);t.AuthSocketMiddleware=function(e,t,r){function u(a){return n(this,void 0,void 0,(function(){var n,u;return o(this,(function(o){switch(o.label){case 0:return[4,t.validateAccessToken(a)];case 1:return o.sent(),[4,t.getUserIdFromAccessToken(a)];case 2:return n=o.sent(),[4,r.validateUserCanAccessResourceById(n)];case 3:return o.sent(),[4,e.findById(n)];case 4:if(!(u=o.sent()))throw new c.UnauthorizedError(i.AuthErrorMessages.UNAUTHORIZED_USER_NOT_FOUND);return[2,u]}}))}))}return{protect:(0,a.catchAsyncSocketMiddleware)((function(e,t){return n(void 0,void 0,void 0,(function(){var r,n,a,s,f;return o(this,(function(o){switch(o.label){case 0:if(!(r=e.handshake.auth.accessToken))throw new c.UnauthorizedError(i.AuthErrorMessages.UNAUTHORIZED_MISSING_TOKEN);return[4,u(r)];case 1:return n=o.sent(),a=n.id,s=n.type,f=n.email,e.user={id:a,email:f,roles:[s]},t(),[2]}}))}))})),restrictTo:function(e){return(0,a.catchAsyncSocketMiddleware)((function(t,r){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){if(n=e.every((function(e){var r;return null===(r=t.user)||void 0===r?void 0:r.roles.includes(e)})),n&&r(),!n)throw new Error(i.AuthErrorMessages.UNAUTHORIZED_PERMISSION_DENIED);return[2]}))}))}))},restrictToGuest:(0,a.catchAsyncSocketMiddleware)((function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){if(e.user)throw new Error(i.AuthErrorMessages.UNAUTHORIZED_ALREADY_LOGGED_IN);return e.user||t(),[2]}))}))}))}}},8999:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenErrorMessages=void 0,t.AuthTokenErrorMessages={INVALID_ACCESS_TOKEN:"Access token is invalid",INVALID_REFRESH_TOKEN:"Error validating refresh token",REFRESH_TOKEN_EXPIRED:"Refresh token has expired. Please login again",ACCESS_TOKEN_EXPIRED:"Access token has expired"}},3241:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthTokenValidate=t.createAuthTokenService=void 0;var n=r(5250),o=r(1663),i=r(8172),a=r(79);function c(){return(0,a.AuthTokenValidate)()}t.createAuthTokenService=function(){var e=(0,n.getCustomRepository)(o.RefreshTokenRepository),t=c();return(0,i.AuthTokenService)(e,t)},t.createAuthTokenValidate=c},8172:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenService=void 0;var a=i(r(9344)),c=i(r(6113)),u=i(r(2275)),s=i(r(3837)),f=r(2720),l=r(8999);t.AuthTokenService=function(e,t){var r=function(e){return a.default.sign({userId:e},u.default.auth.JWT_SECRET,{issuer:u.default.auth.JWT_ISSUER,expiresIn:Date.now()+u.default.auth.JWT_ACCESS_TOKEN_EXPIRES_TIME,algorithm:"HS256"})},i=function(t){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return r=c.default.randomBytes(u.default.auth.REFRESH_TOKEN_LENGTH).toString("hex"),[4,e.save({token:r,userId:t,expiresAt:new Date(Date.now()+u.default.auth.REFRESH_TOKEN_EXPIRES_TIME)})];case 1:return n.sent(),[2,r]}}))}))},d=function(r,i){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,e.findByTokenAndUserId(r,i)];case 1:return n=o.sent(),t.checkRefreshTokenExists(n),t.checkRefreshTokenActive(n),t.checkRefreshTokenNotExpired(n),[2,!0]}}))}))};return{createAccessTokenAndRefreshToken:function(e){return n(void 0,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=[r(e)],[4,i(e)];case 1:return[2,t.concat([n.sent()])]}}))}))},createAccessToken:r,createRefreshToken:i,blockRefreshToken:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.blockByToken(t)];case 1:return r.sent(),[2]}}))}))},deleteRefreshToken:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.deleteByToken(t)];case 1:return r.sent(),[2]}}))}))},validateAccessToken:function(e){return n(void 0,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,s.default.promisify(a.default.verify)(e,u.default.auth.JWT_SECRET)];case 1:return t=r.sent(),[3,3];case 2:throw r.sent(),new f.UnauthorizedError(l.AuthTokenErrorMessages.INVALID_ACCESS_TOKEN);case 3:if(t.iss!==u.default.auth.JWT_ISSUER)throw new f.UnauthorizedError(l.AuthTokenErrorMessages.INVALID_ACCESS_TOKEN);if(!t.exp||t.exp<Date.now())throw new f.UnauthorizedError(l.AuthTokenErrorMessages.ACCESS_TOKEN_EXPIRED);return[2,!0]}}))}))},validateRefreshToken:d,validateRefreshTokenCanRenewAccessToken:function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,d(e,t)];case 1:return[2,r.sent()]}}))}))},getUserIdFromAccessToken:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,s.default.promisify(a.default.verify)(e,u.default.auth.JWT_SECRET)];case 1:return[2,t.sent().userId]}}))}))}}}},79:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenValidate=void 0;var n=r(2720),o=r(8999),i=r(4574);t.AuthTokenValidate=function(){return{checkRefreshTokenExists:function(e){if(!e)throw new n.UnauthorizedError(o.AuthTokenErrorMessages.INVALID_REFRESH_TOKEN)},checkRefreshTokenActive:function(e){if(e.status===i.RefreshTokenStatus.BLOCKED)throw new n.UnauthorizedError(o.AuthTokenErrorMessages.INVALID_REFRESH_TOKEN)},checkRefreshTokenNotExpired:function(e){if(e.expiresAt.getTime()<Date.now())throw new n.UnauthorizedError(o.AuthTokenErrorMessages.REFRESH_TOKEN_EXPIRED)}}}},777:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseEntity=void 0;var i=r(5250),a=function(){function e(){}return n([(0,i.CreateDateColumn)({name:"created_at"}),o("design:type",Date)],e.prototype,"createdAt",void 0),n([(0,i.UpdateDateColumn)({name:"updated_at"}),o("design:type",Date)],e.prototype,"updatedAt",void 0),n([(0,i.DeleteDateColumn)({name:"deleted_at"}),o("design:type",Date)],e.prototype,"deletedAt",void 0),e}();t.BaseEntity=a},7325:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRepository=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findById=function(e){return this.findOne(e)},t}(r(5250).Repository);t.BaseRepository=i},9456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RepositoryQueryBuilder=void 0;var r=function(){function e(e,t){this.query=e.createQueryBuilder(t),this.tableAlias=t}return e.prototype.findById=function(e){return this.query.where("".concat(this.tableAlias,".id = :id"),{id:e}),this},e.prototype.withPageable=function(e){var t=e.page,r=e.size;return this.query.limit(r),this.query.skip(r*(t-1)),this},e.prototype.build=function(){return this.query},e}();t.RepositoryQueryBuilder=r},6571:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadRouter=void 0;var n=r(6860),o=r(1186);t.CloudUploadRouter=function(){var e=(0,n.Router)(),t=(0,o.createCloudUploadController)(),r=(0,o.createCloudUploadMiddleware)();return e.post("/avatar",r.avatarUpload.single("avatar"),t.uploadAvatar),e.post("/image",r.imageUpload.single("image"),t.uploadImage),e.post("/model",r.modelUpload.single("model"),t.uploadModel),e}},4949:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadController=void 0;var a=i(r(4708)),c=r(3015),u=r(2720),s=r(7500);t.CloudUploadController=function(e){function t(e){return a.default.createReadStream(e)}return{uploadModel:(0,c.catchAsyncRequestHandler)((function(r,i,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:if(!(n=r.file))throw new u.IllegalArgumentError("File upload is empty");return console.log(n),[4,e.uploadLargeFile({name:n.originalname,stream:t(n.buffer),type:n.mimetype})];case 1:return a=o.sent(),i.status(s.HttpStatusCode.OK).json({data:{url:a}}),[2]}}))}))})),uploadAvatar:(0,c.catchAsyncRequestHandler)((function(r,i,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:if(!(n=r.file))throw new u.IllegalArgumentError("File upload is empty");return[4,e.uploadMedia({name:n.originalname,stream:t(n.buffer),type:n.mimetype})];case 1:return a=o.sent(),i.status(s.HttpStatusCode.OK).json({data:{url:a}}),[2]}}))}))})),uploadImage:(0,c.catchAsyncRequestHandler)((function(r,i,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:if(!(n=r.file))throw new u.IllegalArgumentError("File upload is empty");return[4,e.uploadMedia({name:n.originalname,stream:t(n.buffer),type:n.mimetype})];case 1:return a=o.sent(),i.status(s.HttpStatusCode.OK).json({data:{url:a}}),[2]}}))}))}))}}},1186:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCloudUploadService=t.createCloudUploadMiddleware=t.createCloudUploadController=void 0;var n=r(7767),o=r(4949),i=r(6599),a=r(7973);function c(){return(0,a.CloudUploadService)(n.cloudLogger)}t.createCloudUploadController=function(){var e=c();return(0,o.CloudUploadController)(e)},t.createCloudUploadMiddleware=function(){return(0,i.CloudUploadMiddleware)()},t.createCloudUploadService=c},6599:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadMiddleware=void 0;var o=n(r(1738)),i=r(2720);t.CloudUploadMiddleware=function(){function e(e,t,r){"image"===t.mimetype.split("/")[0]?r(null,!0):r(new i.IllegalArgumentError("Only image files are allowed"))}return{avatarUpload:(0,o.default)({limits:{files:1,fileSize:20971520},fileFilter:e}),imageUpload:(0,o.default)({limits:{files:1,fileSize:20971520},fileFilter:e}),modelUpload:(0,o.default)({limits:{files:1},fileFilter:function(e,t,r){var n;(null===(n=t.mimetype.split("/")[1])||void 0===n?void 0:n.includes("gltf"))?r(null,!0):r(new i.IllegalArgumentError("Only gltf file type is allowed"))}})}}},7973:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadService=void 0;var a=i(r(9336)),c=r(5828),u=i(r(2275)),s=r(2720),f=r(3518);t.CloudUploadService=function(e){function t(){return n(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return e.info("Start config AWS S3 service"),a.default.config.update({apiVersion:"2006-03-01",region:u.default.cloud.MODEL_AWS_BUCKET_REGION,credentials:{accessKeyId:u.default.cloud.MODEL_AWS_BUCKET_ACCESS_KEY,secretAccessKey:u.default.cloud.MODEL_AWS_BUCKET_SECRET_KEY}}),e.info("Create new bucket contains file of models"),[4,r(t=new a.default.S3)];case 1:return n.sent(),[4,t.createBucket({Bucket:u.default.cloud.MODEL_AWS_BUCKET_NAME})];case 2:return n.sent(),[2]}}))}))}function r(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,e.putBucketCors({Bucket:u.default.cloud.MODEL_AWS_BUCKET_NAME,CORSConfiguration:{CORSRules:[{AllowedHeaders:["*"],AllowedMethods:["PUT","POST","DELETE"],AllowedOrigins:["*"]},{AllowedMethods:["GET"],AllowedOrigins:["*"]}]}}).promise()];case 1:return t.sent(),[2]}}))}))}return{initialize:function(){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return e.info("Start config cloudinary"),f.v2.config({cloud_name:u.default.cloud.IMAGE_CLOUDINARY_CLOUD_NAME,api_key:u.default.cloud.IMAGE_CLOUDINARY_API_KEY,api_secret:u.default.cloud.IMAGE_CLOUDINARY_API_SECRET}),[4,t()];case 1:return r.sent(),[2]}}))}))},uploadMedia:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){return[2,new Promise((function(t,r){var n=f.v2.uploader.upload_stream({},(function(e,n){n&&t(n.url),e&&r(new s.AppError(e.http_code,e.message))}));e.stream.pipe(n)}))]}))}))},uploadLargeFile:function(e){return n(void 0,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return t=new a.default.S3,r={Bucket:u.default.cloud.MODEL_AWS_BUCKET_NAME,Key:(0,c.v4)(),ContentType:e.type,Body:e.stream,ACL:"public-read",ContentDisposition:'attachment; filename="'.concat(e.name,'"')},[4,t.upload(r).promise()];case 1:return[2,n.sent().Location]}}))}))}}}},2048:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandlerDev=void 0;var n=r(2720),o=r(7500);t.globalErrorHandlerDev=function(e,t,r,i){e instanceof n.AppError?r.status(e.statusCode).json({message:e.message,stack:e.stack,error:e}):r.status(o.HttpStatusCode.INTERNAL_SERVER_ERROR).json({message:e.message,stack:e.stack,error:e})}},8715:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandlerProd=void 0;var n=r(2720),o=r(7500),i=r(7767);t.globalErrorHandlerProd=function(e,t,r,a){i.serverLogger.error(e),e instanceof n.AppError?r.status(o.HttpStatusCode.OK).json({status:e.status,code:e.statusCode,message:e.message,errors:e.errors}):r.status(o.HttpStatusCode.INTERNAL_SERVER_ERROR).json({message:"Something went wrong"})}},7886:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandler=void 0;var n=r(206),o=r(2048),i=r(8715);t.globalErrorHandler=function(e,t,r,a){"production"===n.appConfig.NODE_ENV&&(0,i.globalErrorHandlerProd)(e,t,r,a),"development"===n.appConfig.NODE_ENV&&(0,o.globalErrorHandlerDev)(e,t,r,a)}},827:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateItemDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"name",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"modelPath",void 0),e}();t.CreateItemDto=c},2067:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(1412),t)},1412:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRouter=void 0;var n=r(6860),o=r(3371),i=r(5337);t.ItemRouter=function(){var e=(0,o.createItemService)(),t=(0,i.ItemController)(e),r=(0,n.Router)();return r.route("/:id").get(t.getById).delete(t.deleteById).patch(t.updateById),r.route("/").get(t.getAll).post(t.create),r}},5337:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemController=void 0;var i=r(7500),a=r(3015),c=r(1624),u=r(5718),s=r(827);t.ItemController=function(e){return{getAll:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n=(0,c.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[4,e.findAll(n)];case 1:return a=o.sent(),r.status(i.HttpStatusCode.OK).json(a),[2]}}))}))})),getById:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,e.findById(+t.params.id)];case 1:return n=o.sent(),r.status(i.HttpStatusCode.OK).json(n),[2]}}))}))})),create:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a,c;return o(this,(function(o){switch(o.label){case 0:return[4,(0,u.validateRequestBody)(s.CreateItemDto,t.body)];case 1:if(n=o.sent())throw n;return a=t.body,[4,e.create(a)];case 2:return c=o.sent(),r.status(i.HttpStatusCode.CREATED).json(c),[2]}}))}))})),deleteById:(0,a.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){return[2]}))}))})),updateById:(0,a.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){return[2]}))}))}))}}},8301:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemCreator=void 0,t.ItemCreator=function(){var e=function(e){return{id:e.id,name:e.name,modelPath:e.modelPath,createdAt:e.createdAt}};return{mapItemToItemDto:e,mapItemsToItemsDto:function(t){return t.map((function(t){return e(t)}))}}}},1993:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;var c=r(5250),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)(),(0,c.Index)({}),a("design:type",String)],t.prototype,"name",void 0),i([(0,c.Column)({unique:!0,name:"model_path"}),a("design:type",String)],t.prototype,"modelPath",void 0),i([(0,c.Entity)({name:"item"})],t)}(r(777).BaseEntity);t.Item=u},5687:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemErrorMessages=void 0,t.ItemErrorMessages={ITEM_NOT_FOUND:"Item not found"}},3371:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createItemCreator=t.createItemService=t.createItemRepository=void 0;var n=r(5250),o=r(8301),i=r(1074),a=r(2926);function c(){return(0,n.getCustomRepository)(i.ItemRepository)}function u(){return(0,o.ItemCreator)()}t.createItemRepository=c,t.createItemService=function(){var e=c(),t=u();return(0,a.ItemService)(e,t)},t.createItemCreator=u},5767:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapItemToItemDto=void 0,t.mapItemToItemDto=function(e){return{id:e.id,modelPath:e.modelPath,name:e.name,createdAt:e.createdAt}}},1074:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRepository=void 0;var a=r(5250),c=r(1993),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,a.EntityRepository)(c.Item)],t)}(r(7325).BaseRepository);t.ItemRepository=u},2926:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemService=void 0;var a=r(2720),c=r(5687);t.ItemService=function(e,t){return{findAll:function(r){var n=r.page,a=r.size;return o(void 0,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,e.createQueryBuilder().take(a).skip((n-1)*a).getMany()];case 1:return r=o.sent(),[2,t.mapItemsToItemsDto(r)]}}))}))},findById:function(r){return o(void 0,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,e.findOne(r)];case 1:if(!(n=o.sent()))throw new a.NotFoundError(c.ItemErrorMessages.ITEM_NOT_FOUND);return[2,t.mapItemToItemDto(n)]}}))}))},create:function(r){return o(void 0,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,e.save(r)];case 1:return n=o.sent(),[2,t.mapItemToItemDto(n)]}}))}))},deleteById:function(t){return o(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,e.softDelete(t)];case 1:if(!r.sent().affected)throw new a.NotFoundError(c.ItemErrorMessages.ITEM_NOT_FOUND);return[2]}}))}))},updateById:function(r,u){return o(void 0,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return[4,e.save(n({id:r},u))];case 1:if(!(o=i.sent()))throw new a.NotFoundError(c.ItemErrorMessages.ITEM_NOT_FOUND);return[2,t.mapItemToItemDto(o)]}}))}))}}}},7767:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloudLogger=t.officeItemLogger=t.mailLogger=t.messageService=t.authLogger=t.userLogger=t.serverLogger=void 0;var n=r(7773),o=n.format.combine(n.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),n.format.align(),n.format.printf((function(e){return"".concat(e.timestamp," ").concat(e.level,": ").concat(e.message)}))),i={filename:"logs/log.log",format:n.format.combine(n.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),n.format.json()),maxFiles:1e3,maxsize:5242880},a={format:o,level:"debug"};t.serverLogger=(0,n.createLogger)({defaultMeta:{service:"server"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.userLogger=(0,n.createLogger)({defaultMeta:{service:"user-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.authLogger=(0,n.createLogger)({defaultMeta:{service:"auth-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.messageService=(0,n.createLogger)({defaultMeta:{service:"message-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.mailLogger=(0,n.createLogger)({defaultMeta:{service:"mail-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.officeItemLogger=(0,n.createLogger)({defaultMeta:{service:"office-items-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]}),t.cloudLogger=(0,n.createLogger)({defaultMeta:{service:"cloud-service"},transports:[new n.transports.File(i),new n.transports.Console(a)]})},4678:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailCacheService=void 0,t.MailCacheService=function(e){var t="mail_template";return{setMailTemplate:function(o,i,a){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.set("".concat(t,":").concat(o),i,{EX:(null==a?void 0:a.mailTemplateExpireSeconds)||1800})];case 1:return r.sent(),[2]}}))}))},getMailTemplate:function(o){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.get("".concat(t,":").concat(o))];case 1:return[2,r.sent()]}}))}))}}}},1876:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMailCacheService=t.createMailService=void 0;var n=r(366),o=r(7767),i=r(4678),a=r(1683);function c(){return(0,i.MailCacheService)((0,n.getCacheConnection)("mail"))}t.createMailService=function(){var e=c();return(0,a.MailService)(e,o.mailLogger)},t.createMailCacheService=c},1683:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailService=void 0;var c,u=a(r(7147)),s=a(r(3837)),f=a(r(2275)),l=a(r(2097)),d=a(r(5184));t.MailService=function(e,t){var r=function(e){return o(void 0,void 0,void 0,(function(){var t,r,o,u,s,f,d,p,h;return i(this,(function(i){switch(i.label){case 0:return t=e.from,r=e.to,o=e.context,u=e.subject,[4,a(e.templateUrl)];case 1:return s=i.sent(),f=l.default.compile(s),d=f(n({},o)),p={from:t,to:r,subject:u,html:d},[4,c.sendMail(p)];case 2:return[2,{acceptedRecipients:(h=i.sent()).accepted,rejectedRecipients:h.rejected,response:h.response}]}}))}))};function a(t){return o(this,void 0,void 0,(function(){var r,n;return i(this,(function(o){switch(o.label){case 0:return[4,e.getMailTemplate(t)];case 1:if(r=o.sent())return[2,r];if(!(n=u.default.readFileSync(t).toString()))throw new Error("Template file ".concat(t," is not found"));return[2,n]}}))}))}return{initialize:function(){return o(void 0,void 0,void 0,(function(){var e;return i(this,(function(r){switch(r.label){case 0:c=d.default.createTransport({service:f.default.mail.EMAIL_SERVICE_NAME,host:f.default.mail.EMAIL_SERVICE_HOST,port:f.default.mail.EMAIL_SERVICE_PORT,secure:!1,pool:!0,maxMessages:1/0,maxConnections:20,auth:{user:f.default.mail.EMAIL_SERVICE_USERNAME,pass:f.default.mail.EMAIL_SERVICE_PASSWORD}}),t.info("Start verify SMTP"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,s.default.promisify(c.verify)()];case 2:return r.sent()&&t.info("SMTP ready..."),[3,4];case 3:throw e=r.sent(),t.error("SMTP Error: ".concat(e)),t.error("SMTP not ready!"),e;case 4:return[2]}}))}))},sendBulkMails:function(e){return o(void 0,void 0,void 0,(function(){return i(this,(function(t){return e.map((function(e){return o(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,r(e)];case 1:return[2,t.sent()]}}))}))})),[2]}))}))},sendMail:r}}},8293:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(754),o={generate:function(){return(0,n.customAlphabet)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")(9)}};t.default=o},9817:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRouter=void 0;var n=r(7704);Object.defineProperty(t,"OfficeItemRouter",{enumerable:!0,get:function(){return n.OfficeItemRouter}})},7704:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRouter=void 0;var n=r(6860),o=r(6901),i=r(4509);t.OfficeItemRouter=function(){var e=(0,n.Router)(),t=(0,o.createAuthMiddleware)(),r=(0,i.createOfficeItemController)();return e.use(t.protect),e.route("/:id").get(r.getOfficeItemDetailById).delete(r.deleteOfficeItemById),e.route("/").get(r.getOfficeItemsDetail),e}},6002:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemController=void 0;var i=r(7500),a=r(3015),c=r(1624);t.OfficeItemController=function(e){return{getOfficeItemDetailById:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findOfficeItemDetailById(n)];case 1:return a=o.sent(),r.status(i.HttpStatusCode.OK).json({status:"success",officeItem:a}),[2]}}))}))})),getOfficeItemsDetail:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a,u,s;return o(this,(function(o){switch(o.label){case 0:return n=(0,c.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[4,e.findOfficeItemsDetail(n)];case 1:return a=o.sent(),u=a[0],s=a[1],r.status(i.HttpStatusCode.OK).json({status:"success",page:n.page,limit:n.size,total:s,offices:u}),[2]}}))}))})),deleteOfficeItemById:(0,a.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.deleteOfficeItem(n)];case 1:return o.sent(),r.status(i.HttpStatusCode.OK).json({status:"success"}),[2]}}))}))})),updateOfficeItemById:(0,a.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){return e.params.id,t.status(i.HttpStatusCode.OK).json({status:"success"}),[2]}))}))}))}}},2965:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItem=void 0;var c=r(5250),u=r(1993),s=r(4843),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.PrimaryColumn)({name:"item_id"}),a("design:type",Number)],t.prototype,"itemId",void 0),i([(0,c.PrimaryColumn)({name:"office_id"}),a("design:type",Number)],t.prototype,"officeId",void 0),i([(0,c.Column)({name:"x_rotation"}),a("design:type",Number)],t.prototype,"xRotation",void 0),i([(0,c.Column)({name:"y_rotation"}),a("design:type",Number)],t.prototype,"yRotation",void 0),i([(0,c.Column)({name:"z_rotation"}),a("design:type",Number)],t.prototype,"zRotation",void 0),i([(0,c.Column)({name:"x_position"}),a("design:type",Number)],t.prototype,"xPosition",void 0),i([(0,c.Column)({name:"y_position"}),a("design:type",Number)],t.prototype,"yPosition",void 0),i([(0,c.Column)({name:"z_position"}),a("design:type",Number)],t.prototype,"zPosition",void 0),i([(0,c.ManyToOne)((function(){return u.Item})),(0,c.JoinColumn)({name:"item_id"}),a("design:type",u.Item)],t.prototype,"item",void 0),i([(0,c.ManyToOne)((function(){return s.Office})),(0,c.JoinColumn)({name:"office_id"}),a("design:type",s.Office)],t.prototype,"office",void 0),i([(0,c.Entity)({name:"office_item"})],t)}(r(777).BaseEntity);t.OfficeItem=f},4275:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemErrorMessages=void 0,t.OfficeItemErrorMessages={OFFICE_ITEM_NOT_FOUND:"Office item not found"}},4509:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeItemRepository=t.createOfficeItemValidate=t.createOfficeItemService=t.createOfficeItemController=void 0;var n=r(5250),o=r(6002),i=r(1269),a=r(8743),c=r(9394);function u(){var e=(0,n.getCustomRepository)(i.OfficeItemRepository),t=s();return(0,a.OfficeItemService)(e,t)}function s(){var e=(0,n.getCustomRepository)(i.OfficeItemRepository);return(0,c.OfficeItemValidate)(e)}t.createOfficeItemController=function(){var e=u();return(0,o.OfficeItemController)(e)},t.createOfficeItemService=u,t.createOfficeItemValidate=s,t.createOfficeItemRepository=function(){return(0,n.getCustomRepository)(i.OfficeItemRepository)}},7437:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeItemToOfficeItemDetailDto=t.mapOfficeItemToOfficeItemOverviewDto=void 0;var n=r(5767),o=r(9855);t.mapOfficeItemToOfficeItemOverviewDto=function(e){var t=e.id,r=e.item,o=e.officeId,i=e.createdAt;return{id:t,officeId:o,transform:{position:{x:e.xPosition,y:e.yPosition,z:e.zPosition},rotation:{x:e.xRotation,y:e.yRotation,z:e.zRotation}},createdAt:i,item:(0,n.mapItemToItemDto)(r)}},t.mapOfficeItemToOfficeItemDetailDto=function(e){var t=e.id,r=e.item,i=e.office,a=e.createdAt,c={position:{x:e.xPosition,y:e.yPosition,z:e.zPosition},rotation:{x:e.xRotation,y:e.yRotation,z:e.zRotation}};return{id:t,item:(0,n.mapItemToItemDto)(r),office:(0,o.mapOfficeToOfficeOverviewDto)(i),transform:c,createdAt:a}}},1269:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRepository=void 0;var u=r(5250),s=r(2965),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.existsOfficeItemById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder("office_item").where("office_item.id = :id",{id:e}).getCount()];case 1:return[2,1===t.sent()]}}))}))},t.prototype.updateOfficeItemTransformById=function(e,t){return a(this,void 0,void 0,(function(){var r,n,o,i,a,u,s,f;return c(this,(function(c){switch(c.label){case 0:return r=t.position,n=t.rotation,o=r.x,i=r.y,a=r.z,u=n.x,s=n.y,f=n.z,[4,this.update(e,{xPosition:o,yPosition:i,zPosition:a,xRotation:u,yRotation:s,zRotation:f})];case 1:return c.sent(),[2]}}))}))},t.prototype.findOfficeItemWithItemById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").where("office_item.id = :id",{id:e}).getOne()]}))}))},t.prototype.findOfficeItemWithItemAndOfficeById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").leftJoinAndSelect("office_item.office","office").where("office_item.id = :id",{id:e}).getOne()]}))}))},t.prototype.findOfficeItemsWithItemAndOffice=function(e){return a(this,void 0,void 0,(function(){var t,r;return c(this,(function(n){return t=e.page,r=e.size,[2,this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").leftJoinAndSelect("office_item.office","office").skip((t-1)*r).limit(r).getMany()]}))}))},t.prototype.findOfficeItemsWithItemByOfficeId=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").where("office_item.officeId = :officeId",{officeId:e}).getMany()]}))}))},i([(0,u.EntityRepository)(s.OfficeItem)],t)}(r(7325).BaseRepository);t.OfficeItemRepository=f},8743:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemService=void 0;var i=r(7437);t.OfficeItemService=function(e,t){return{createOfficeItem:function(t){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,e.save(t)];case 1:return r=n.sent(),[2,(0,i.mapOfficeItemToOfficeItemOverviewDto)(r)]}}))}))},findOfficeItemDetailById:function(r){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,t.checkOfficeItemExistsById(r)];case 1:return o.sent(),[4,e.findOfficeItemWithItemAndOfficeById(r)];case 2:return n=o.sent(),[2,(0,i.mapOfficeItemToOfficeItemDetailDto)(n)]}}))}))},findOfficeItemsDetail:function(t){return n(void 0,void 0,void 0,(function(){var r,n;return o(this,(function(o){switch(o.label){case 0:return[4,e.findOfficeItemsWithItemAndOffice(t)];case 1:return r=o.sent(),[4,e.count()];case 2:return n=o.sent(),[2,[r.map((function(e){return(0,i.mapOfficeItemToOfficeItemDetailDto)(e)})),n]]}}))}))},deleteOfficeItem:function(r){return n(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,t.checkOfficeItemExistsById(r)];case 1:return n.sent(),[4,e.delete(r)];case 2:return n.sent(),[2]}}))}))}}}},9394:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemValidate=void 0;var i=r(2720),a=r(4275);t.OfficeItemValidate=function(e){return{checkOfficeItemExistsById:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsOfficeItemById(t)];case 1:if(!r.sent())throw new i.NotFoundError(a.OfficeItemErrorMessages.OFFICE_ITEM_NOT_FOUND);return[2]}}))}))}}}},478:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRole=void 0;var c=r(5250),u=r(777),s=r(5970),f=r(1500),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryColumn)({name:"office_member_id"}),a("design:type",Number)],t.prototype,"officeMemberId",void 0),i([(0,c.PrimaryColumn)({name:"office_role_id"}),a("design:type",Number)],t.prototype,"officeRoleId",void 0),i([(0,c.ManyToOne)((function(){return s.OfficeMember}),(function(e){return e.roles})),(0,c.JoinColumn)({name:"office_member_id"}),a("design:type",s.OfficeMember)],t.prototype,"officeMember",void 0),i([(0,c.ManyToOne)((function(){return f.OfficeRole})),(0,c.JoinColumn)({name:"office_role_id"}),a("design:type",f.OfficeRole)],t.prototype,"officeRole",void 0),i([(0,c.Entity)({name:"office_member_role"})],t)}(u.BaseEntity);t.OfficeMemberRole=l},5076:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformCacheService=void 0,t.OfficeMemberTransformCacheService=function(e){var t="office_member_transform";return{setTransform:function(o,i){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.set("".concat(t,":").concat(o),JSON.stringify({memberTransform:i}))];case 1:return r.sent(),[2]}}))}))},getTransformById:function(o){return r(void 0,void 0,void 0,(function(){var r;return n(this,(function(n){switch(n.label){case 0:return[4,e.get("".concat(t,":").concat(o))];case 1:return(r=n.sent())?[2,JSON.parse(r)]:[2,void 0]}}))}))},deleteTransformById:function(t){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.del("".concat(t))];case 1:return r.sent(),[2]}}))}))},scan:function(t,r){return e.scan(t,{COUNT:r})},flushAll:function(){return r(void 0,void 0,void 0,(function(){return n(this,(function(t){return[2,e.flushAll()]}))}))}}}},1230:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransform=void 0;var c=r(5250),u=r(777),s=r(5970),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryColumn)({name:"office_member_id"}),a("design:type",Number)],t.prototype,"officeMemberId",void 0),i([(0,c.Column)({name:"x_rotation",default:0}),a("design:type",Number)],t.prototype,"xRotation",void 0),i([(0,c.Column)({name:"y_rotation",default:0}),a("design:type",Number)],t.prototype,"yRotation",void 0),i([(0,c.Column)({name:"z_rotation",default:0}),a("design:type",Number)],t.prototype,"zRotation",void 0),i([(0,c.Column)({name:"x_position",default:0}),a("design:type",Number)],t.prototype,"xPosition",void 0),i([(0,c.Column)({name:"y_position",default:0}),a("design:type",Number)],t.prototype,"yPosition",void 0),i([(0,c.Column)({name:"z_position",default:0}),a("design:type",Number)],t.prototype,"zPosition",void 0),i([(0,c.OneToOne)((function(){return s.OfficeMember})),(0,c.JoinColumn)({name:"office_member_id"}),a("design:type",s.OfficeMember)],t.prototype,"officeMember",void 0),i([(0,c.Entity)({name:"office_member_transform"})],t)}(u.BaseEntity);t.OfficeMemberTransform=f},8993:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeMemberTransformCache=t.createOfficeMemberTransformRepository=t.createOfficeMemberTransformService=void 0;var n=r(5250),o=r(366),i=r(5076),a=r(1428),c=r(5528);function u(){return(0,n.getCustomRepository)(a.OfficeMemberTransformRepository)}function s(){var e=(0,o.getCacheConnection)("officeMemberTransform");return(0,i.OfficeMemberTransformCacheService)(e)}t.createOfficeMemberTransformService=function(){var e=u(),t=s();return(0,c.OfficeMemberTransformService)(e,t)},t.createOfficeMemberTransformRepository=u,t.createOfficeMemberTransformCache=s},5680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeMemberTransformToTransform3D=void 0,t.mapOfficeMemberTransformToTransform3D=function(e){return{position:{x:e.xPosition,y:e.yPosition,z:e.zPosition},rotation:{x:e.xRotation,y:e.yRotation,z:e.zRotation}}}},1428:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformRepository=void 0;var u=r(5250),s=r(7325),f=r(1230),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findTransformByOfficeMemberId=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){return[2,this.createQueryBuilder().where("office_member_id = :id",{id:e}).getOne()]}))}))},i([(0,u.EntityRepository)(f.OfficeMemberTransform)],t)}(s.BaseRepository);t.OfficeMemberTransformRepository=l},5528:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformService=void 0;var a=r(2720);t.OfficeMemberTransformService=function(e,t){return{updateTransformInCacheById:function(e,r){return o(void 0,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,t.setTransform(e,n({officeMemberId:e},r))];case 1:return o.sent(),[2]}}))}))},backupTransformFromCacheById:function(r){return o(void 0,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return[4,t.getTransformById(r)];case 1:return(o=i.sent())?[4,e.update(r,n({},o))]:[3,4];case 2:return i.sent(),[4,t.deleteTransformById(r)];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},findTransformById:function(r){return o(void 0,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return[4,t.getTransformById(r)];case 1:return(n=i.sent())?[2,n]:[4,e.findById(r)];case 2:if(!(o=i.sent()))throw new a.NotFoundError("Office member transform not found");return[2,o]}}))}))}}}},9366:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberOnlineStatus=void 0,(r=t.OfficeMemberOnlineStatus||(t.OfficeMemberOnlineStatus={})).ONLINE="online",r.OFFLINE="offline"},7114:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRouter=void 0;var n=r(3245);Object.defineProperty(t,"OfficeMemberRouter",{enumerable:!0,get:function(){return n.OfficeMemberRouter}})},3245:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRouter=void 0;var n=r(6860),o=r(6901),i=r(4491);t.OfficeMemberRouter=function(){var e=(0,n.Router)(),t=(0,o.createAuthMiddleware)(),r=(0,i.createOfficeMemberController)();return e.use(t.protect),e.route("/:id").get(r.getOfficeMemberById).delete(r.deleteOfficeMember),e.route("/").get(r.getOfficeMembersDetail).post(r.addMemberToOffice),e}},126:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberController=void 0;var i=r(1624),a=r(7500),c=r(3015);t.OfficeMemberController=function(e){return{getOfficeMemberById:(0,c.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findOfficeMemberDetailById(n)];case 1:return i=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",officeMember:i}),[2]}}))}))})),getOfficeMembersDetail:(0,c.catchAsyncRequestHandler)((function(t,r,c){return n(void 0,void 0,void 0,(function(){var n,c,u,s;return o(this,(function(o){switch(o.label){case 0:return n=(0,i.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[4,e.findOfficeMembersDetail(n)];case 1:return c=o.sent(),u=c[0],s=c[1],r.status(a.HttpStatusCode.OK).json({status:"success",page:n.page,limit:n.size,total:s,officeMembers:u}),[2]}}))}))})),deleteOfficeMember:(0,c.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.deleteOfficeMemberById(n)];case 1:return o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success"}),[2]}}))}))})),addMemberToOffice:(0,c.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=t.body,[4,e.createOfficeMember(n)];case 1:return i=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",officeMember:i}),[2]}}))}))}))}}},7874:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberCreator=void 0;var i=r(8164);t.OfficeMemberCreator=function(e){return{createOfficeMemberOverviewById:function(t){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,e.queryBuilder().findById(t).withMember().withTransform().build().getOne()];case 1:return r=n.sent(),[2,(0,i.mapOfficeMemberToOfficeMemberOverviewDto)(r)]}}))}))},createOfficeMemberDetailById:function(t){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,e.queryBuilder().findById(t).withMember().withOfficeHasCreator().withTransform().withRoles().build().getOne()];case 1:return r=n.sent(),[2,(0,i.mapOfficeMemberToOfficeMemberDetailDto)(r)]}}))}))},createOfficeMembersOverviewByOfficeId:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.queryBuilder().findByOfficeId(t).withMember().withTransform().build().getMany()];case 1:return[2,r.sent().map((function(e){return(0,i.mapOfficeMemberToOfficeMemberOverviewDto)(e)}))]}}))}))}}}},5970:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMember=void 0;var c=r(5250),u=r(4843),s=r(4614),f=r(777),l=r(1230),d=r(9366),p=r(478),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)({name:"member_id"}),a("design:type",Number)],t.prototype,"memberId",void 0),i([(0,c.Column)({name:"office_id"}),a("design:type",Number)],t.prototype,"officeId",void 0),i([(0,c.Column)({name:"online_status",type:"enum",enum:d.OfficeMemberOnlineStatus,default:d.OfficeMemberOnlineStatus.OFFLINE}),a("design:type",String)],t.prototype,"onlineStatus",void 0),i([(0,c.ManyToOne)((function(){return s.User}),{onDelete:"CASCADE"}),(0,c.JoinColumn)({name:"member_id"}),a("design:type",s.User)],t.prototype,"member",void 0),i([(0,c.ManyToOne)((function(){return u.Office}),{onDelete:"CASCADE"}),(0,c.JoinColumn)({name:"office_id"}),a("design:type",u.Office)],t.prototype,"office",void 0),i([(0,c.OneToMany)((function(){return p.OfficeMemberRole}),(function(e){return e.officeMember}),{cascade:!0}),a("design:type",Array)],t.prototype,"roles",void 0),i([(0,c.OneToOne)((function(){return l.OfficeMemberTransform}),(function(e){return e.officeMember}),{cascade:!0}),a("design:type",l.OfficeMemberTransform)],t.prototype,"transform",void 0),i([(0,c.Entity)({name:"office_member"})],t)}(f.BaseEntity);t.OfficeMember=h},4711:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberErrorMessages=void 0,t.OfficeMemberErrorMessages={OFFICE_MEMBER_NOT_FOUND:"Office member not found",USER_ALREADY_IN_OFFICE:"User already existed in office",PERMISSION_DENIED:"Office member not has permission to perform this action"}},4491:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeMemberRepository=t.createOfficeMemberCreator=t.createOfficeMemberValidate=t.createOfficeMemberCache=t.createOfficeMemberService=t.createOfficeMemberSocketService=t.createOfficeMemberController=void 0;var n=r(5250),o=r(366),i=r(8993),a=r(126),c=r(7874),u=r(8637),s=r(2034),f=r(3431),l=r(7511);function d(){var e=y(),t=(0,i.createOfficeMemberTransformRepository)(),r=v(),n=h();return(0,s.OfficeMemberService)(e,t,r,n)}function p(){var e=(0,o.getCacheConnection)("officeMember");return(0,l.OfficeMemberSocketCacheService)(e)}function h(){var e=y();return(0,f.OfficeMemberValidate)(e)}function v(){var e=y();return(0,c.OfficeMemberCreator)(e)}function y(){return(0,n.getCustomRepository)(u.OfficeMemberRepository)}t.createOfficeMemberController=function(){var e=d();return(0,a.OfficeMemberController)(e)},t.createOfficeMemberSocketService=function(e,t){var r=y(),n=(0,i.createOfficeMemberTransformService)(),o=p();return(0,l.OfficeMemberSocketService)(e,t,r,n,o)},t.createOfficeMemberService=d,t.createOfficeMemberCache=p,t.createOfficeMemberValidate=h,t.createOfficeMemberCreator=v,t.createOfficeMemberRepository=y},8164:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeMemberToOfficeMemberDetailDto=t.mapOfficeMemberToOfficeMemberOverviewDto=void 0;var n=r(5680),o=r(9855),i=r(9857);t.mapOfficeMemberToOfficeMemberOverviewDto=function(e){var t=e.id,r=e.member,o=e.officeId,a=e.transform,c=e.onlineStatus;return e.roles,{id:t,officeId:o,member:(0,i.mapUserToUserOverviewDto)(r),onlineStatus:c,transform:(0,n.mapOfficeMemberTransformToTransform3D)(a)}},t.mapOfficeMemberToOfficeMemberDetailDto=function(e){var t=e.id,r=e.member,a=e.office,c=e.transform,u=e.onlineStatus,s=e.roles,f=(0,i.mapUserToUserOverviewDto)(r),l=(0,o.mapOfficeToOfficeOverviewDto)(a),d=(0,n.mapOfficeMemberTransformToTransform3D)(c);return{id:t,office:l,member:f,roles:s.map((function(e){return e.officeRole.name})),onlineStatus:u,transform:d}}},8637:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRepository=void 0;var u=r(5250),s=r(5970),f=r(7325),l=r(4350),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.queryBuilder=function(){return new l.OfficeMemberRepositoryQueryBuilder(this)},t.prototype.existsOfficeMemberById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder("office_member").where("office_member.id = :id",{id:e}).getCount()];case 1:return[2,1===t.sent()]}}))}))},t.prototype.existsUserInOffice=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.createQueryBuilder("office_member").where("office_member.member_id = :userId",{userId:e}).andWhere("office_member.office_id = :officeId",{officeId:t}).getCount()];case 1:return[2,1===r.sent()]}}))}))},t.prototype.setOfficeMemberOnlineStatusById=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.createQueryBuilder("office_member").update().where("office_member.id = :id",{id:e}).set({onlineStatus:t}).execute()];case 1:return r.sent(),[2]}}))}))},t.prototype.findOfficeMemberByMemberEmailAndOfficeId=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){return[2,this.createQueryBuilder("office_member").where("office_member.office_id = :officeId",{officeId:t}).leftJoin("office_member.member","user").where("user.email = :email",{email:e}).getOne()]}))}))},i([(0,u.EntityRepository)(s.OfficeMember)],t)}(f.BaseRepository);t.OfficeMemberRepository=d},4350:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRepositoryQueryBuilder=void 0;var i=function(e){function t(t){return e.call(this,t,"office_member")||this}return o(t,e),t.prototype.findById=function(t){return e.prototype.findById.call(this,t),this},t.prototype.findByOfficeId=function(e){return this.query.where("office_member.office_id = :officeId",{officeId:e}),this},t.prototype.findByMemberId=function(e){return this.query.where("office_member.member_id = :memberId",{memberId:e}),this},t.prototype.findByMemberIdAndOfficeId=function(e,t){return this.query.where("office_member.member_id = :memberId",{memberId:e}).andWhere("office_member.office_id = :officeId",{officeId:t}),this},t.prototype.findAll=function(){return this.query,this},t.prototype.withMember=function(){return this.query.leftJoinAndSelect("office_member.member","user"),this},t.prototype.withOffice=function(){return this.query.leftJoinAndSelect("office_member.office","office"),this},t.prototype.withOfficeHasCreator=function(){return this.query.leftJoinAndSelect("office_member.office","office").leftJoinAndSelect("office.createdBy","created_user"),this},t.prototype.withTransform=function(){return this.query.leftJoinAndSelect("office_member.transform","office_member_transform"),this},t.prototype.withRoles=function(){return this.query.leftJoinAndSelect("office_member.roles","office_member_role").leftJoinAndSelect("office_member_role.officeRole","office_role"),this},t.prototype.withPageable=function(t){return e.prototype.withPageable.call(this,t),this},t.prototype.build=function(){return this.query},t}(r(9456).RepositoryQueryBuilder);t.OfficeMemberRepositoryQueryBuilder=i},2034:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberService=void 0;var i=r(2720),a=r(4711),c=r(8164);t.OfficeMemberService=function(e,t,r,u){return{createOfficeMember:function(t){return n(void 0,void 0,void 0,(function(){var n,i,a;return o(this,(function(o){switch(o.label){case 0:return n=t.memberId,i=t.officeId,[4,u.checkUniqueUserInOffice(n,i)];case 1:return o.sent(),[4,e.save({memberId:n,officeId:i,transform:{}})];case 2:return a=o.sent(),[4,r.createOfficeMemberOverviewById(a.id)];case 3:return[2,o.sent()]}}))}))},deleteOfficeMemberById:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,u.checkExistsOfficeMemberById(t)];case 1:return r.sent(),[4,e.delete(t)];case 2:return r.sent(),[2]}}))}))},updateOfficeMemberTransformById:function(e,t){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){return[2]}))}))},findOfficeMemberOverviewById:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,r.createOfficeMemberOverviewById(e)];case 1:return[2,t.sent()]}}))}))},findOfficeMemberDetailById:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,r.createOfficeMemberDetailById(e)];case 1:return[2,t.sent()]}}))}))},findOfficeMembersDetail:function(t){return n(void 0,void 0,void 0,(function(){var r,n;return o(this,(function(o){switch(o.label){case 0:return[4,e.queryBuilder().withMember().withOfficeHasCreator().withRoles().withTransform().withPageable(t).build().getMany()];case 1:return r=o.sent(),[4,e.count()];case 2:return n=o.sent(),[2,[r.map((function(e){return(0,c.mapOfficeMemberToOfficeMemberDetailDto)(e)})),n]]}}))}))},setOfficeMemberOnlineStatusById:function(t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.findOne(t)];case 1:if(!n.sent())throw new i.NotFoundError(a.OfficeMemberErrorMessages.OFFICE_MEMBER_NOT_FOUND);return[4,e.setOfficeMemberOnlineStatusById(t,r)];case 2:return n.sent(),[2]}}))}))}}}},3431:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberValidate=void 0;var i=r(2720),a=r(4711);t.OfficeMemberValidate=function(e){return{checkExistsOfficeMemberById:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsOfficeMemberById(t)];case 1:if(!r.sent())throw new i.IllegalArgumentError(a.OfficeMemberErrorMessages.OFFICE_MEMBER_NOT_FOUND);return[2]}}))}))},checkUniqueUserInOffice:function(t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,e.existsUserInOffice(t,r)];case 1:if(n.sent())throw new i.IllegalArgumentError(a.OfficeMemberErrorMessages.USER_ALREADY_IN_OFFICE);return[2]}}))}))}}}},7511:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(4718),t),o(r(6717),t)},6717:function(e,t){var r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberSocketCacheService=void 0,t.OfficeMemberSocketCacheService=function(e){var t="office_member";return{setUserSocket:function(o,i){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.set("".concat(t,":").concat(o),i)];case 1:return r.sent(),[2]}}))}))},getUserSocket:function(o){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.get("".concat(t,":").concat(o))];case 1:return[2,r.sent()]}}))}))},deleteUserSocket:function(o){return r(void 0,void 0,void 0,(function(){return n(this,(function(r){switch(r.label){case 0:return[4,e.del("".concat(t,":").concat(o))];case 1:return r.sent(),[2]}}))}))}}}},4718:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberSocketService=void 0;var a=r(9366);t.OfficeMemberSocketService=function(e,t,r,c,u){return{onJoinToOfficeRoom:function(e){return o(this,void 0,void 0,(function(){var n,c,u;return i(this,(function(s){switch(s.label){case 0:return n=e.officeId,c=t.user.id,[4,r.queryBuilder().findByMemberIdAndOfficeId(c,n).build().getOne()];case 1:if(!(u=s.sent()))throw new Error("Office member not found");return t.data.officeMember={id:u.id,memberId:u.memberId,officeId:u.officeId},t.join("".concat(u.officeId)),function(e,r){o(this,void 0,void 0,(function(){return i(this,(function(n){return t.to("".concat(r)).emit("office_member:online",e),[2]}))}))}(u.memberId,n),function(e){o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,r.setOfficeMemberOnlineStatusById(e,a.OfficeMemberOnlineStatus.ONLINE)];case 1:return t.sent(),[2]}}))}))}(u.memberId),[2]}}))}))},onMemberDisconnect:function(){return o(this,void 0,void 0,(function(){var e,n,u;return i(this,(function(s){switch(s.label){case 0:return e=t.data.officeMember,n=e.id,u=e.memberId,t.to("".concat(t.data.officeMember.officeId)).emit("office_member:offline",u),function(e){o(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,r.setOfficeMemberOnlineStatusById(e,a.OfficeMemberOnlineStatus.OFFLINE)];case 1:return t.sent(),[2]}}))}))}(n),[4,c.backupTransformFromCacheById(n)];case 1:return s.sent(),[2]}}))}))},onMemberMove:function(e){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return t.to("".concat(t.data.officeMember.officeId)).emit("office_member:moved",n({memberId:t.user.id,officeId:t.data.officeMember.officeId},e)),[4,c.updateTransformInCacheById(t.data.officeMember.id,e)];case 1:return r.sent(),[2]}}))}))}}}},1548:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRoleType=void 0,(r=t.OfficeRoleType||(t.OfficeRoleType={})).OWNER="OWNER",r.ADMIN="ADMIN",r.MEMBER="MEMBER"},1500:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRole=void 0;var c=r(5250),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)({unique:!0}),(0,c.Index)(),a("design:type",String)],t.prototype,"name",void 0),i([(0,c.Entity)({name:"office_role"})],t)}(r(777).BaseEntity);t.OfficeRole=u},9842:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeRoleRepository=void 0;var n=r(5250),o=r(3913);t.createOfficeRoleRepository=function(){return(0,n.getCustomRepository)(o.OfficeRoleRepository)}},3913:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRoleRepository=void 0;var u=r(5250),s=r(1500),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findOfficeRoleByName=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder("office_role").where("office_role.name = :name",{name:e}).getOne()];case 1:return[2,t.sent()]}}))}))},i([(0,u.EntityRepository)(s.OfficeRole)],t)}(r(7325).BaseRepository);t.OfficeRoleRepository=f},973:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateOfficeDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,i.Expose)(),(0,a.IsDefined)(),(0,a.Length)(1,255),o("design:type",String)],e.prototype,"name",void 0),e}();t.CreateOfficeDto=c},7299:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateOfficeDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,i.Expose)(),(0,a.IsDefined)(),(0,a.Length)(1,255),o("design:type",String)],e.prototype,"name",void 0),e}();t.UpdateOfficeDto=c},1747:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRouter=void 0;var n=r(9237);Object.defineProperty(t,"OfficeRouter",{enumerable:!0,get:function(){return n.OfficeRouter}})},9237:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRouter=void 0;var n=r(6860),o=r(6901),i=r(4903);t.OfficeRouter=function(){var e=(0,i.createOfficeController)(),t=(0,o.createAuthMiddleware)().protect,r=(0,n.Router)();return r.use(t),r.route("/:id/members").get(e.getOfficeMembersById),r.route("/:id/items").get(e.getOfficeItemsById),r.route("/:id").get(e.getOfficeDetailById).delete(e.deleteOfficeById).patch(e.updateOfficeById),r.route("/").get(e.getAllOfficesOverviewCurrentUserIsMember).post(e.createOffice).patch(e.updateOfficeById),r}},5308:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeController=void 0;var i=r(1624),a=r(7500),c=r(2720),u=r(3015),s=r(5718),f=r(973),l=r(7299);t.OfficeController=function(e){return{getOfficeDetailById:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findOfficeDetailById(n)];case 1:return i=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",office:i}),[2]}}))}))})),updateOfficeById:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i,u,f;return o(this,(function(o){switch(o.label){case 0:return[4,(0,s.validateRequestBody)(l.UpdateOfficeDto,t.body)];case 1:if((n=o.sent()).length>0)throw new c.IllegalArgumentError("Invalid update office data",n);return i=+t.params.id,u=t.body,[4,e.updateOfficeById(i,u)];case 2:return f=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",office:f}),[2]}}))}))})),deleteOfficeById:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.deleteOfficeById(n)];case 1:return o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success"}),[2]}}))}))})),getOfficeItemsById:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findOfficeItemsById(n)];case 1:return i=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",data:i}),[2]}}))}))})),getOfficeMembersById:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findOfficeMembersById(n)];case 1:return i=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",data:i}),[2]}}))}))})),getAllOfficesOverviewCurrentUserIsMember:(0,u.catchAsyncRequestHandler)((function(t,r,c){return n(void 0,void 0,void 0,(function(){var n,c,u,s;return o(this,(function(o){switch(o.label){case 0:return n=(0,i.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[4,e.findAllOfficesOverviewUserIsMemberByUserId(t.user.id,n)];case 1:return c=o.sent(),u=c[0],s=c[1],r.status(a.HttpStatusCode.OK).json({status:"success",page:n.page,limit:n.size,total:s,offices:u}),[2]}}))}))})),createOffice:(0,u.catchAsyncRequestHandler)((function(t,r,i){return n(void 0,void 0,void 0,(function(){var n,i,u;return o(this,(function(o){switch(o.label){case 0:return[4,(0,s.validateRequestBody)(f.CreateOfficeDto,t.body)];case 1:if((n=o.sent()).length>0)throw new c.IllegalArgumentError("Invalid request body",n);return i=t.body,[4,e.createOffice(t.user.id,i)];case 2:return u=o.sent(),r.status(a.HttpStatusCode.OK).json({status:"success",office:u}),[2]}}))}))}))}}},3578:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeCreator=void 0;var i=r(9855);t.OfficeCreator=function(e,t,r){return{createOfficeOverviewById:function(t){return n(void 0,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,e.queryBuilder().findById(t).withCreator().build().getOne()];case 1:return r=n.sent(),[2,(0,i.mapOfficeToOfficeOverviewDto)(r)]}}))}))},createOfficesOverviewsByIds:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.queryBuilder().findByIds(t).withCreator().build().getMany()];case 1:return[2,r.sent().map((function(e){return(0,i.mapOfficeToOfficeOverviewDto)(e)}))]}}))}))},createOfficeDetailById:function(a){return n(void 0,void 0,void 0,(function(){var n,c,u;return o(this,(function(o){switch(o.label){case 0:return[4,e.queryBuilder().findById(a).withCreator().build().getOne()];case 1:return n=o.sent(),[4,t.queryBuilder().findByOfficeId(a).withMember().withTransform().build().getMany()];case 2:return c=o.sent(),[4,r.findOfficeItemsWithItemByOfficeId(a)];case 3:return u=o.sent(),[2,(0,i.mapOfficeToOfficeDetailDto)({office:n,officeItems:u,officeMembers:c})]}}))}))},createOfficesOverview:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.queryBuilder().withCreator().withPageable(t).build().getMany()];case 1:return[2,r.sent().map((function(e){return(0,i.mapOfficeToOfficeOverviewDto)(e)}))]}}))}))}}}},4843:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Office=void 0;var c=r(5250),u=r(777),s=r(2965),f=r(5970),l=r(4614),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)(),a("design:type",String)],t.prototype,"name",void 0),i([(0,c.Column)({unique:!0,name:"invitation_code"}),(0,c.Index)(),a("design:type",String)],t.prototype,"invitationCode",void 0),i([(0,c.Column)({name:"created_by_user_id"}),(0,c.Index)(),a("design:type",Number)],t.prototype,"createdByUserId",void 0),i([(0,c.OneToMany)((function(){return s.OfficeItem}),(function(e){return e.office}),{cascade:!0}),a("design:type",Array)],t.prototype,"officeItems",void 0),i([(0,c.OneToMany)((function(){return f.OfficeMember}),(function(e){return e.office}),{cascade:!0}),a("design:type",Array)],t.prototype,"officeMembers",void 0),i([(0,c.ManyToOne)((function(){return l.User})),(0,c.JoinColumn)({name:"created_by_user_id"}),a("design:type",l.User)],t.prototype,"createdBy",void 0),i([(0,c.Entity)({name:"office"})],t)}(u.BaseEntity);t.Office=d},2100:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeErrorMessages=void 0,t.OfficeErrorMessages={OFFICE_NOT_FOUND:"Office not found"}},4903:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeRepository=t.createOfficeCreator=t.createOfficeValidate=t.createOfficeGenerator=t.createOfficeService=t.createOfficeSocketHandler=t.createOfficeController=void 0;var o=r(5250),i=r(4509),a=r(4491),c=r(5308),u=r(3578),s=r(9772),f=r(7174),l=r(1241),d=r(9842),p=n(r(8293)),h=r(6456);function v(){var e=m(),t=(0,i.createOfficeItemRepository)(),r=(0,a.createOfficeMemberRepository)(),n=(0,d.createOfficeRoleRepository)(),o=_(),c=(0,a.createOfficeMemberCreator)(),u=b(),s=y();return(0,f.OfficeService)(e,t,r,n,o,c,u,s)}function y(){return p.default}function b(){var e=m();return(0,l.OfficeValidate)(e)}function _(){var e=m(),t=(0,i.createOfficeItemRepository)(),r=(0,a.createOfficeMemberRepository)();return(0,u.OfficeCreator)(e,r,t)}function m(){return(0,o.getCustomRepository)(s.OfficeRepository)}t.createOfficeController=function(){return(0,c.OfficeController)(v())},t.createOfficeSocketHandler=function(e,t){return(0,h.OfficeSocketHandler)(e,t)},t.createOfficeService=v,t.createOfficeGenerator=y,t.createOfficeValidate=b,t.createOfficeCreator=_,t.createOfficeRepository=m},9855:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeToOfficeDetailDto=t.mapOfficeToOfficeOverviewDto=void 0;var n=r(7437),o=r(8164),i=r(9857);t.mapOfficeToOfficeOverviewDto=function(e){var t=e.id,r=e.createdAt,n=e.invitationCode,o=e.name,a=e.createdBy;return{id:t,name:o,invitationCode:n,createdBy:(0,i.mapUserToUserOverviewDto)(a),createdAt:r}},t.mapOfficeToOfficeDetailDto=function(e){var t=e.office,r=e.officeItems,a=e.officeMembers,c=t.id,u=t.createdAt,s=t.invitationCode,f=t.name,l=t.createdBy,d=r.map((function(e){return(0,n.mapOfficeItemToOfficeItemOverviewDto)(e)})),p=a.map((function(e){return(0,o.mapOfficeMemberToOfficeMemberOverviewDto)(e)}));return{id:c,name:f,invitationCode:s,createdBy:(0,i.mapUserToUserOverviewDto)(l),officeItems:d,officeMembers:p,createdAt:u}}},9772:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRepository=void 0;var u=r(5250),s=r(7325),f=r(4843),l=r(1179),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.queryBuilder=function(){return new l.OfficeRepositoryQueryBuilder(this)},t.prototype.existsOfficeByInvitationCode=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder("office").where("office.invitationCode = :invitationCode",{invitationCode:e}).getCount()];case 1:return[2,1===t.sent()]}}))}))},t.prototype.existsOfficeById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.createQueryBuilder("office").where("office.id = :id",{id:e}).getCount()];case 1:return[2,1===t.sent()]}}))}))},i([(0,u.EntityRepository)(f.Office)],t)}(s.BaseRepository);t.OfficeRepository=d},1179:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRepositoryQueryBuilder=void 0;var i=function(e){function t(t){return e.call(this,t,"office")||this}return o(t,e),t.prototype.findById=function(t){return e.prototype.findById.call(this,t),this},t.prototype.findByIds=function(e){return this.query.where("office.id IN (:...ids)",{ids:e}),this},t.prototype.findByInvitationCode=function(e){return this.query.where("office.invitation_code = :invitationCode",{invitationCode:e}),this},t.prototype.findByCreatorId=function(e){return this.query.where("office.created_by_user_id = :creatorId",{creatorId:e}),this},t.prototype.withCreator=function(){return this.query.leftJoinAndSelect("office.createdBy","user"),this},t.prototype.withPageable=function(t){return e.prototype.withPageable.call(this,t),this},t}(r(9456).RepositoryQueryBuilder);t.OfficeRepositoryQueryBuilder=i},7174:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeService=void 0;var i=r(7437),a=r(1548);t.OfficeService=function(e,t,r,c,u,s,f,l){return{createOffice:function(t,i){return n(void 0,void 0,void 0,(function(){var n,s,f,d;return o(this,(function(o){switch(o.label){case 0:return n=l.generate(),[4,c.findOfficeRoleByName(a.OfficeRoleType.OWNER)];case 1:return s=o.sent(),f=r.create({memberId:t,roles:[{officeRole:s}],transform:{}}),[4,e.save({invitationCode:n,createdByUserId:t,name:i.name,officeMembers:[f]})];case 2:return d=o.sent(),[4,u.createOfficeOverviewById(d.id)];case 3:return[2,o.sent()]}}))}))},findOfficeOverviewById:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,f.checkOfficeExistsById(e)];case 1:return t.sent(),[4,u.createOfficeOverviewById(e)];case 2:return[2,t.sent()]}}))}))},findOfficeDetailById:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,f.checkOfficeExistsById(e)];case 1:return t.sent(),[4,u.createOfficeDetailById(e)];case 2:return[2,t.sent()]}}))}))},findAllOfficesOverview:function(e){return n(void 0,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,u.createOfficesOverview(e)];case 1:return[2,t.sent()]}}))}))},findAllOfficesOverviewUserIsMemberByUserId:function(e,t){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return[4,r.queryBuilder().findByMemberId(e).withPageable(t).build().getMany()];case 1:return n=o.sent(),[4,r.queryBuilder().findByMemberId(e).build().getCount()];case 2:return i=o.sent(),[4,u.createOfficesOverviewsByIds(n.map((function(e){return e.officeId})))];case 3:return[2,[o.sent(),i]]}}))}))},findOfficeItemsById:function(e){return n(void 0,void 0,void 0,(function(){var r,n;return o(this,(function(o){switch(o.label){case 0:return[4,f.checkOfficeExistsById(e)];case 1:return o.sent(),[4,u.createOfficeOverviewById(e)];case 2:return r=o.sent(),[4,t.findOfficeItemsWithItemByOfficeId(e)];case 3:return n=o.sent(),[2,{office:r,items:n.map((function(e){return(0,i.mapOfficeItemToOfficeItemOverviewDto)(e)}))}]}}))}))},findOfficeMembersById:function(e){return n(void 0,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return[4,f.checkOfficeExistsById(e)];case 1:return n.sent(),[4,u.createOfficeOverviewById(e)];case 2:return t=n.sent(),[4,s.createOfficeMembersOverviewByOfficeId(e)];case 3:return r=n.sent(),[2,{office:t,members:r}]}}))}))},updateOfficeById:function(t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,f.checkOfficeExistsById(t)];case 1:return n.sent(),[4,e.save({id:t,name:r.name})];case 2:return n.sent(),[2,u.createOfficeOverviewById(t)]}}))}))},deleteOfficeById:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,f.checkOfficeExistsById(t)];case 1:return r.sent(),[4,e.softDelete(t)];case 2:return r.sent(),[2]}}))}))}}}},6456:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeSocketHandler=void 0;var i=r(4491);t.OfficeSocketHandler=function(e,t){var r=(0,i.createOfficeMemberSocketService)(e,t);t.on("office_member:join",(function(e){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,r.onJoinToOfficeRoom(e)];case 1:return o.sent(),t.on("office_member:move",(function(e){r.onMemberMove(e)})),t.on("office_item:create",(function(e){})),t.on("office_item:move",(function(e){})),t.on("office_item:delete",(function(e){})),t.on("disconnect",(function(){r.onMemberDisconnect()})),[3,3];case 2:return n=o.sent(),t.emit("office:error",n),[3,3];case 3:return[2]}}))}))}))}},1241:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeValidate=void 0;var i=r(2720),a=r(2100);t.OfficeValidate=function(e){return{checkOfficeExistsById:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsOfficeById(t)];case 1:if(!r.sent())throw new i.NotFoundError(a.OfficeErrorMessages.OFFICE_NOT_FOUND);return[2]}}))}))}}}},8547:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordEncoder=void 0;var o=n(r(2275)),i=r(7096);t.PasswordEncoder=function(){return{encode:function(e){return(0,i.hashSync)(e,o.default.auth.BCRYPT_SALT_ROUNDS)}}}},2586:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenCreator=void 0,t.PasswordResetTokenCreator=function(){return{mapPasswordResetTokenToPasswordResetTokenDto:function(e){return{id:e.id,userId:e.userId,passwordResetToken:e.passwordResetToken,passwordResetTokenExpired:e.passwordResetTokenExpired,createdAt:e.createdAt}}}}},3134:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetToken=void 0;var c=r(5250),u=r(777),s=r(4614),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)({name:"user_id"}),a("design:type",Number)],t.prototype,"userId",void 0),i([(0,c.Column)({unique:!0,name:"password_reset_token"}),a("design:type",String)],t.prototype,"passwordResetToken",void 0),i([(0,c.Column)({name:"password_reset_token_expired"}),a("design:type",Date)],t.prototype,"passwordResetTokenExpired",void 0),i([(0,c.OneToOne)((function(){return s.User})),(0,c.JoinColumn)({name:"user_id"}),a("design:type",s.User)],t.prototype,"user",void 0),i([(0,c.Entity)({name:"password_reset_token"})],t)}(u.BaseEntity);t.PasswordResetToken=f},2752:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenMessages=void 0,t.PasswordResetTokenMessages={TOKEN_EXPIRED:"Password reset token expired",TOKEN_INVALID:"Password reset token invalid"}},1538:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPasswordResetTokenCreator=t.createPasswordResetTokenService=t.createPasswordResetTokenRepository=void 0;var n=r(5250),o=r(2586),i=r(9070),a=r(9894);t.createPasswordResetTokenRepository=function(){return(0,n.getCustomRepository)(i.PasswordResetTokenRepository)},t.createPasswordResetTokenService=function(){var e=(0,t.createPasswordResetTokenRepository)(),r=(0,t.createPasswordResetTokenCreator)();return(0,a.PasswordResetTokenService)(e,r)},t.createPasswordResetTokenCreator=function(){return(0,o.PasswordResetTokenCreator)()}},9070:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenRepository=void 0;var u=r(5250),s=r(7325),f=r(3134),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.findOne({where:{passwordResetToken:e}})];case 1:return[2,t.sent()]}}))}))},t.prototype.deleteByUserId=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.softDelete({userId:e})];case 1:return t.sent(),[2]}}))}))},i([(0,u.EntityRepository)(f.PasswordResetToken)],t)}(s.BaseRepository);t.PasswordResetTokenRepository=l},9894:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenService=void 0;var c=a(r(6113)),u=a(r(2275)),s=r(2720),f=r(2752);t.PasswordResetTokenService=function(e,t){function r(e){return c.default.createHash("sha256").update(e).digest("hex")}return{findByToken:function(r){return o(void 0,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,e.findByToken(r)];case 1:if(!(n=o.sent()))throw new s.NotFoundError(f.PasswordResetTokenMessages.TOKEN_INVALID);return[2,t.mapPasswordResetTokenToPasswordResetTokenDto(n)]}}))}))},createToken:function(a){return o(void 0,void 0,void 0,(function(){var o,s,f;return i(this,(function(i){switch(i.label){case 0:return o=c.default.randomBytes(u.default.auth.RESET_PASSWORD_TOKEN_LENGTH).toString("hex"),s=r(o),[4,e.save({userId:a,passwordResetToken:o,passwordResetTokenExpired:new Date(Date.now()+u.default.auth.RESET_PASSWORD_TOKEN_EXPIRES_TIME)})];case 1:return f=i.sent(),[2,t.mapPasswordResetTokenToPasswordResetTokenDto(n(n({},f),{passwordResetToken:s}))]}}))}))},validateToken:function(t){return o(void 0,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=r(t),[4,e.findByToken(n)];case 1:if(!(o=i.sent()))throw new s.IllegalArgumentError(f.PasswordResetTokenMessages.TOKEN_INVALID);if(o.passwordResetTokenExpired.getTime()<Date.now())throw new s.IllegalArgumentError(f.PasswordResetTokenMessages.TOKEN_EXPIRED);return[2,!0]}}))}))},deleteByUserId:function(t){return o(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,e.softDelete(t)];case 1:return r.sent(),[2]}}))}))}}}},4574:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenStatus=void 0,(r=t.RefreshTokenStatus||(t.RefreshTokenStatus={})).ACTIVE="active",r.BLOCKED="blocked"},3669:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshToken=void 0;var c=r(5250),u=r(4614),s=r(4574),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)(),a("design:type",String)],t.prototype,"token",void 0),i([(0,c.Column)({name:"user_id"}),a("design:type",Number)],t.prototype,"userId",void 0),i([(0,c.Column)({type:"enum",enum:s.RefreshTokenStatus,default:s.RefreshTokenStatus.ACTIVE}),a("design:type",String)],t.prototype,"status",void 0),i([(0,c.Column)({name:"expires_at"}),a("design:type",Date)],t.prototype,"expiresAt",void 0),i([(0,c.ManyToOne)((function(){return u.User})),(0,c.JoinColumn)({name:"user_id"}),a("design:type",u.User)],t.prototype,"user",void 0),i([(0,c.Entity)({name:"refresh_token"}),(0,c.Index)(["token","userId"],{unique:!0})],t)}(r(777).BaseEntity);t.RefreshToken=f},1663:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenRepository=void 0;var u=r(5250),s=r(7325),f=r(3669),l=r(4574),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.existsTokenByUserId=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.count({where:{userId:e}})];case 1:return[2,1===t.sent()]}}))}))},t.prototype.findByTokenAndUserId=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.findOne({where:{userId:e,token:t}})];case 1:return[2,r.sent()]}}))}))},t.prototype.findByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.findOne({where:{token:e}})];case 1:return[2,t.sent()]}}))}))},t.prototype.deleteByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.softDelete({token:e})];case 1:return t.sent(),[2]}}))}))},t.prototype.blockByToken=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.update({token:e},{status:l.RefreshTokenStatus.BLOCKED})];case 1:return t.sent(),[2]}}))}))},i([(0,u.EntityRepository)(f.RefreshToken)],t)}(s.BaseRepository);t.RefreshTokenRepository=d},6237:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UserLoginProvider=void 0,(r=t.UserLoginProvider||(t.UserLoginProvider={})).GOOGLE="google",r.FACEBOOK="facebook",r.LOCAL="local"},7927:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UserRoleType=void 0,(r=t.UserRoleType||(t.UserRoleType={})).ADMIN="admin",r.USER="user"},6648:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UserStatus=void 0,(r=t.UserStatus||(t.UserStatus={})).ACTIVE="active",r.INACTIVE="inactive",r.BLOCKED="blocked"},8927:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"name",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"email",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"password",void 0),n([(0,a.IsDefined)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"passwordConfirm",void 0),e}();t.CreateUserDto=c},4036:function(e,t,r){var n=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=void 0;var i=r(136),a=r(5849),c=function(){function e(){}return n([(0,i.Expose)(),o("design:type",String)],e.prototype,"name",void 0),n([(0,a.IsPhoneNumber)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"phone",void 0),n([(0,a.IsUrl)(),(0,i.Expose)(),o("design:type",String)],e.prototype,"avatar",void 0),e}();t.UpdateUserDto=c},6146:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(7581),t)},7581:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserRouter=void 0;var n=r(6860),o=r(6901),i=r(7927),a=r(24),c=r(6586);t.UserRouter=function(){var e=(0,n.Router)(),t=(0,o.createAuthMiddleware)(),r=(0,c.createUserService)(),u=(0,a.UserController)(r);return e.use("/",t.protect),e.route("/me/profile").get(u.getProfile).patch(u.updateProfile),e.route("/:id").all(t.restrictTo([i.UserRoleType.ADMIN])).get(u.getUserById).patch(u.updateUser).delete(u.deleteUser),e.route("/").all(t.restrictTo([i.UserRoleType.ADMIN])).post(u.createUser).get(u.getUsers),e}},24:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0;var i=r(7500),a=r(2720),c=r(3015),u=r(5718),s=r(8927),f=r(4036);t.UserController=function(e){return{createUser:(0,c.catchAsyncRequestHandler)((function(t,r,c){return n(void 0,void 0,void 0,(function(){var n,c,f;return o(this,(function(o){switch(o.label){case 0:return[4,(0,u.validateRequestBody)(s.CreateUserDto,t.body)];case 1:if((n=o.sent()).length>0)throw new a.IllegalArgumentError("Invalid user data",n);return c=t.body,[4,e.createLocalUser(c)];case 2:return f=o.sent(),r.status(i.HttpStatusCode.CREATED).json({message:"User created successfully",user:f}),[2]}}))}))})),getProfile:(0,c.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n=t.user.id,[4,e.findUserById(n)];case 1:return a=o.sent(),r.status(i.HttpStatusCode.OK).json(a),[2]}}))}))})),updateProfile:(0,c.catchAsyncRequestHandler)((function(t,r,c){return n(void 0,void 0,void 0,(function(){var n,c,s,l;return o(this,(function(o){switch(o.label){case 0:return n=t.user.id,[4,(0,u.validateRequestBody)(f.UpdateUserDto,t.body)];case 1:if((c=o.sent()).length>0)throw new a.IllegalArgumentError("Invalid update user data",c);return s=t.body,[4,e.updateUserById(n,s)];case 2:return l=o.sent(),r.status(i.HttpStatusCode.OK).json(l),[2]}}))}))})),getUserById:(0,c.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n,a;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.findUserById(n)];case 1:return a=o.sent(),r.status(i.HttpStatusCode.OK).json(a),[2]}}))}))})),updateUser:(0,c.catchAsyncRequestHandler)((function(t,r,c){return n(void 0,void 0,void 0,(function(){var n,c,s,l;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,(0,u.validateRequestBody)(f.UpdateUserDto,t.body)];case 1:if((c=o.sent()).length>0)throw new a.IllegalArgumentError("Invalid update user data",c);return s=t.body,[4,e.updateUserById(n,s)];case 2:return l=o.sent(),r.status(i.HttpStatusCode.OK).json(l),[2]}}))}))})),deleteUser:(0,c.catchAsyncRequestHandler)((function(t,r,a){return n(void 0,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return n=+t.params.id,[4,e.deleteUserById(n)];case 1:return o.sent(),r.status(i.HttpStatusCode.OK).json({message:"User deleted successfully"}),[2]}}))}))})),getUsers:(0,c.catchAsyncRequestHandler)((function(e,t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(e){return[2]}))}))}))}}},3066:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserCreator=void 0,t.UserCreator=function(){return{userEntityToUserDto:function(e){return{id:e.id,name:e.name,email:e.email,avatar:e.avatar,phone:e.phone,status:e.status,provider:e.provider,externalId:e.externalId,createdAt:e.createdAt}}}}},4614:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var c=r(5250),u=r(777),s=r(6237),f=r(7927),l=r(6648),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),i([(0,c.PrimaryGeneratedColumn)(),a("design:type",Number)],t.prototype,"id",void 0),i([(0,c.Column)(),a("design:type",String)],t.prototype,"name",void 0),i([(0,c.Column)(),(0,c.Index)("email_idx",{unique:!0}),a("design:type",String)],t.prototype,"email",void 0),i([(0,c.Column)({nullable:!0}),a("design:type",String)],t.prototype,"phone",void 0),i([(0,c.Column)({nullable:!0}),a("design:type",String)],t.prototype,"password",void 0),i([(0,c.Column)({nullable:!0}),a("design:type",String)],t.prototype,"avatar",void 0),i([(0,c.Column)({type:"enum",enum:s.UserLoginProvider,default:s.UserLoginProvider.LOCAL}),a("design:type",String)],t.prototype,"provider",void 0),i([(0,c.Column)({nullable:!0,name:"external_id"}),a("design:type",String)],t.prototype,"externalId",void 0),i([(0,c.Column)({type:"enum",enum:f.UserRoleType,default:f.UserRoleType.USER}),a("design:type",String)],t.prototype,"type",void 0),i([(0,c.Column)({type:"enum",enum:l.UserStatus,default:l.UserStatus.INACTIVE}),a("design:type",String)],t.prototype,"status",void 0),i([(0,c.Entity)({name:"user"})],t)}(u.BaseEntity);t.User=d},2148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserErrorMessage=void 0,t.UserErrorMessage={REGISTRATION_MISMATCH_PASSWORD:"Password and confirm password do not match",REGISTRATION_EMAIL_EXISTED:"Email already exists",USER_NOT_FOUND:"User not found"}},6586:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createUserValidate=t.createUserCreator=t.createUserService=t.createUserRepository=void 0;var n=r(5250),o=r(8547),i=r(3066),a=r(7122),c=r(8111),u=r(3746);function s(){return(0,n.getCustomRepository)(a.UserRepository)}function f(){return(0,i.UserCreator)()}function l(){var e=s();return(0,u.UserValidate)(e)}t.createUserRepository=s,t.createUserService=function(){var e=s(),t=l(),r=f(),n=(0,o.PasswordEncoder)();return(0,c.UserService)(e,t,r,n)},t.createUserCreator=f,t.createUserValidate=l},9857:function(e,t){var r=this&&this.__rest||function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.mapUserToUserOverviewDto=t.mapUserToUserDto=void 0,t.mapUserToUserDto=function(e){return e.password,r(e,["password"])},t.mapUserToUserOverviewDto=function(e){return{id:e.id,name:e.name,avatar:e.avatar}}},7122:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserRepository=void 0;var u=r(5250),s=r(4614),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.findUserByEmail=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.findOne({where:{email:e}})];case 1:return[2,t.sent()]}}))}))},t.prototype.findUserByExternalId=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.findOne({where:{externalId:e,provider:t}})];case 1:return[2,r.sent()]}}))}))},t.prototype.existsUserById=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.count({where:{id:e}})];case 1:return[2,1===t.sent()]}}))}))},t.prototype.existsUserByEmail=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.count({where:{email:e}})];case 1:return[2,1===t.sent()]}}))}))},t.prototype.updatePasswordByUserId=function(e,t){return a(this,void 0,void 0,(function(){return c(this,(function(r){switch(r.label){case 0:return[4,this.update({id:e},{password:t})];case 1:return r.sent(),[2]}}))}))},i([(0,u.EntityRepository)(s.User)],t)}(r(7325).BaseRepository);t.UserRepository=f},8111:function(e,t,r){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;var c=a(r(2275)),u=r(7096),s=r(6648);t.UserService=function(e,t,r,a){return{createLocalUser:function(a){return o(void 0,void 0,void 0,(function(){var o,s;return i(this,(function(i){switch(i.label){case 0:return[4,t.checkCreateUserData(a)];case 1:return i.sent(),o=(0,u.hashSync)(a.password,c.default.auth.BCRYPT_SALT_ROUNDS),[4,e.save(n(n({},a),{password:o}))];case 2:return s=i.sent(),[2,r.userEntityToUserDto(s)]}}))}))},findOrCreateUserByExternal:function(t){return o(void 0,void 0,void 0,(function(){var o,a;return i(this,(function(i){switch(i.label){case 0:return[4,e.findUserByExternalId(t.externalId,t.provider)];case 1:return(o=i.sent())?[2,r.userEntityToUserDto(o)]:[4,e.save(n({},t))];case 2:return a=i.sent(),[2,r.userEntityToUserDto(a)]}}))}))},findUserById:function(n){return o(void 0,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return[4,t.checkUserExistsById(n)];case 1:return i.sent(),[4,e.findById(n)];case 2:return o=i.sent(),[2,r.userEntityToUserDto(o)]}}))}))},findUserByEmail:function(n){return o(void 0,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return[4,t.checkUserExistsByEmail(n)];case 1:return i.sent(),[4,e.findUserByEmail(n)];case 2:return o=i.sent(),[2,r.userEntityToUserDto(o)]}}))}))},updateUserById:function(a,c){return o(void 0,void 0,void 0,(function(){var o,u;return i(this,(function(i){switch(i.label){case 0:return[4,t.checkUserExistsById(a)];case 1:return i.sent(),[4,e.findById(a)];case 2:return o=i.sent(),[4,e.save(n(n({},o),c))];case 3:return u=i.sent(),[2,r.userEntityToUserDto(u)]}}))}))},updatePasswordById:function(c,u){return o(void 0,void 0,void 0,(function(){var o,s,f;return i(this,(function(i){switch(i.label){case 0:return[4,t.checkUpdatePasswordData(c,u)];case 1:return i.sent(),[4,e.findById(c)];case 2:return o=i.sent(),s=a.encode(u.password),[4,e.save(n(n({},o),{password:s}))];case 3:return f=i.sent(),[2,r.userEntityToUserDto(f)]}}))}))},deleteUserById:function(r){return o(void 0,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,t.checkUserExistsById(r)];case 1:return n.sent(),[4,e.softDelete(r)];case 2:return n.sent(),[2]}}))}))},blockUserById:function(t){return o(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,e.update(t,{status:s.UserStatus.BLOCKED})];case 1:return[2,r.sent().affected||0]}}))}))},activeNewUser:function(t){return o(void 0,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,e.save({id:t,status:s.UserStatus.ACTIVE})];case 1:return[2,r.sent()]}}))}))}}}},3746:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserValidate=void 0;var i=r(2720),a=r(2148);t.UserValidate=function(e){var t=function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsUserById(t)];case 1:if(!r.sent())throw new i.IllegalArgumentError(a.UserErrorMessage.USER_NOT_FOUND);return[2]}}))}))},r=function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsUserByEmail(t)];case 1:if(r.sent())throw new i.IllegalArgumentError(a.UserErrorMessage.REGISTRATION_EMAIL_EXISTED);return[2]}}))}))},c=function(e,t){if(e!==t)throw new i.IllegalArgumentError(a.UserErrorMessage.REGISTRATION_MISMATCH_PASSWORD)};return{checkCreateUserData:function(e){return n(void 0,void 0,void 0,(function(){var t,n,i;return o(this,(function(o){switch(o.label){case 0:return t=e.email,n=e.password,i=e.passwordConfirm,[4,c(n,i)];case 1:return o.sent(),[4,r(t)];case 2:return o.sent(),[2]}}))}))},checkUpdatePasswordData:function(e,r){return n(void 0,void 0,void 0,(function(){var n,i;return o(this,(function(o){switch(o.label){case 0:return n=r.password,i=r.confirmPassword,[4,t(e)];case 1:return o.sent(),[4,c(n,i)];case 2:return o.sent(),[2]}}))}))},checkUserExistsById:t,checkUserExistsByEmail:function(t){return n(void 0,void 0,void 0,(function(){return o(this,(function(r){switch(r.label){case 0:return[4,e.existsUserByEmail(t)];case 1:if(!r.sent())throw new i.IllegalArgumentError(a.UserErrorMessage.USER_NOT_FOUND);return[2]}}))}))}}}},206:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.appConfig=void 0,n(r(5142)).default.config({path:".env"}),t.appConfig={NODE_ENV:"development",PORT:"8000",SERVER_DOMAIN:"http://localhost:8000"}},747:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authConfig=void 0,n(r(5142)).default.config({path:".env"}),t.authConfig={JWT_ISSUER:"virtualspace.com",JWT_SECRET:"virtual_working_space_hey_say_yeah@123A!a",JWT_ACCESS_TOKEN_EXPIRES_TIME:18e5,REFRESH_TOKEN_EXPIRES_TIME:2592e6,REFRESH_TOKEN_LENGTH:21,BCRYPT_SALT_ROUNDS:12,ACTIVE_USER_TOKEN_LENGTH:21,RESET_PASSWORD_TOKEN_LENGTH:21,RESET_PASSWORD_TOKEN_EXPIRES_TIME:6e5,GOOGLE_CLIENT_ID:"681800350859-vsf8ivj8v9edj08ilic2n65rn54rflvm.apps.googleusercontent.com",GOOGLE_CLIENT_SECRET:"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",FACEBOOK_CLIENT_ID:"633458094420471",FACEBOOK_CLIENT_SECRET:"2dbc3881b83f872f24e20b57c08d0af8",BASE_FRONTEND_URL:"http://localhost:3000"}},7054:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cloudConfig=void 0,n(r(5142)).default.config({path:".env"}),t.cloudConfig={IMAGE_CLOUDINARY_CLOUD_NAME:"dcm0ibm0b",IMAGE_CLOUDINARY_API_KEY:"475847384496143",IMAGE_CLOUDINARY_API_SECRET:"BAC-1qSKBIcMXcdHc-Cyx7qwqHQ",MODEL_AWS_BUCKET_REGION:"us-east-1",MODEL_AWS_BUCKET_NAME:"vispace-model",MODEL_AWS_BUCKET_ACCESS_KEY:"AKIAVH75JNSOYVSY2T4Q",MODEL_AWS_BUCKET_SECRET_KEY:"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"}},6898:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(1721)),i=n(r(2797));t.default={mongo:o.default,pg:i.default}},1721:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5142)).default.config({path:".env"});t.default={DB_HOST:"localhost",DB_USERNAME:"ndmt1at21",DB_PASSWORD:"137126",DB_NAME:"virtualspace",DB_PORT:27017}},2797:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(r(5142)).default.config({path:".env"});t.default={DB_HOST:"localhost",DB_USERNAME:"ndmt1at21",DB_PASSWORD:"1372000Aa",DB_NAME:"virtualspace",DB_PORT:5432}},8853:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.emailConfig=void 0,n(r(5142)).default.config({path:".env"}),t.emailConfig={EMAIL_SERVICE_NAME:"mailtrap",EMAIL_SERVICE_HOST:"smtp.mailtrap.io",EMAIL_SERVICE_PORT:2525,EMAIL_SERVICE_USERNAME:"c8d46a513d8bf6",EMAIL_SERVICE_PASSWORD:"5767089e727b7f"}},2275:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(6898)),i=r(206),a=r(747),c=r(8853),u=r(7054),s={app:i.appConfig,db:o.default,auth:a.authConfig,mail:c.emailConfig,cloud:u.cloudConfig};t.default=s},6775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderConstants=void 0,t.HeaderConstants={TOTAL_COUNT:"x-total-count",PAGE_NUMBER:"x-page-number",PAGE_SIZE:"x-page-size",REFRESH_TOKEN:"x-refresh-token",ACCESS_TOKEN:"Authorization",X_FORWARDED_FOR:"x-forwarded-for"}},7500:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HttpStatusCode=void 0;var r=function(){function e(){}return e.OK=200,e.CREATED=201,e.BAD_REQUEST=400,e.INTERNAL_SERVER_ERROR=500,e.UNAUTHORIZED=401,e.FORBIDDEN=403,e.NOT_FOUND=404,e.TOO_MANY_REQUESTS=429,e}();t.HttpStatusCode=r},7728:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(3236);var a=i(r(3685)),c=i(r(6860)),u=r(206),s=r(7767),f=r(4925);n(void 0,void 0,void 0,(function(){var e,t,r;return o(this,(function(n){switch(n.label){case 0:e=(0,c.default)(),t=a.default.createServer(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(0,f.mainAppLoaders)(e,s.serverLogger)];case 2:return n.sent(),(0,f.socketServerLoader)(t,s.serverLogger),(0,f.httpServerLoader)(t,u.appConfig.PORT,s.serverLogger),[3,4];case 3:return r=n.sent(),s.serverLogger.error(r),[3,4];case 4:return[2]}}))}))},2720:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TooManyRequestError=t.UnauthorizedError=t.IllegalArgumentError=t.NotFoundError=t.AppError=void 0;var i=r(7500),a=function(e){function t(t,r,n){var o=e.call(this)||this;return o.isOperational=!0,o.status="error",o.statusCode=t,o.message=r,o.errors=n||[],Error.captureStackTrace(o,o.constructor),o}return o(t,e),t}(Error);t.AppError=a;var c=function(e){function t(t){return e.call(this,i.HttpStatusCode.NOT_FOUND,t)||this}return o(t,e),t}(a);t.NotFoundError=c;var u=function(e){function t(t,r){return e.call(this,i.HttpStatusCode.BAD_REQUEST,t,r)||this}return o(t,e),t}(a);t.IllegalArgumentError=u;var s=function(e){function t(t){return e.call(this,i.HttpStatusCode.UNAUTHORIZED,t)||this}return o(t,e),t}(a);t.UnauthorizedError=s;var f=function(e){function t(t){return e.call(this,i.HttpStatusCode.TOO_MANY_REQUESTS,t)||this}return o(t,e),t}(a);t.TooManyRequestError=f},3015:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchAsyncRequestHandler=void 0,t.catchAsyncRequestHandler=function(e){return function(t,r,n){e(t,r,n).catch((function(e){return n(e)}))}}},5021:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchAsyncSocketMiddleware=void 0,t.catchAsyncSocketMiddleware=function(e){return function(t,r){e(t,r).catch((function(e){return r(e)}))}}},1624:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pageParser=void 0,t.pageParser=function(e,t){var r=t.defaultPage,n=void 0===r?1:r,o=t.defaultSize,i=void 0===o?10:o;return{page:e.page||n,size:e.size||i}}},5718:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function c(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}u((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateRequestBody=void 0;var i=r(136),a=r(5849);t.validateRequestBody=function(e,t){return n(void 0,void 0,void 0,(function(){var r,n,c;return o(this,(function(o){switch(o.label){case 0:return r=(0,i.plainToInstance)(e,t),[4,(0,a.validate)(r,{skipMissingProperties:!0})];case 1:return n=o.sent(),c=[],n.forEach((function(e){var t,r=e.property,n=e.constraints;if(n){var o=Object.keys(n)[0];c.push(((t={})[r]=n[o],t))}})),[2,c]}}))}))}},9336:e=>{e.exports=require("aws-sdk")},7096:e=>{e.exports=require("bcrypt")},7068:e=>{e.exports=require("bull")},136:e=>{e.exports=require("class-transformer")},5849:e=>{e.exports=require("class-validator")},3518:e=>{e.exports=require("cloudinary")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},2097:e=>{e.exports=require("handlebars")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},9470:e=>{e.exports=require("morgan")},1738:e=>{e.exports=require("multer")},754:e=>{e.exports=require("nanoid")},5184:e=>{e.exports=require("nodemailer")},3511:e=>{e.exports=require("passport")},3210:e=>{e.exports=require("passport-facebook")},8117:e=>{e.exports=require("passport-google-oauth2")},9103:e=>{e.exports=require("query-string")},7558:e=>{e.exports=require("redis")},3236:e=>{e.exports=require("reflect-metadata")},3952:e=>{e.exports=require("socket.io")},4708:e=>{e.exports=require("streamifier")},5250:e=>{e.exports=require("typeorm")},5828:e=>{e.exports=require("uuid")},7773:e=>{e.exports=require("winston")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},1017:e=>{e.exports=require("path")},3837:e=>{e.exports=require("util")}},t={},r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(7728);module.exports=r})();