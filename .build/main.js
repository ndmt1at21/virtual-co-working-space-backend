(()=>{"use strict";var e={650:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveTokenErrorMessages=void 0,t.ActiveTokenErrorMessages={INVALID_TOKEN:"Token is not valid or has expired. Please request a new one"}},495:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserToken=void 0;const n=o(5250),s=o(777),c=o(4614);let a=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],a.prototype,"id",void 0),r([(0,n.Column)({name:"user_id"}),i("design:type",Number)],a.prototype,"userId",void 0),r([(0,n.Column)({unique:!0}),i("design:type",String)],a.prototype,"token",void 0),r([(0,n.OneToOne)((()=>c.User)),i("design:type",c.User)],a.prototype,"user",void 0),a=r([(0,n.Entity)({name:"active_user_token"}),(0,n.Index)(["token"],{unique:!0})],a),t.ActiveUserToken=a},389:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createActiveUserTokenService=void 0;const r=o(5250),i=o(6476),n=o(8762);t.createActiveUserTokenService=()=>{const e=(0,r.getCustomRepository)(i.ActiveUserTokenRepository);return(0,n.ActiveUserTokenService)(e)}},6476:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserTokenRepository=void 0;const n=o(5250),s=o(7325),c=o(495);let a=class extends s.BaseRepository{findByToken(e){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{token:e}})}))}deleteByToken(e){return i(this,void 0,void 0,(function*(){return(yield this.createQueryBuilder().delete().where("token = :token",{token:e}).execute()).affected||0}))}findByUserIdAndToken(e,t){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{userId:e,token:t}})}))}};a=r([(0,n.EntityRepository)(c.ActiveUserToken)],a),t.ActiveUserTokenRepository=a},8762:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserTokenService=void 0;const n=i(o(6113)),s=i(o(2275)),c=o(2720),a=o(650),d=o(495);t.ActiveUserTokenService=e=>({createToken:t=>r(void 0,void 0,void 0,(function*(){const o=n.default.randomBytes(s.default.auth.ACTIVE_USER_TOKEN_LENGTH).toString("hex"),r=yield e.createQueryBuilder().insert().into(d.ActiveUserToken).values({userId:t,token:o}).execute();return Object.assign({},r.raw[0])})),validateToken:(t,o)=>r(void 0,void 0,void 0,(function*(){if(!(yield e.findByUserIdAndToken(t,o)))throw new c.IllegalArgumentError(a.ActiveTokenErrorMessages.INVALID_TOKEN);return!0})),deleteToken:t=>r(void 0,void 0,void 0,(function*(){return yield e.deleteByToken(t)}))})},4925:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.socketServerLoader=t.httpServerLoader=t.mainAppLoaders=void 0;const i=o(3952),n=o(7886),s=o(8483),c=o(4188),a=o(5141),d=o(8309);t.mainAppLoaders=(e,t)=>r(void 0,void 0,void 0,(function*(){yield(0,s.connectDatabase)(),t.info("Database connection has been established successfully."),yield(0,s.initDatabase)(),t.info("Database has been initialized successfully."),yield(0,a.createMessageQueues)(),t.info("Message queues have been created successfully."),yield(0,c.loadServices)(),t.info("Services have been loaded successfully."),(0,c.loadBackgroundJobs)(),t.info("Background jobs have been loaded successfully."),(0,c.mainMiddleware)(e,t),t.info("Middleware has been loaded."),(0,c.mainRoutes)(e),t.info("Routes have been loaded."),e.use(n.globalErrorHandler),t.info("Global error handler has been loaded.")})),t.httpServerLoader=(e,t,o)=>(e.listen(t,(()=>{o.info(`Http server is listening on port ${t}`)})),process.on("uncaughtException",(t=>{o.error("UNCAUGHT EXCEPTION: "+t.message),e.close((()=>{process.exit(1)}))})),e),t.socketServerLoader=(e,t)=>{const o=new i.Server(e,{cors:{origin:["http://localhost:3000","https://vispace.tech"]},transports:["polling","websocket"],path:"/socket.io"});return t.info("Socket server is initialized."),(0,d.socketEventHandlers)(o),t.info("Socket event handlers has been loaded."),o}},366:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createCacheConnection=t.getCacheConnection=void 0;const i=o(7558),n={};t.getCacheConnection=e=>{const t=n[e];if(!t)throw new Error("Cache connection not found");return t},t.createCacheConnection=e=>r(void 0,void 0,void 0,(function*(){const t=e.map((e=>r(void 0,void 0,void 0,(function*(){yield function(e,t){return r(this,void 0,void 0,(function*(){const o=(0,i.createClient)(t);return yield o.connect(),n[e]=o,o.on("error",(e=>{throw e})),o.on("connect",(()=>{n[e]=o})),o}))}(e.connName,e.options)}))));yield Promise.all(t)}))},8483:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)},n=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.connectDatabase=void 0;const c=s(o(2275)),a=o(495),d=o(1993),f=o(2965),u=o(5970),l=o(1230),v=o(1500),p=o(4843),y=o(3134),m=o(3669),_=o(4614),h=o(5250),O=o(366),E=o(478),g={type:"postgres",host:c.default.db.pg.DB_HOST,port:c.default.db.pg.DB_PORT,username:c.default.db.pg.DB_USERNAME,password:c.default.db.pg.DB_PASSWORD,database:c.default.db.pg.DB_NAME,dropSchema:!1,synchronize:!0,entities:[_.User,m.RefreshToken,a.ActiveUserToken,y.PasswordResetToken,d.Item,p.Office,f.OfficeItem,u.OfficeMember,v.OfficeRole,l.OfficeMemberTransform,E.OfficeMemberRole]},R=(c.default.db.mongo.DB_HOST,c.default.db.mongo.DB_PORT,c.default.db.mongo.DB_USERNAME,c.default.db.mongo.DB_PASSWORD,c.default.db.mongo.DB_NAME,{connName:"officeMemberTransform",options:{socket:{port:6379,host:"localhost"}}}),b={connName:"mail",options:{socket:{port:6380,host:"localhost"}}},I={connName:"officeMember",options:{socket:{port:6381,host:"localhost"}}};t.connectDatabase=()=>n(void 0,void 0,void 0,(function*(){return new Promise(((e,t)=>n(void 0,void 0,void 0,(function*(){try{yield(0,h.createConnection)(g),yield(0,O.createCacheConnection)([R,b,I]),e()}catch(e){t("Unable to connect to database: "+e.message)}}))))})),i(o(5370),t)},5370:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.initDatabase=void 0;const i=o(3913),n=o(5250);t.initDatabase=()=>r(void 0,void 0,void 0,(function*(){try{const e=(0,n.getCustomRepository)(i.OfficeRoleRepository);yield e.save([{name:"OWNER"},{name:"ADMIN"},{name:"MEMBER"}])}catch(e){}}))},4188:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadServices=t.loadBackgroundJobs=t.mainRoutes=t.mainMiddleware=void 0;const r=o(2494);Object.defineProperty(t,"mainMiddleware",{enumerable:!0,get:function(){return r.mainMiddleware}});const i=o(2435);Object.defineProperty(t,"mainRoutes",{enumerable:!0,get:function(){return i.mainRoutes}});const n=o(5074);Object.defineProperty(t,"loadBackgroundJobs",{enumerable:!0,get:function(){return n.loadBackgroundJobs}});const s=o(1567);Object.defineProperty(t,"loadServices",{enumerable:!0,get:function(){return s.loadServices}})},5074:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadBackgroundJobs=void 0;const r=o(3574);t.loadBackgroundJobs=()=>{(0,r.loadAuthBackgroundJobs)()}},2494:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.mainMiddleware=void 0;const i=r(o(3582)),n=r(o(7806)),s=r(o(9470)),c=r(o(6860)),a=o(206),d=o(4420);t.mainMiddleware=(e,t)=>{const o="production"===a.appConfig.NODE_ENV;e.use(c.default.json()),e.use(c.default.urlencoded({extended:!0})),e.use(c.default.static("public")),e.use((0,d.rateLimiting)({maxPerIp:50,timeMs:1e4})),e.use((0,n.default)({contentSecurityPolicy:o,crossOriginEmbedderPolicy:o})),e.use((0,i.default)({origin:["http://localhost:3000","https://vispace.tech"],credentials:!0,exposedHeaders:["x-total-count","x-refresh-token","x-access-token"]})),e.use((0,s.default)(':remote-addr - :remote-user ":method :url HTTP/:http-version" :status :res[content-length] ":referrer" ":user-agent" - :response-time ms',{stream:{write:e=>t.info(e)}}))}},2435:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mainRoutes=void 0;const r=o(4860),i=o(6146),n=o(2067),s=o(1747),c=o(9817),a=o(7114),d=o(6571);t.mainRoutes=e=>{const t=(0,r.AuthRouter)(),o=(0,i.UserRouter)(),f=(0,n.ItemRouter)(),u=(0,s.OfficeRouter)(),l=(0,c.OfficeItemRouter)(),v=(0,a.OfficeMemberRouter)(),p=(0,d.CloudUploadRouter)();e.use("/api/v1/auth",t),e.use("/api/v1/users",o),e.use("/api/v1/items",f),e.use("/api/v1/offices",u),e.use("/api/v1/office-items",l),e.use("/api/v1/office-members",v),e.use("/api/v1/uploads",p)}},1567:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.loadServices=void 0;const i=o(1186),n=o(1876);t.loadServices=()=>r(void 0,void 0,void 0,(function*(){yield function(){return r(this,void 0,void 0,(function*(){const e=(0,n.createMailService)();yield e.initialize()}))}(),yield function(){return r(this,void 0,void 0,(function*(){const e=(0,i.createCloudUploadService)();yield e.initialize()}))}()}))},5141:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageQueues=void 0;const i=o(247),n={queueName:"auth_mail",options:{redis:{host:"localhost",port:6379}}};t.createMessageQueues=()=>r(void 0,void 0,void 0,(function*(){(0,i.createQueues)([n])}))},247:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createQueues=t.getQueue=void 0;const n=i(o(7068)),s={};t.getQueue=e=>{const t=s[e];if(!t)throw new Error("Queue not found");return t},t.createQueues=e=>r(void 0,void 0,void 0,(function*(){e.forEach((e=>r(void 0,void 0,void 0,(function*(){const{queueName:t,options:o}=e,r=function(e,t){return new n.default(e,t)}(t,o);s[t]=r}))))}))},8309:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketEventHandlers=t.socketMiddleware=void 0;const r=o(8801);Object.defineProperty(t,"socketMiddleware",{enumerable:!0,get:function(){return r.socketMiddleware}});const i=o(8084);Object.defineProperty(t,"socketEventHandlers",{enumerable:!0,get:function(){return i.socketEventHandlers}})},8084:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketEventHandlers=void 0;const r=o(1689),i=o(4903);t.socketEventHandlers=e=>{const t=(0,r.createSocketMiddleware)();e.use(t.protect),e.on("connection",(t=>{(0,i.createOfficeSocketHandler)(e,t)}))}},8801:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socketMiddleware=void 0;const r=o(1689);t.socketMiddleware=(e,t)=>{const o=(0,r.createSocketMiddleware)();e.use(o.protect)}},4420:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.rateLimiting=void 0;const i=o(2720),n=o(7558),s=o(6970),c=(0,n.createClient)();c.connect(),c.on("connect",(()=>console.log("Redis for rate limiting is connected"))),c.on("error",(e=>console.log("Redis for rate limiting error: ",e))),t.rateLimiting=({timeMs:e,maxPerIp:t})=>(c.flushAll(),(o,n,a)=>r(void 0,void 0,void 0,(function*(){const n=o.connection.remoteAddress||o.headers["x-forward-for"]||"127.0.0.1",d=yield function(e){return r(this,void 0,void 0,(function*(){return c.incr(e)}))}(n);if(1===d&&(yield function(e,t){return r(this,void 0,void 0,(function*(){return c.expire(e,t/1e3)}))}(n,e)),d>t)return a(new i.TooManyRequestError(s.RateLimitErrorMessages.RATE_LIMIT_EXCEEDED));a()})))},6970:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RateLimitErrorMessages=void 0,t.RateLimitErrorMessages={RATE_LIMIT_EXCEEDED:"Too many requests. Please try again later."}},9124:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ForgotPasswordDto=void 0;const n=o(136),s=o(5849),c=o(1204);class a{}r([(0,s.IsDefined)({message:c.AuthErrorMessages.LOGIN_MISSING_EMAIL_PASSWORD}),(0,s.IsEmail)(),(0,n.Expose)(),i("design:type",String)],a.prototype,"email",void 0),t.ForgotPasswordDto=a},8134:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.LoginDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,s.IsDefined)(),(0,s.IsEmail)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"email",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"password",void 0),t.LoginDto=c},6833:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RegisterDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,s.IsDefined)(),(0,n.Expose)(),(0,s.Length)(1,255),i("design:type",String)],c.prototype,"name",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),(0,s.IsEmail)(),i("design:type",String)],c.prototype,"email",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),(0,s.MinLength)(8,{message:"Password must have minimum eight characters"}),(0,s.Matches)(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[`~.,_=+@$!%*?&])[A-Za-z\d`~.,_=+@$!%*?&]{8,}$/,{message:"Password must have at least one uppercase letter, one lowercase letter, one number and one special character"}),i("design:type",String)],c.prototype,"password",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"passwordConfirm",void 0),t.RegisterDto=c},3136:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.ResetPasswordContentDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,s.IsDefined)(),(0,n.Expose)(),(0,s.Matches)(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[`~.,_=+@$!%*?&])[A-Za-z\d`~.,_=+@$!%*?&]{8,}$/,{message:"Password must have at least one uppercase letter, one lowercase letter, one number and one special character"}),i("design:type",String)],c.prototype,"password",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"confirmPassword",void 0),t.ResetPasswordContentDto=c},3204:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthRouter=void 0;const r=o(6860),i=o(7242),n=o(6901);t.AuthRouter=()=>{const e=(0,n.createAuthController)(),{restrictToGuest:t,protect:o}=(0,n.createAuthMiddleware)();(0,i.loadStrategies)();const s=(0,r.Router)();return s.post("/login",t,e.localLogin).post("/register",t,e.localRegister).get("/google",t,e.googleLogin).get("/facebook",t,e.facebookLogin).get("/google/callback",t,e.googleLoginCallback).get("/facebook/callback",t,e.facebookLoginCallback).post("/forgot",t,e.forgotPassword).patch("/reset/:token",t,e.resetPassword).post("/refreshToken",t,e.refreshAccessToken),s.get("/activate/:token",o,e.activateNewUser).get("/logout",o,e.logout),s}},7579:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthController=void 0;const n=i(o(3511)),s=i(o(2275)),c=i(o(9103)),a=o(7500),d=o(1204),f=o(2720),u=o(3015),l=o(6775),v=o(5718),p=o(8134),y=o(3136),m=o(9124),_=o(6833);t.AuthController=(e,t,o)=>{function i(e,r,i,a){n.default.authenticate(e,{session:!1},((r,n,u,l)=>{r&&(o.error(`Authenticating external user with provider ${e} failed. Message ${r.message}`),a(r));const v=n;if(!v)throw o.error(`Invalid external user information. Message ${r.message}`),new f.UnauthorizedError(d.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EXTERNAL);t.oauth2LoginCallback(v).then((([t,{accessToken:r,refreshToken:n}])=>{const a=c.default.stringifyUrl({url:s.default.auth.BASE_FRONTEND_URL,query:{access_token:r,refresh_token:n}});o.info(`User with id ${t.id} logged in (oauth2, provider: ${e}) successfully`),i.redirect(a)})).catch((t=>{const r=c.default.stringifyUrl({url:s.default.auth.BASE_FRONTEND_URL,query:{error:t.message.toLowerCase()}});o.error(`User with id ${n.id} logged in (oauth2, provider: ${e}) failed. Message: ${t.message}`),i.redirect(r)}))}))(r,i,a)}return{localLogin:(0,u.catchAsyncRequestHandler)(((e,i,n)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,v.validateRequestBody)(p.LoginDto,e.body);if(r.length>0)throw o.error(`User cannot login: ${r}`),new f.IllegalArgumentError("Invalid login data",r);const n=e.body,[s,{accessToken:c,refreshToken:d}]=yield t.localLogin(n);o.info(`User with id ${s.id} logged in successfully`),i.status(a.HttpStatusCode.OK).json({user:s,accessToken:c,refreshToken:d})})))),localRegister:(0,u.catchAsyncRequestHandler)(((i,n,s)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,v.validateRequestBody)(_.RegisterDto,i.body);if(r.length>0)throw o.error(`User create login: ${r}`),new f.IllegalArgumentError("Invalid register data",r);const s=i.body,{user:c,activeToken:d}=yield t.localRegister(s);o.info(`User with email ${c.email} registered successfully has id ${c.id}`),e.addRegisterConfirmationJob(c,d),n.status(a.HttpStatusCode.CREATED).json({user:c,message:"User created successfully"})})))),googleLogin:(0,u.catchAsyncRequestHandler)(((e,t,i)=>r(void 0,void 0,void 0,(function*(){n.default.authenticate("google",{session:!1,scope:["email","profile"]})(e,t,i),o.info("Success redirect to google login page")})))),facebookLogin:(0,u.catchAsyncRequestHandler)(((e,t,i)=>r(void 0,void 0,void 0,(function*(){n.default.authenticate("facebook",{session:!1,scope:["email","public_profile"]})(e,t,i),o.info("Success redirect to facebook login page")})))),googleLoginCallback:(0,u.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){i("google",e,t,o)})))),facebookLoginCallback:(0,u.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){i("facebook",e,t,o)})))),logout:(0,u.catchAsyncRequestHandler)(((e,i,n)=>r(void 0,void 0,void 0,(function*(){const r=e.headers[l.HeaderConstants.REFRESH_TOKEN];if(!r)throw o.error("Cannot logout: missing refresh token"),new f.IllegalArgumentError(d.AuthErrorMessages.LOGOUT_MISSING_REFRESH_TOKEN);yield t.logout(r),i.status(a.HttpStatusCode.OK).json({message:"User logged out successfully"})})))),refreshAccessToken:(0,u.catchAsyncRequestHandler)(((e,i,n)=>r(void 0,void 0,void 0,(function*(){const r=e.headers[l.HeaderConstants.REFRESH_TOKEN];if(!r)throw o.error("Cannot refresh access token: missing refresh token"),new f.IllegalArgumentError(d.AuthErrorMessages.REFRESH_ACCESS_TOKEN_MISSING_REFRESH_TOKEN);const n=e.user.id,{accessToken:s,refreshToken:c}=yield t.refreshAccessToken(n,r);i.status(a.HttpStatusCode.OK).json({message:"Access token renew successfully",accessToken:s,refreshToken:c})})))),forgotPassword:(0,u.catchAsyncRequestHandler)(((i,n,s)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,v.validateRequestBody)(m.ForgotPasswordDto,i.body);if(r.length>0)throw o.error(`Cannot reset password: ${r}`),new f.IllegalArgumentError("Invalid forgot password request",r);const s=i.body,c=yield t.forgotPassword(s);o.info(`Reset password token sent to email ${s.email}`),e.addResetPasswordMailJob(s.email,c.passwordResetToken),n.status(a.HttpStatusCode.OK).json({message:"Password reset token created successfully"})})))),resetPassword:(0,u.catchAsyncRequestHandler)(((e,i,n)=>r(void 0,void 0,void 0,(function*(){const r=e.params.token;if(!r)throw o.error("Cannot reset password: missing reset token"),new f.IllegalArgumentError(d.AuthErrorMessages.RESET_PASSWORD_MISSING_RESET_TOKEN);const n=yield(0,v.validateRequestBody)(y.ResetPasswordContentDto,e.body);if(n.length>0)throw o.error(`Cannot reset password: ${n}`),new f.IllegalArgumentError("Invalid reset password request",n);const s=e.body;yield t.resetPassword(Object.assign({resetToken:r},s)),i.status(a.HttpStatusCode.OK).json({message:"Password reset successfully"})})))),activateNewUser:(0,u.catchAsyncRequestHandler)(((e,o,i)=>r(void 0,void 0,void 0,(function*(){const r=e.user.id,i=e.params.token;yield t.activeNewUser(r,i),o.status(a.HttpStatusCode.OK).json({message:"User activated successfully"})}))))}}},1204:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthErrorMessages=void 0,t.AuthErrorMessages={UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD:"Your email or password were incorrect",UNAUTHORIZED_INCORRECT_EXTERNAL:"Your external login was incorrect",UNAUTHORIZED_USER_BLOCKED:"User is blocked",UNAUTHORIZED_USER_NOT_FOUND:"User not found",UNAUTHORIZED_MISSING_TOKEN:"Access token is required",UNAUTHORIZED_INVALID_TOKEN:"Access token has expired or is not yet valid",UNAUTHORIZED_ALREADY_LOGGED_IN:"You are already logged in",UNAUTHORIZED_PERMISSION_DENIED:"You do not have permission to access this resource",UNAUTHORIZED_EMAIL_NOT_VERIFIED:"Email is not verified",LOGIN_MISSING_EMAIL_PASSWORD:"Email and password are required",LOGIN_EXTERNAL_MISSING_EMAIL:"Email is required",LOGIN_EXTERNAL_USER_NOT_FOUND:"User not found",REGISTER_MISSING_EMAIL:"Email is required for registration",REGISTER_MISSING_DISPLAY_NAME:"Email is required for registration",REGISTER_MISSING_PASSWORD_OR_CONFIRM_PASSWORD:"Password and confirm password are required for registration",REGISTER_MISMATCH_CONFIRM_PASSWORD:"Password and confirm password must match",FORGOT_PASSWORD_MISSING_EMAIL:"Email is required for forgot password",RESET_PASSWORD_MISSING_RESET_TOKEN:"Reset token is required for password reset",RESET_PASSWORD_MISSING_PASSWORD_OR_CONFIRM_PASSWORD:"Password and confirm password are required for password reset",RESET_PASSWORD_MISMATCH:"Password and confirm password must match",RESET_PASSWORD_TOKEN_EXPIRED:"Reset token has expired",RESET_PASSWORD_TOKEN_INVALID:"Reset token is invalid",LOGOUT_MISSING_REFRESH_TOKEN:"Refresh token is required for logout",REFRESH_ACCESS_TOKEN_MISSING_REFRESH_TOKEN:"Refresh token is required for renew access token"}},6901:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthMailQueue=t.createAuthMailQueueProducer=t.createAuthMailWorker=t.createAuthValidate=t.createAuthMiddleware=t.createAuthService=t.createAuthController=void 0;const r=o(3241),i=o(7767),n=o(6586),s=o(7579),c=o(5658),a=o(305),d=o(9640),f=o(1538),u=o(389),l=o(5703),v=o(247),p=o(1876),y=o(8888);function m(){const e=(0,n.createUserService)(),t=(0,f.createPasswordResetTokenService)(),o=(0,r.createAuthTokenService)(),i=(0,u.createActiveUserTokenService)(),s=_();return(0,a.AuthService)(e,o,t,i,s)}function _(){const e=(0,n.createUserRepository)();return(0,d.AuthValidate)(e)}function h(){const e=O();return(0,l.AuthMailQueueProducer)(e)}function O(){return(0,v.getQueue)("auth_mail")}t.createAuthController=function(){const e=m(),t=h();return(0,s.AuthController)(t,e,i.authLogger)},t.createAuthService=m,t.createAuthMiddleware=function(){const e=(0,n.createUserRepository)(),t=(0,r.createAuthTokenService)(),o=_();return(0,c.AuthMiddleware)(e,t,o)},t.createAuthValidate=_,t.createAuthMailWorker=function(){const e=O(),t=(0,p.createMailService)(),o=i.authLogger;return(0,y.AuthMailWorker)(e,t,o)},t.createAuthMailQueueProducer=h,t.createAuthMailQueue=O},3574:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadAuthBackgroundJobs=void 0;const r=o(6901);t.loadAuthBackgroundJobs=()=>{(0,r.createAuthMailWorker)().load()}},5658:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMiddleware=void 0;const i=o(3015),n=o(1204),s=o(2720),c=o(6648);t.AuthMiddleware=(e,t,o)=>{function a(i){return r(this,void 0,void 0,(function*(){yield t.validateAccessToken(i);const r=yield t.getUserIdFromAccessToken(i);yield o.validateUserCanAccessResourceById(r);const c=yield e.findById(r);if(!c)throw new s.UnauthorizedError(n.AuthErrorMessages.UNAUTHORIZED_USER_NOT_FOUND);return c}))}return{protect:(0,i.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){var t;const r=null===(t=e.headers.authorization)||void 0===t?void 0:t.split(" ")[1];if(!r)throw new s.UnauthorizedError(n.AuthErrorMessages.UNAUTHORIZED_MISSING_TOKEN);const{id:i,type:d,email:f,status:u}=yield a(r);e.user={id:i,roles:[d],email:f,emailVerified:u===c.UserStatus.INACTIVE},o()})))),restrictTo:e=>(t,o,r)=>{const i=e.every((e=>{var o;return null===(o=t.user)||void 0===o?void 0:o.roles.includes(e)}));i&&r(),i||r(new s.UnauthorizedError(n.AuthErrorMessages.UNAUTHORIZED_PERMISSION_DENIED))},restrictToGuest:(0,i.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){var t;const r=null===(t=e.headers.authorization)||void 0===t?void 0:t.split(" ")[1];if(r&&"null"!==r&&"undefined"!==r)try{if(yield a(r))throw new s.UnauthorizedError(n.AuthErrorMessages.UNAUTHORIZED_ALREADY_LOGGED_IN)}catch(e){o()}else o()})))),restrictToEmailVerified:(0,i.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){var t;if(!(null===(t=e.user)||void 0===t?void 0:t.emailVerified))throw new s.UnauthorizedError(n.AuthErrorMessages.UNAUTHORIZED_EMAIL_NOT_VERIFIED)}))))}}},305:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthService=void 0,t.AuthService=(e,t,r,i,n)=>({localLogin:r=>o(void 0,void 0,void 0,(function*(){yield n.validateLocalUserCanLogin(r);const o=yield e.findUserByEmail(r.email),[i,s]=yield t.createAccessTokenAndRefreshToken(o.id);return[o,{accessToken:i,refreshToken:s}]})),oauth2LoginCallback:r=>o(void 0,void 0,void 0,(function*(){yield n.validateExternalUserCanLogin(r);const i=yield function(t){return o(this,void 0,void 0,(function*(){const{profileId:o,email:r,provider:i,name:n,avatar:s,phone:c}=t;return yield e.findOrCreateUserByExternal({externalId:o,email:r,provider:i,name:n,avatar:s,phone:c})}))}(r),[s,c]=yield t.createAccessTokenAndRefreshToken(i.id);return[i,{accessToken:s,refreshToken:c}]})),localRegister:t=>o(void 0,void 0,void 0,(function*(){const o=yield e.createLocalUser(t),{token:r}=yield i.createToken(o.id);return{user:o,activeToken:r}})),refreshAccessToken:(e,r)=>o(void 0,void 0,void 0,(function*(){yield t.validateRefreshTokenCanRenewAccessToken(e,r),yield t.blockRefreshToken(r);const[o,i]=yield t.createAccessTokenAndRefreshToken(e);return{accessToken:o,refreshToken:i}})),logout:e=>o(void 0,void 0,void 0,(function*(){yield t.deleteRefreshToken(e)})),forgotPassword:t=>o(void 0,void 0,void 0,(function*(){const{email:o}=t;yield n.validateUserForgotPassword(o);const i=yield e.findUserByEmail(o);return yield r.createToken(i.id)})),resetPassword:t=>o(void 0,void 0,void 0,(function*(){const{resetToken:o,password:i,confirmPassword:n}=t;yield r.validateToken(o);const s=yield r.findByToken(o),c=yield e.findUserById(s.userId);yield e.updatePasswordById(c.id,{password:i,confirmPassword:n}),yield r.deleteByUserId(c.id)})),activeNewUser:(t,r)=>o(void 0,void 0,void 0,(function*(){yield i.validateToken(t,r),yield e.activeNewUser(t),yield i.deleteToken(r)}))})},7242:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loadStrategies=void 0;const i=r(o(3511)),n=r(o(2275)),s=o(8117),c=o(3210),a=o(6237),d=o(1204);t.loadStrategies=()=>{(()=>{const e=new s.Strategy({callbackURL:"/api/v1/auth/google/callback",clientID:n.default.auth.GOOGLE_CLIENT_ID,clientSecret:n.default.auth.GOOGLE_CLIENT_SECRET},((e,t,o,r)=>0===o.emails.length?r(d.AuthErrorMessages.LOGIN_EXTERNAL_USER_NOT_FOUND,null):r(null,{email:o.emails[0],avatar:o.picture,profileId:o.id,phone:o.phone,name:o.displayName,provider:a.UserLoginProvider.GOOGLE})));i.default.use("google",e)})(),(()=>{const e=new c.Strategy({callbackURL:"/api/v1/auth/facebook/callback",clientID:n.default.auth.FACEBOOK_CLIENT_ID,clientSecret:n.default.auth.FACEBOOK_CLIENT_SECRET,profileFields:["id","email","displayName","name","photos"]},((e,t,o,r)=>0===o.emails.length?r(d.AuthErrorMessages.LOGIN_EXTERNAL_USER_NOT_FOUND,null):r(null,{email:o.emails[0].value,avatar:o.photos[0].value,profileId:o.id,phone:o.phone,name:o.displayName,provider:a.UserLoginProvider.FACEBOOK})));i.default.use("facebook",e)})()}},9640:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthValidate=void 0;const i=o(2720),n=o(7096),s=o(6237),c=o(6648),a=o(1204),d=o(2148);t.AuthValidate=e=>{function t(e){if(!e)throw new i.UnauthorizedError(d.UserErrorMessage.USER_NOT_FOUND)}function o(e,t){if(e.provider!==t)throw new i.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD)}function f(e){if(e.status===c.UserStatus.BLOCKED)throw new i.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_USER_BLOCKED)}return{validateLocalUserCanLogin:c=>r(void 0,void 0,void 0,(function*(){const{email:r,password:d}=c,u=yield e.findUserByEmail(r);return t(u),o(u,s.UserLoginProvider.LOCAL),f(u),function(e,t){if(!(0,n.compareSync)(t,e.password))throw new i.UnauthorizedError(a.AuthErrorMessages.UNAUTHORIZED_INCORRECT_EMAIL_OR_PASSWORD)}(u,d),!0})),validateExternalUserCanLogin:t=>r(void 0,void 0,void 0,(function*(){const{email:r,provider:i}=t,n=yield e.findUserByEmail(r);return n&&(o(n,i),f(n)),!0})),validateUserCanAccessResourceById:o=>r(void 0,void 0,void 0,(function*(){const r=yield e.findById(o);return t(r),f(r),!0})),validateUserForgotPassword:o=>r(void 0,void 0,void 0,(function*(){const r=yield e.findUserByEmail(o);return t(r),f(r),!0}))}}},4860:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),i(o(3204),t)},5703:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMailQueueProducer=void 0,t.AuthMailQueueProducer=e=>({addRegisterConfirmationJob:(t,o)=>{e.add("auth_register_activate",{user:t,activeToken:o})},addResetPasswordMailJob:(t,o)=>{e.add("auth_reset_password",{email:t,resetToken:o})}})},8888:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthMailWorker=void 0;const n=i(o(1017)),s=i(o(2275));t.AuthMailWorker=(e,t,o)=>({load:()=>{!function(){e.process("auth_register_activate",10,(e=>r(this,void 0,void 0,(function*(){const r=e.data.user,i=e.data.activeToken;if(!r||!i)throw new Error("User or active token is undefined");o.info(`Start sending activation link to email: ${r.email}`),yield t.sendMail({from:"ViSpace <noreply@authentication.vispace.tech>",to:r.email,subject:"Welcome to our app",templateUrl:n.default.resolve("src/components/mailTemplates/accountActivate.html"),context:{activationUrl:`${s.default.app.CLIENT_DOMAIN}/auth/activate/${i}`,receiver:`${r.name}`}}),o.info(`Activation link sent to email: ${r.email} successfully`)}))))}(),function(){e.process("auth_reset_password",10,(e=>r(this,void 0,void 0,(function*(){const{data:r}=e,i=r.email,c=r.resetToken;o.info(`Start sending reset password link to email: ${i}`),yield t.sendMail({from:"ViSpace <noreply@authentication.vispace.tech>",to:i,subject:"Reset password",templateUrl:n.default.resolve("src/components/mailTemplates/resetPassword.html"),context:{resetPasswordUrl:`${s.default.app.CLIENT_DOMAIN}/auth/reset/${c}`}}),o.info(`Reset password link sent to email: ${i} successfully`)}))))}()}})},1689:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSocketMiddleware=void 0;const r=o(6901),i=o(3241),n=o(6586),s=o(2578);t.createSocketMiddleware=function(){const e=(0,n.createUserRepository)(),t=(0,i.createAuthTokenService)(),o=(0,r.createAuthValidate)();return(0,s.AuthSocketMiddleware)(e,t,o)}},2578:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthSocketMiddleware=void 0;const i=o(1204),n=o(5021),s=o(2720);t.AuthSocketMiddleware=(e,t,o)=>({protect:(0,n.catchAsyncSocketMiddleware)(((n,c)=>r(void 0,void 0,void 0,(function*(){const a=n.handshake.auth.accessToken;if(!a)throw new s.UnauthorizedError(i.AuthErrorMessages.UNAUTHORIZED_MISSING_TOKEN);const{id:d,type:f,email:u}=yield function(n){return r(this,void 0,void 0,(function*(){yield t.validateAccessToken(n);const r=yield t.getUserIdFromAccessToken(n);yield o.validateUserCanAccessResourceById(r);const c=yield e.findById(r);if(!c)throw new s.UnauthorizedError(i.AuthErrorMessages.UNAUTHORIZED_USER_NOT_FOUND);return c}))}(a);n.user={id:d,email:u,roles:[f]},c()})))),restrictTo:e=>(0,n.catchAsyncSocketMiddleware)(((t,o)=>r(void 0,void 0,void 0,(function*(){const r=e.every((e=>{var o;return null===(o=t.user)||void 0===o?void 0:o.roles.includes(e)}));if(r&&o(),!r)throw new Error(i.AuthErrorMessages.UNAUTHORIZED_PERMISSION_DENIED)})))),restrictToGuest:(0,n.catchAsyncSocketMiddleware)(((e,t)=>r(void 0,void 0,void 0,(function*(){if(e.user)throw new Error(i.AuthErrorMessages.UNAUTHORIZED_ALREADY_LOGGED_IN);e.user||t()}))))})},8999:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenErrorMessages=void 0,t.AuthTokenErrorMessages={INVALID_ACCESS_TOKEN:"Access token is invalid",INVALID_REFRESH_TOKEN:"Error validating refresh token",REFRESH_TOKEN_EXPIRED:"Refresh token has expired. Please login again",ACCESS_TOKEN_EXPIRED:"Access token has expired"}},3241:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAuthTokenValidate=t.createAuthTokenService=void 0;const r=o(5250),i=o(1663),n=o(8172),s=o(79);function c(){return(0,s.AuthTokenValidate)()}t.createAuthTokenService=function(){const e=(0,r.getCustomRepository)(i.RefreshTokenRepository),t=c();return(0,n.AuthTokenService)(e,t)},t.createAuthTokenValidate=c},8172:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenService=void 0;const n=i(o(9344)),s=i(o(6113)),c=i(o(2275)),a=i(o(3837)),d=o(2720),f=o(8999);t.AuthTokenService=(e,t)=>{const o=e=>n.default.sign({userId:e},c.default.auth.JWT_SECRET,{issuer:c.default.auth.JWT_ISSUER,expiresIn:Date.now()+c.default.auth.JWT_ACCESS_TOKEN_EXPIRES_TIME,algorithm:"HS256"}),i=t=>r(void 0,void 0,void 0,(function*(){const o=s.default.randomBytes(c.default.auth.REFRESH_TOKEN_LENGTH).toString("hex");return yield e.save({token:o,userId:t,expiresAt:new Date(Date.now()+c.default.auth.REFRESH_TOKEN_EXPIRES_TIME)}),o})),u=(o,i)=>r(void 0,void 0,void 0,(function*(){const r=yield e.findByTokenAndUserId(o,i);return t.checkRefreshTokenExists(r),t.checkRefreshTokenActive(r),t.checkRefreshTokenNotExpired(r),!0}));return{createAccessTokenAndRefreshToken:e=>r(void 0,void 0,void 0,(function*(){return[o(e),yield i(e)]})),createAccessToken:o,createRefreshToken:i,blockRefreshToken:t=>r(void 0,void 0,void 0,(function*(){yield e.blockByToken(t)})),deleteRefreshToken:t=>r(void 0,void 0,void 0,(function*(){yield e.deleteByToken(t)})),validateAccessToken:e=>r(void 0,void 0,void 0,(function*(){let t;try{t=yield a.default.promisify(n.default.verify)(e,c.default.auth.JWT_SECRET)}catch(e){throw new d.UnauthorizedError(f.AuthTokenErrorMessages.INVALID_ACCESS_TOKEN)}if(t.iss!==c.default.auth.JWT_ISSUER)throw new d.UnauthorizedError(f.AuthTokenErrorMessages.INVALID_ACCESS_TOKEN);if(!t.exp||t.exp<Date.now())throw new d.UnauthorizedError(f.AuthTokenErrorMessages.ACCESS_TOKEN_EXPIRED);return!0})),validateRefreshToken:u,validateRefreshTokenCanRenewAccessToken:(e,t)=>r(void 0,void 0,void 0,(function*(){return yield u(e,t)})),getUserIdFromAccessToken:e=>r(void 0,void 0,void 0,(function*(){return(yield a.default.promisify(n.default.verify)(e,c.default.auth.JWT_SECRET)).userId}))}}},79:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthTokenValidate=void 0;const r=o(2720),i=o(8999),n=o(4574);t.AuthTokenValidate=()=>({checkRefreshTokenExists:function(e){if(!e)throw new r.UnauthorizedError(i.AuthTokenErrorMessages.INVALID_REFRESH_TOKEN)},checkRefreshTokenActive:function(e){if(e.status===n.RefreshTokenStatus.BLOCKED)throw new r.UnauthorizedError(i.AuthTokenErrorMessages.INVALID_REFRESH_TOKEN)},checkRefreshTokenNotExpired:function(e){if(e.expiresAt.getTime()<Date.now())throw new r.UnauthorizedError(i.AuthTokenErrorMessages.REFRESH_TOKEN_EXPIRED)}})},777:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.BaseEntity=void 0;const n=o(5250);class s{}r([(0,n.CreateDateColumn)({name:"created_at"}),i("design:type",Date)],s.prototype,"createdAt",void 0),r([(0,n.UpdateDateColumn)({name:"updated_at"}),i("design:type",Date)],s.prototype,"updatedAt",void 0),r([(0,n.DeleteDateColumn)({name:"deleted_at"}),i("design:type",Date)],s.prototype,"deletedAt",void 0),t.BaseEntity=s},7325:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRepository=void 0;const r=o(5250);class i extends r.Repository{findById(e){return this.findOne(e)}}t.BaseRepository=i},9456:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RepositoryQueryBuilder=void 0,t.RepositoryQueryBuilder=class{constructor(e,t){this.query=e.createQueryBuilder(t),this.tableAlias=t}findById(e){return this.query.where(`${this.tableAlias}.id = :id`,{id:e}),this}withPageable(e){const{page:t,size:o}=e;return this.query.limit(o),this.query.skip(o*(t-1)),this}build(){return this.query}}},6571:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadRouter=void 0;const r=o(6860),i=o(1186);t.CloudUploadRouter=()=>{const e=(0,r.Router)(),t=(0,i.createCloudUploadController)(),o=(0,i.createCloudUploadMiddleware)();return e.post("/avatar",o.avatarUpload.single("avatar"),t.uploadAvatar),e.post("/image",o.imageUpload.single("image"),t.uploadImage),e.post("/model",o.modelUpload.single("model"),t.uploadModel),e}},4949:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadController=void 0;const n=i(o(4708)),s=o(3015),c=o(2720),a=o(7500);t.CloudUploadController=e=>{function t(e){return n.default.createReadStream(e)}return{uploadModel:(0,s.catchAsyncRequestHandler)(((o,i,n)=>r(void 0,void 0,void 0,(function*(){const r=o.file;if(!r)throw new c.IllegalArgumentError("File upload is empty");console.log(r);const n=yield e.uploadLargeFile({name:r.originalname,stream:t(r.buffer),type:r.mimetype});i.status(a.HttpStatusCode.OK).json({data:{url:n}})})))),uploadAvatar:(0,s.catchAsyncRequestHandler)(((o,i,n)=>r(void 0,void 0,void 0,(function*(){const r=o.file;if(!r)throw new c.IllegalArgumentError("File upload is empty");const n=yield e.uploadMedia({name:r.originalname,stream:t(r.buffer),type:r.mimetype});i.status(a.HttpStatusCode.OK).json({data:{url:n}})})))),uploadImage:(0,s.catchAsyncRequestHandler)(((o,i,n)=>r(void 0,void 0,void 0,(function*(){const r=o.file;if(!r)throw new c.IllegalArgumentError("File upload is empty");const n=yield e.uploadMedia({name:r.originalname,stream:t(r.buffer),type:r.mimetype});i.status(a.HttpStatusCode.OK).json({data:{url:n}})}))))}}},1186:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCloudUploadService=t.createCloudUploadMiddleware=t.createCloudUploadController=void 0;const r=o(7767),i=o(4949),n=o(6599),s=o(7973);function c(){return(0,s.CloudUploadService)(r.cloudLogger)}t.createCloudUploadController=function(){const e=c();return(0,i.CloudUploadController)(e)},t.createCloudUploadMiddleware=function(){return(0,n.CloudUploadMiddleware)()},t.createCloudUploadService=c},6599:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadMiddleware=void 0;const i=r(o(1738)),n=o(2720);t.CloudUploadMiddleware=()=>{function e(e,t,o){"image"===t.mimetype.split("/")[0]?o(null,!0):o(new n.IllegalArgumentError("Only image files are allowed"))}return{avatarUpload:(0,i.default)({limits:{files:1,fileSize:20971520},fileFilter:e}),imageUpload:(0,i.default)({limits:{files:1,fileSize:20971520},fileFilter:e}),modelUpload:(0,i.default)({limits:{files:1},fileFilter:function(e,t,o){var r;(null===(r=t.mimetype.split("/")[1])||void 0===r?void 0:r.includes("gltf"))?o(null,!0):o(new n.IllegalArgumentError("Only gltf file type is allowed"))}})}}},7973:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CloudUploadService=void 0;const n=i(o(9336)),s=o(5828),c=i(o(2275)),a=o(2720),d=o(3518);t.CloudUploadService=e=>({initialize:()=>r(void 0,void 0,void 0,(function*(){e.info("Start config cloudinary"),d.v2.config({cloud_name:c.default.cloud.IMAGE_CLOUDINARY_CLOUD_NAME,api_key:c.default.cloud.IMAGE_CLOUDINARY_API_KEY,api_secret:c.default.cloud.IMAGE_CLOUDINARY_API_SECRET}),yield function(){return r(this,void 0,void 0,(function*(){e.info("Start config AWS S3 service"),n.default.config.update({apiVersion:"2006-03-01",region:c.default.cloud.MODEL_AWS_BUCKET_REGION,credentials:{accessKeyId:c.default.cloud.MODEL_AWS_BUCKET_ACCESS_KEY,secretAccessKey:c.default.cloud.MODEL_AWS_BUCKET_SECRET_KEY}}),e.info("Create new bucket contains file of models");const t=new n.default.S3;yield function(e){return r(this,void 0,void 0,(function*(){yield e.putBucketCors({Bucket:c.default.cloud.MODEL_AWS_BUCKET_NAME,CORSConfiguration:{CORSRules:[{AllowedHeaders:["*"],AllowedMethods:["PUT","POST","DELETE"],AllowedOrigins:["*"]},{AllowedMethods:["GET"],AllowedOrigins:["*"]}]}}).promise()}))}(t),yield t.createBucket({Bucket:c.default.cloud.MODEL_AWS_BUCKET_NAME})}))}()})),uploadMedia:e=>r(void 0,void 0,void 0,(function*(){return new Promise(((t,o)=>{const r=d.v2.uploader.upload_stream({},((e,r)=>{r&&t(r.url),e&&o(new a.AppError(e.http_code,e.message))}));e.stream.pipe(r)}))})),uploadLargeFile:e=>r(void 0,void 0,void 0,(function*(){const t=new n.default.S3,o={Bucket:c.default.cloud.MODEL_AWS_BUCKET_NAME,Key:(0,s.v4)(),ContentType:e.type,Body:e.stream,ACL:"public-read",ContentDisposition:`attachment; filename="${e.name}"`};return(yield t.upload(o).promise()).Location}))})},2048:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandlerDev=void 0;const r=o(2720),i=o(7500);t.globalErrorHandlerDev=(e,t,o,n)=>{e instanceof r.AppError?o.status(e.statusCode).json({message:e.message,stack:e.stack,error:e}):o.status(i.HttpStatusCode.INTERNAL_SERVER_ERROR).json({message:e.message,stack:e.stack,error:e})}},8715:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandlerProd=void 0;const r=o(2720),i=o(7500),n=o(7767);t.globalErrorHandlerProd=(e,t,o,s)=>{n.serverLogger.error(e),e instanceof r.AppError?o.status(i.HttpStatusCode.OK).json({status:e.status,code:e.statusCode,message:e.message,errors:e.errors}):o.status(i.HttpStatusCode.INTERNAL_SERVER_ERROR).json({message:"Something went wrong"})}},7886:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalErrorHandler=void 0;const r=o(206),i=o(2048),n=o(8715);t.globalErrorHandler=(e,t,o,s)=>{"production"===r.appConfig.NODE_ENV&&(0,n.globalErrorHandlerProd)(e,t,o,s),"development"===r.appConfig.NODE_ENV&&(0,i.globalErrorHandlerDev)(e,t,o,s)}},827:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateItemDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"name",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"modelPath",void 0),t.CreateItemDto=c},2067:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),i(o(1412),t)},1412:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRouter=void 0;const r=o(6860),i=o(3371),n=o(5337);t.ItemRouter=()=>{const e=(0,i.createItemService)(),t=(0,n.ItemController)(e),o=(0,r.Router)();return o.route("/:id").get(t.getById).delete(t.deleteById).patch(t.updateById),o.route("/").get(t.getAll).post(t.create),o}},5337:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemController=void 0;const i=o(7500),n=o(3015),s=o(1624),c=o(5718),a=o(827);t.ItemController=e=>({getAll:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=(0,s.pageParser)(t.query,{defaultPage:1,defaultSize:10}),n=yield e.findAll(r);o.status(i.HttpStatusCode.OK).json(n)})))),getById:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=yield e.findById(+t.params.id);o.status(i.HttpStatusCode.OK).json(r)})))),create:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,c.validateRequestBody)(a.CreateItemDto,t.body);if(r)throw r;const n=t.body,s=yield e.create(n);o.status(i.HttpStatusCode.CREATED).json(s)})))),deleteById:(0,n.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){})))),updateById:(0,n.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){}))))})},8301:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemCreator=void 0,t.ItemCreator=()=>{const e=e=>{const{id:t,name:o,modelPath:r,createdAt:i}=e;return{id:t,name:o,modelPath:r,createdAt:i}};return{mapItemToItemDto:e,mapItemsToItemsDto:t=>t.map((t=>e(t)))}}},1993:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Item=void 0;const n=o(5250),s=o(777);let c=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],c.prototype,"id",void 0),r([(0,n.Column)(),(0,n.Index)({}),i("design:type",String)],c.prototype,"name",void 0),r([(0,n.Column)({unique:!0,name:"model_path"}),i("design:type",String)],c.prototype,"modelPath",void 0),c=r([(0,n.Entity)({name:"item"})],c),t.Item=c},5687:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemErrorMessages=void 0,t.ItemErrorMessages={ITEM_NOT_FOUND:"Item not found"}},3371:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createItemCreator=t.createItemService=t.createItemRepository=void 0;const r=o(5250),i=o(8301),n=o(1074),s=o(2926);function c(){return(0,r.getCustomRepository)(n.ItemRepository)}function a(){return(0,i.ItemCreator)()}t.createItemRepository=c,t.createItemService=function(){const e=c(),t=a();return(0,s.ItemService)(e,t)},t.createItemCreator=a},5767:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapItemToItemDto=void 0,t.mapItemToItemDto=e=>{const{id:t,modelPath:o,name:r,createdAt:i}=e;return{id:t,modelPath:o,name:r,createdAt:i}}},1074:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemRepository=void 0;const i=o(5250),n=o(1993),s=o(7325);let c=class extends s.BaseRepository{};c=r([(0,i.EntityRepository)(n.Item)],c),t.ItemRepository=c},2926:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ItemService=void 0;const i=o(2720),n=o(5687);t.ItemService=(e,t)=>({findAll:({page:o,size:i})=>r(void 0,void 0,void 0,(function*(){const r=yield e.createQueryBuilder().take(i).skip((o-1)*i).getMany();return t.mapItemsToItemsDto(r)})),findById:o=>r(void 0,void 0,void 0,(function*(){const r=yield e.findOne(o);if(!r)throw new i.NotFoundError(n.ItemErrorMessages.ITEM_NOT_FOUND);return t.mapItemToItemDto(r)})),create:o=>r(void 0,void 0,void 0,(function*(){const r=yield e.save(o);return t.mapItemToItemDto(r)})),deleteById:t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.softDelete(t)).affected)throw new i.NotFoundError(n.ItemErrorMessages.ITEM_NOT_FOUND)})),updateById:(o,s)=>r(void 0,void 0,void 0,(function*(){const r=yield e.save(Object.assign({id:o},s));if(!r)throw new i.NotFoundError(n.ItemErrorMessages.ITEM_NOT_FOUND);return t.mapItemToItemDto(r)}))})},7767:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cloudLogger=t.officeItemLogger=t.mailLogger=t.messageService=t.authLogger=t.userLogger=t.serverLogger=void 0;const r=o(7773),i=r.format.combine(r.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),r.format.align(),r.format.printf((e=>`${e.timestamp} ${e.level}: ${e.message}`))),n={filename:"logs/log.log",format:r.format.combine(r.format.timestamp({format:"YYYY-MM-DD HH:mm:ss"}),r.format.json()),maxFiles:1e3,maxsize:5242880},s={format:i,level:"debug"};t.serverLogger=(0,r.createLogger)({defaultMeta:{service:"server"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.userLogger=(0,r.createLogger)({defaultMeta:{service:"user-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.authLogger=(0,r.createLogger)({defaultMeta:{service:"auth-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.messageService=(0,r.createLogger)({defaultMeta:{service:"message-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.mailLogger=(0,r.createLogger)({defaultMeta:{service:"mail-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.officeItemLogger=(0,r.createLogger)({defaultMeta:{service:"office-items-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]}),t.cloudLogger=(0,r.createLogger)({defaultMeta:{service:"cloud-service"},transports:[new r.transports.File(n),new r.transports.Console(s)]})},4678:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.MailCacheService=void 0,t.MailCacheService=e=>{const t="mail_template";return{setMailTemplate:(r,i,n)=>o(void 0,void 0,void 0,(function*(){yield e.set(`${t}:${r}`,i,{EX:(null==n?void 0:n.mailTemplateExpireSeconds)||1800})})),getMailTemplate:r=>o(void 0,void 0,void 0,(function*(){return yield e.get(`${t}:${r}`)}))}}},1876:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMailCacheService=t.createMailService=void 0;const r=o(366),i=o(7767),n=o(4678),s=o(1683);function c(){return(0,n.MailCacheService)((0,r.getCacheConnection)("mail"))}t.createMailService=()=>{const e=c();return(0,s.MailService)(e,i.mailLogger)},t.createMailCacheService=c},1683:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MailService=void 0;const n=i(o(7147)),s=i(o(3837)),c=i(o(2275)),a=i(o(2097)),d=i(o(5184));let f;t.MailService=(e,t)=>{const o=t=>r(void 0,void 0,void 0,(function*(){const{from:o,to:i,context:s,subject:c,templateUrl:d}=t,u=yield function(t){return r(this,void 0,void 0,(function*(){const o=yield e.getMailTemplate(t);if(o)return o;const r=n.default.readFileSync(t).toString();if(!r)throw new Error(`Template file ${t} is not found`);return r}))}(d),l={from:o,to:i,subject:c,html:a.default.compile(u)(Object.assign({},s))},v=yield f.sendMail(l);return{acceptedRecipients:v.accepted,rejectedRecipients:v.rejected,response:v.response}}));return{initialize:()=>r(void 0,void 0,void 0,(function*(){f=d.default.createTransport({service:c.default.mail.EMAIL_SERVICE_NAME,host:c.default.mail.EMAIL_SERVICE_HOST,port:c.default.mail.EMAIL_SERVICE_PORT,secure:!1,pool:!0,maxMessages:1/0,maxConnections:20,auth:{user:c.default.mail.EMAIL_SERVICE_USERNAME,pass:c.default.mail.EMAIL_SERVICE_PASSWORD}}),t.info("Start verify SMTP");try{(yield s.default.promisify(f.verify)())&&t.info("SMTP ready...")}catch(e){throw t.error(`SMTP Error: ${e}`),t.error("SMTP not ready!"),e}})),sendBulkMails:e=>r(void 0,void 0,void 0,(function*(){e.map((e=>r(void 0,void 0,void 0,(function*(){return yield o(e)}))))})),sendMail:o}}},8293:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=o(754),i={generate:()=>(0,r.customAlphabet)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ")(9)};t.default=i},9817:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRouter=void 0;const r=o(7704);Object.defineProperty(t,"OfficeItemRouter",{enumerable:!0,get:function(){return r.OfficeItemRouter}})},7704:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRouter=void 0;const r=o(6860),i=o(6901),n=o(4509);t.OfficeItemRouter=()=>{const e=(0,r.Router)(),t=(0,i.createAuthMiddleware)(),o=(0,n.createOfficeItemController)();return e.use(t.protect),e.route("/:id").get(o.getOfficeItemDetailById).delete(o.deleteOfficeItemById),e.route("/").get(o.getOfficeItemsDetail),e}},6002:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemController=void 0;const i=o(7500),n=o(3015),s=o(1624);t.OfficeItemController=e=>({getOfficeItemDetailById:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,n=yield e.findOfficeItemDetailById(r);o.status(i.HttpStatusCode.OK).json({status:"success",officeItem:n})})))),getOfficeItemsDetail:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=(0,s.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[n,c]=yield e.findOfficeItemsDetail(r);o.status(i.HttpStatusCode.OK).json({status:"success",page:r.page,limit:r.size,total:c,offices:n})})))),deleteOfficeItemById:(0,n.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id;yield e.deleteOfficeItem(r),o.status(i.HttpStatusCode.OK).json({status:"success"})})))),updateOfficeItemById:(0,n.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){e.params.id,t.status(i.HttpStatusCode.OK).json({status:"success"})}))))})},2965:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItem=void 0;const n=o(5250),s=o(1993),c=o(4843),a=o(777);let d=class extends a.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],d.prototype,"id",void 0),r([(0,n.PrimaryColumn)({name:"item_id"}),i("design:type",Number)],d.prototype,"itemId",void 0),r([(0,n.PrimaryColumn)({name:"office_id"}),i("design:type",Number)],d.prototype,"officeId",void 0),r([(0,n.Column)({name:"x_rotation"}),i("design:type",Number)],d.prototype,"xRotation",void 0),r([(0,n.Column)({name:"y_rotation"}),i("design:type",Number)],d.prototype,"yRotation",void 0),r([(0,n.Column)({name:"z_rotation"}),i("design:type",Number)],d.prototype,"zRotation",void 0),r([(0,n.Column)({name:"x_position"}),i("design:type",Number)],d.prototype,"xPosition",void 0),r([(0,n.Column)({name:"y_position"}),i("design:type",Number)],d.prototype,"yPosition",void 0),r([(0,n.Column)({name:"z_position"}),i("design:type",Number)],d.prototype,"zPosition",void 0),r([(0,n.ManyToOne)((()=>s.Item)),(0,n.JoinColumn)({name:"item_id"}),i("design:type",s.Item)],d.prototype,"item",void 0),r([(0,n.ManyToOne)((()=>c.Office)),(0,n.JoinColumn)({name:"office_id"}),i("design:type",c.Office)],d.prototype,"office",void 0),d=r([(0,n.Entity)({name:"office_item"})],d),t.OfficeItem=d},4275:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemErrorMessages=void 0,t.OfficeItemErrorMessages={OFFICE_ITEM_NOT_FOUND:"Office item not found"}},4509:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeItemRepository=t.createOfficeItemValidate=t.createOfficeItemService=t.createOfficeItemController=void 0;const r=o(5250),i=o(6002),n=o(1269),s=o(8743),c=o(9394);function a(){const e=(0,r.getCustomRepository)(n.OfficeItemRepository),t=d();return(0,s.OfficeItemService)(e,t)}function d(){const e=(0,r.getCustomRepository)(n.OfficeItemRepository);return(0,c.OfficeItemValidate)(e)}t.createOfficeItemController=function(){const e=a();return(0,i.OfficeItemController)(e)},t.createOfficeItemService=a,t.createOfficeItemValidate=d,t.createOfficeItemRepository=function(){return(0,r.getCustomRepository)(n.OfficeItemRepository)}},7437:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeItemToOfficeItemDetailDto=t.mapOfficeItemToOfficeItemOverviewDto=void 0;const r=o(5767),i=o(9855);t.mapOfficeItemToOfficeItemOverviewDto=e=>{const{id:t,item:o,officeId:i,createdAt:n,xPosition:s,yPosition:c,zPosition:a,xRotation:d,yRotation:f,zRotation:u}=e;return{id:t,officeId:i,transform:{position:{x:s,y:c,z:a},rotation:{x:d,y:f,z:u}},createdAt:n,item:(0,r.mapItemToItemDto)(o)}},t.mapOfficeItemToOfficeItemDetailDto=e=>{const{id:t,item:o,office:n,createdAt:s,xPosition:c,yPosition:a,zPosition:d,xRotation:f,yRotation:u,zRotation:l}=e,v={position:{x:c,y:a,z:d},rotation:{x:f,y:u,z:l}};return{id:t,item:(0,r.mapItemToItemDto)(o),office:(0,i.mapOfficeToOfficeOverviewDto)(n),transform:v,createdAt:s}}},1269:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemRepository=void 0;const n=o(5250),s=o(2965),c=o(7325);let a=class extends c.BaseRepository{existsOfficeItemById(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.createQueryBuilder("office_item").where("office_item.id = :id",{id:e}).getCount())}))}updateOfficeItemTransformById(e,t){return i(this,void 0,void 0,(function*(){const{position:o,rotation:r}=t,{x:i,y:n,z:s}=o,{x:c,y:a,z:d}=r;yield this.update(e,{xPosition:i,yPosition:n,zPosition:s,xRotation:c,yRotation:a,zRotation:d})}))}findOfficeItemWithItemById(e){return i(this,void 0,void 0,(function*(){return this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").where("office_item.id = :id",{id:e}).getOne()}))}findOfficeItemWithItemAndOfficeById(e){return i(this,void 0,void 0,(function*(){return this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").leftJoinAndSelect("office_item.office","office").where("office_item.id = :id",{id:e}).getOne()}))}findOfficeItemsWithItemAndOffice(e){return i(this,void 0,void 0,(function*(){const{page:t,size:o}=e;return this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").leftJoinAndSelect("office_item.office","office").skip((t-1)*o).limit(o).getMany()}))}findOfficeItemsWithItemByOfficeId(e){return i(this,void 0,void 0,(function*(){return this.createQueryBuilder("office_item").leftJoinAndSelect("office_item.item","item").where("office_item.officeId = :officeId",{officeId:e}).getMany()}))}};a=r([(0,n.EntityRepository)(s.OfficeItem)],a),t.OfficeItemRepository=a},8743:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemService=void 0;const i=o(7437);t.OfficeItemService=(e,t)=>({createOfficeItem:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.save(t);return(0,i.mapOfficeItemToOfficeItemOverviewDto)(o)})),findOfficeItemDetailById:o=>r(void 0,void 0,void 0,(function*(){yield t.checkOfficeItemExistsById(o);const r=yield e.findOfficeItemWithItemAndOfficeById(o);return(0,i.mapOfficeItemToOfficeItemDetailDto)(r)})),findOfficeItemsDetail:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.findOfficeItemsWithItemAndOffice(t),r=yield e.count();return[o.map((e=>(0,i.mapOfficeItemToOfficeItemDetailDto)(e))),r]})),deleteOfficeItem:o=>r(void 0,void 0,void 0,(function*(){yield t.checkOfficeItemExistsById(o),yield e.delete(o)}))})},9394:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeItemValidate=void 0;const i=o(2720),n=o(4275);t.OfficeItemValidate=e=>({checkOfficeItemExistsById:t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.existsOfficeItemById(t)))throw new i.NotFoundError(n.OfficeItemErrorMessages.OFFICE_ITEM_NOT_FOUND)}))})},478:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRole=void 0;const n=o(5250),s=o(777),c=o(5970),a=o(1500);let d=class extends s.BaseEntity{};r([(0,n.PrimaryColumn)({name:"office_member_id"}),i("design:type",Number)],d.prototype,"officeMemberId",void 0),r([(0,n.PrimaryColumn)({name:"office_role_id"}),i("design:type",Number)],d.prototype,"officeRoleId",void 0),r([(0,n.ManyToOne)((()=>c.OfficeMember),(e=>e.roles)),(0,n.JoinColumn)({name:"office_member_id"}),i("design:type",c.OfficeMember)],d.prototype,"officeMember",void 0),r([(0,n.ManyToOne)((()=>a.OfficeRole)),(0,n.JoinColumn)({name:"office_role_id"}),i("design:type",a.OfficeRole)],d.prototype,"officeRole",void 0),d=r([(0,n.Entity)({name:"office_member_role"})],d),t.OfficeMemberRole=d},5076:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformCacheService=void 0,t.OfficeMemberTransformCacheService=e=>{const t="office_member_transform";return{setTransform:(r,i)=>o(void 0,void 0,void 0,(function*(){yield e.set(`${t}:${r}`,JSON.stringify({memberTransform:i}))})),getTransformById:r=>o(void 0,void 0,void 0,(function*(){const o=yield e.get(`${t}:${r}`);if(o)return JSON.parse(o)})),deleteTransformById:t=>o(void 0,void 0,void 0,(function*(){yield e.del(`${t}`)})),scan:(t,o)=>e.scan(t,{COUNT:o}),flushAll:()=>o(void 0,void 0,void 0,(function*(){return e.flushAll()}))}}},1230:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransform=void 0;const n=o(5250),s=o(777),c=o(5970);let a=class extends s.BaseEntity{};r([(0,n.PrimaryColumn)({name:"office_member_id"}),i("design:type",Number)],a.prototype,"officeMemberId",void 0),r([(0,n.Column)({name:"x_rotation",default:0}),i("design:type",Number)],a.prototype,"xRotation",void 0),r([(0,n.Column)({name:"y_rotation",default:0}),i("design:type",Number)],a.prototype,"yRotation",void 0),r([(0,n.Column)({name:"z_rotation",default:0}),i("design:type",Number)],a.prototype,"zRotation",void 0),r([(0,n.Column)({name:"x_position",default:0}),i("design:type",Number)],a.prototype,"xPosition",void 0),r([(0,n.Column)({name:"y_position",default:0}),i("design:type",Number)],a.prototype,"yPosition",void 0),r([(0,n.Column)({name:"z_position",default:0}),i("design:type",Number)],a.prototype,"zPosition",void 0),r([(0,n.OneToOne)((()=>c.OfficeMember)),(0,n.JoinColumn)({name:"office_member_id"}),i("design:type",c.OfficeMember)],a.prototype,"officeMember",void 0),a=r([(0,n.Entity)({name:"office_member_transform"})],a),t.OfficeMemberTransform=a},8993:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeMemberTransformCache=t.createOfficeMemberTransformRepository=t.createOfficeMemberTransformService=void 0;const r=o(5250),i=o(366),n=o(5076),s=o(1428),c=o(5528);function a(){return(0,r.getCustomRepository)(s.OfficeMemberTransformRepository)}function d(){const e=(0,i.getCacheConnection)("officeMemberTransform");return(0,n.OfficeMemberTransformCacheService)(e)}t.createOfficeMemberTransformService=function(){const e=a(),t=d();return(0,c.OfficeMemberTransformService)(e,t)},t.createOfficeMemberTransformRepository=a,t.createOfficeMemberTransformCache=d},5680:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeMemberTransformToTransform3D=void 0,t.mapOfficeMemberTransformToTransform3D=e=>{const{xPosition:t,yPosition:o,zPosition:r,xRotation:i,yRotation:n,zRotation:s}=e;return{position:{x:t,y:o,z:r},rotation:{x:i,y:n,z:s}}}},1428:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformRepository=void 0;const n=o(5250),s=o(7325),c=o(1230);let a=class extends s.BaseRepository{findTransformByOfficeMemberId(e){return i(this,void 0,void 0,(function*(){return this.createQueryBuilder().where("office_member_id = :id",{id:e}).getOne()}))}};a=r([(0,n.EntityRepository)(c.OfficeMemberTransform)],a),t.OfficeMemberTransformRepository=a},5528:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberTransformService=void 0;const i=o(2720);t.OfficeMemberTransformService=(e,t)=>({updateTransformInCacheById:(e,o)=>r(void 0,void 0,void 0,(function*(){yield t.setTransform(e,Object.assign({officeMemberId:e},o))})),backupTransformFromCacheById:o=>r(void 0,void 0,void 0,(function*(){const r=yield t.getTransformById(o);r&&(yield e.update(o,Object.assign({},r)),yield t.deleteTransformById(o))})),findTransformById:o=>r(void 0,void 0,void 0,(function*(){const r=yield t.getTransformById(o);if(r)return r;const n=yield e.findById(o);if(!n)throw new i.NotFoundError("Office member transform not found");return n}))})},9366:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberOnlineStatus=void 0,(o=t.OfficeMemberOnlineStatus||(t.OfficeMemberOnlineStatus={})).ONLINE="online",o.OFFLINE="offline"},7114:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRouter=void 0;const r=o(3245);Object.defineProperty(t,"OfficeMemberRouter",{enumerable:!0,get:function(){return r.OfficeMemberRouter}})},3245:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRouter=void 0;const r=o(6860),i=o(6901),n=o(4491);t.OfficeMemberRouter=()=>{const e=(0,r.Router)(),t=(0,i.createAuthMiddleware)(),o=(0,n.createOfficeMemberController)();return e.use(t.protect),e.route("/:id").get(o.getOfficeMemberById).delete(o.deleteOfficeMember),e.route("/").get(o.getOfficeMembersDetail).post(o.addMemberToOffice),e}},126:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberController=void 0;const i=o(1624),n=o(7500),s=o(3015);t.OfficeMemberController=e=>({getOfficeMemberById:(0,s.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,i=yield e.findOfficeMemberDetailById(r);o.status(n.HttpStatusCode.OK).json({status:"success",officeMember:i})})))),getOfficeMembersDetail:(0,s.catchAsyncRequestHandler)(((t,o,s)=>r(void 0,void 0,void 0,(function*(){const r=(0,i.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[s,c]=yield e.findOfficeMembersDetail(r);o.status(n.HttpStatusCode.OK).json({status:"success",page:r.page,limit:r.size,total:c,officeMembers:s})})))),deleteOfficeMember:(0,s.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id;yield e.deleteOfficeMemberById(r),o.status(n.HttpStatusCode.OK).json({status:"success"})})))),addMemberToOffice:(0,s.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=t.body,i=yield e.createOfficeMember(r);o.status(n.HttpStatusCode.OK).json({status:"success",officeMember:i})}))))})},7874:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberCreator=void 0;const i=o(8164);t.OfficeMemberCreator=e=>({createOfficeMemberOverviewById:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.queryBuilder().findById(t).withMember().withTransform().build().getOne();return(0,i.mapOfficeMemberToOfficeMemberOverviewDto)(o)})),createOfficeMemberDetailById:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.queryBuilder().findById(t).withMember().withOfficeHasCreator().withTransform().withRoles().build().getOne();return(0,i.mapOfficeMemberToOfficeMemberDetailDto)(o)})),createOfficeMembersOverviewByOfficeId:t=>r(void 0,void 0,void 0,(function*(){return(yield e.queryBuilder().findByOfficeId(t).withMember().withTransform().build().getMany()).map((e=>(0,i.mapOfficeMemberToOfficeMemberOverviewDto)(e)))}))})},5970:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMember=void 0;const n=o(5250),s=o(4843),c=o(4614),a=o(777),d=o(1230),f=o(9366),u=o(478);let l=class extends a.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],l.prototype,"id",void 0),r([(0,n.Column)({name:"member_id"}),i("design:type",Number)],l.prototype,"memberId",void 0),r([(0,n.Column)({name:"office_id"}),i("design:type",Number)],l.prototype,"officeId",void 0),r([(0,n.Column)({name:"online_status",type:"enum",enum:f.OfficeMemberOnlineStatus,default:f.OfficeMemberOnlineStatus.OFFLINE}),i("design:type",String)],l.prototype,"onlineStatus",void 0),r([(0,n.ManyToOne)((()=>c.User),{onDelete:"CASCADE"}),(0,n.JoinColumn)({name:"member_id"}),i("design:type",c.User)],l.prototype,"member",void 0),r([(0,n.ManyToOne)((()=>s.Office),{onDelete:"CASCADE"}),(0,n.JoinColumn)({name:"office_id"}),i("design:type",s.Office)],l.prototype,"office",void 0),r([(0,n.OneToMany)((()=>u.OfficeMemberRole),(e=>e.officeMember),{cascade:!0}),i("design:type",Array)],l.prototype,"roles",void 0),r([(0,n.OneToOne)((()=>d.OfficeMemberTransform),(e=>e.officeMember),{cascade:!0}),i("design:type",d.OfficeMemberTransform)],l.prototype,"transform",void 0),l=r([(0,n.Entity)({name:"office_member"})],l),t.OfficeMember=l},4711:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberErrorMessages=void 0,t.OfficeMemberErrorMessages={OFFICE_MEMBER_NOT_FOUND:"Office member not found",USER_ALREADY_IN_OFFICE:"User already existed in office",PERMISSION_DENIED:"Office member not has permission to perform this action"}},4491:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeMemberRepository=t.createOfficeMemberCreator=t.createOfficeMemberValidate=t.createOfficeMemberCache=t.createOfficeMemberService=t.createOfficeMemberSocketService=t.createOfficeMemberController=void 0;const r=o(5250),i=o(366),n=o(8993),s=o(126),c=o(7874),a=o(8637),d=o(2034),f=o(3431),u=o(7511);function l(){const e=m(),t=(0,n.createOfficeMemberTransformRepository)(),o=y(),r=p();return(0,d.OfficeMemberService)(e,t,o,r)}function v(){const e=(0,i.getCacheConnection)("officeMember");return(0,u.OfficeMemberSocketCacheService)(e)}function p(){const e=m();return(0,f.OfficeMemberValidate)(e)}function y(){const e=m();return(0,c.OfficeMemberCreator)(e)}function m(){return(0,r.getCustomRepository)(a.OfficeMemberRepository)}t.createOfficeMemberController=function(){const e=l();return(0,s.OfficeMemberController)(e)},t.createOfficeMemberSocketService=function(e,t){const o=m(),r=(0,n.createOfficeMemberTransformService)(),i=v();return(0,u.OfficeMemberSocketService)(e,t,o,r,i)},t.createOfficeMemberService=l,t.createOfficeMemberCache=v,t.createOfficeMemberValidate=p,t.createOfficeMemberCreator=y,t.createOfficeMemberRepository=m},8164:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeMemberToOfficeMemberDetailDto=t.mapOfficeMemberToOfficeMemberOverviewDto=void 0;const r=o(5680),i=o(9855),n=o(9857);t.mapOfficeMemberToOfficeMemberOverviewDto=e=>{const{id:t,member:o,officeId:i,transform:s,onlineStatus:c,roles:a}=e;return{id:t,officeId:i,member:(0,n.mapUserToUserOverviewDto)(o),onlineStatus:c,transform:(0,r.mapOfficeMemberTransformToTransform3D)(s)}},t.mapOfficeMemberToOfficeMemberDetailDto=e=>{const{id:t,member:o,office:s,transform:c,onlineStatus:a,roles:d}=e,f=(0,n.mapUserToUserOverviewDto)(o),u=(0,i.mapOfficeToOfficeOverviewDto)(s),l=(0,r.mapOfficeMemberTransformToTransform3D)(c);return{id:t,office:u,member:f,roles:d.map((e=>e.officeRole.name)),onlineStatus:a,transform:l}}},8637:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRepository=void 0;const n=o(5250),s=o(5970),c=o(7325),a=o(4350);let d=class extends c.BaseRepository{queryBuilder(){return new a.OfficeMemberRepositoryQueryBuilder(this)}existsOfficeMemberById(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.createQueryBuilder("office_member").where("office_member.id = :id",{id:e}).getCount())}))}existsUserInOffice(e,t){return i(this,void 0,void 0,(function*(){return 1===(yield this.createQueryBuilder("office_member").where("office_member.member_id = :userId",{userId:e}).andWhere("office_member.office_id = :officeId",{officeId:t}).getCount())}))}setOfficeMemberOnlineStatusById(e,t){return i(this,void 0,void 0,(function*(){yield this.createQueryBuilder("office_member").update().where("office_member.id = :id",{id:e}).set({onlineStatus:t}).execute()}))}findOfficeMemberByMemberEmailAndOfficeId(e,t){return i(this,void 0,void 0,(function*(){return this.createQueryBuilder("office_member").where("office_member.office_id = :officeId",{officeId:t}).leftJoin("office_member.member","user").where("user.email = :email",{email:e}).getOne()}))}};d=r([(0,n.EntityRepository)(s.OfficeMember)],d),t.OfficeMemberRepository=d},4350:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberRepositoryQueryBuilder=void 0;const r=o(9456);class i extends r.RepositoryQueryBuilder{constructor(e){super(e,"office_member")}findById(e){return super.findById(e),this}findByOfficeId(e){return this.query.where("office_member.office_id = :officeId",{officeId:e}),this}findByMemberId(e){return this.query.where("office_member.member_id = :memberId",{memberId:e}),this}findByMemberIdAndOfficeId(e,t){return this.query.where("office_member.member_id = :memberId",{memberId:e}).andWhere("office_member.office_id = :officeId",{officeId:t}),this}findAll(){return this.query,this}withMember(){return this.query.leftJoinAndSelect("office_member.member","user"),this}withOffice(){return this.query.leftJoinAndSelect("office_member.office","office"),this}withOfficeHasCreator(){return this.query.leftJoinAndSelect("office_member.office","office").leftJoinAndSelect("office.createdBy","created_user"),this}withTransform(){return this.query.leftJoinAndSelect("office_member.transform","office_member_transform"),this}withRoles(){return this.query.leftJoinAndSelect("office_member.roles","office_member_role").leftJoinAndSelect("office_member_role.officeRole","office_role"),this}withPageable(e){return super.withPageable(e),this}build(){return this.query}}t.OfficeMemberRepositoryQueryBuilder=i},2034:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberService=void 0;const i=o(2720),n=o(4711),s=o(8164);t.OfficeMemberService=(e,t,o,c)=>({createOfficeMember:t=>r(void 0,void 0,void 0,(function*(){const{memberId:r,officeId:i}=t;yield c.checkUniqueUserInOffice(r,i);const n=yield e.save({memberId:r,officeId:i,transform:{}});return yield o.createOfficeMemberOverviewById(n.id)})),deleteOfficeMemberById:t=>r(void 0,void 0,void 0,(function*(){yield c.checkExistsOfficeMemberById(t),yield e.delete(t)})),updateOfficeMemberTransformById:(e,t)=>r(void 0,void 0,void 0,(function*(){})),findOfficeMemberOverviewById:e=>r(void 0,void 0,void 0,(function*(){return yield o.createOfficeMemberOverviewById(e)})),findOfficeMemberDetailById:e=>r(void 0,void 0,void 0,(function*(){return yield o.createOfficeMemberDetailById(e)})),findOfficeMembersDetail:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.queryBuilder().withMember().withOfficeHasCreator().withRoles().withTransform().withPageable(t).build().getMany(),r=yield e.count();return[o.map((e=>(0,s.mapOfficeMemberToOfficeMemberDetailDto)(e))),r]})),setOfficeMemberOnlineStatusById:(t,o)=>r(void 0,void 0,void 0,(function*(){if(!(yield e.findOne(t)))throw new i.NotFoundError(n.OfficeMemberErrorMessages.OFFICE_MEMBER_NOT_FOUND);yield e.setOfficeMemberOnlineStatusById(t,o)}))})},3431:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberValidate=void 0;const i=o(2720),n=o(4711);t.OfficeMemberValidate=e=>({checkExistsOfficeMemberById:t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.existsOfficeMemberById(t)))throw new i.IllegalArgumentError(n.OfficeMemberErrorMessages.OFFICE_MEMBER_NOT_FOUND)})),checkUniqueUserInOffice:(t,o)=>r(void 0,void 0,void 0,(function*(){if(yield e.existsUserInOffice(t,o))throw new i.IllegalArgumentError(n.OfficeMemberErrorMessages.USER_ALREADY_IN_OFFICE)}))})},7511:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),i(o(4718),t),i(o(6717),t)},6717:function(e,t){var o=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberSocketCacheService=void 0,t.OfficeMemberSocketCacheService=e=>{const t="office_member";return{setUserSocket:(r,i)=>o(void 0,void 0,void 0,(function*(){yield e.set(`${t}:${r}`,i)})),getUserSocket:r=>o(void 0,void 0,void 0,(function*(){return yield e.get(`${t}:${r}`)})),deleteUserSocket:r=>o(void 0,void 0,void 0,(function*(){yield e.del(`${t}:${r}`)}))}}},4718:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeMemberSocketService=void 0;const i=o(9366);t.OfficeMemberSocketService=(e,t,o,n,s)=>({onJoinToOfficeRoom:function(e){return r(this,void 0,void 0,(function*(){const{officeId:n}=e,s=t.user.id,c=yield o.queryBuilder().findByMemberIdAndOfficeId(s,n).build().getOne();if(!c)throw new Error("Office member not found");t.data.officeMember={id:c.id,memberId:c.memberId,officeId:c.officeId},t.join(`${c.officeId}`),function(e,o){r(this,void 0,void 0,(function*(){t.to(`${o}`).emit("office_member:online",e)}))}(c.memberId,n),function(e){r(this,void 0,void 0,(function*(){yield o.setOfficeMemberOnlineStatusById(e,i.OfficeMemberOnlineStatus.ONLINE)}))}(c.memberId)}))},onMemberDisconnect:function(){return r(this,void 0,void 0,(function*(){const{id:e,memberId:s}=t.data.officeMember;t.to(`${t.data.officeMember.officeId}`).emit("office_member:offline",s),function(e){r(this,void 0,void 0,(function*(){yield o.setOfficeMemberOnlineStatusById(e,i.OfficeMemberOnlineStatus.OFFLINE)}))}(e),yield n.backupTransformFromCacheById(e)}))},onMemberMove:function(e){return r(this,void 0,void 0,(function*(){t.to(`${t.data.officeMember.officeId}`).emit("office_member:moved",Object.assign({memberId:t.user.id,officeId:t.data.officeMember.officeId},e)),yield n.updateTransformInCacheById(t.data.officeMember.id,e)}))}})},1548:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRoleType=void 0,(o=t.OfficeRoleType||(t.OfficeRoleType={})).OWNER="OWNER",o.ADMIN="ADMIN",o.MEMBER="MEMBER"},1500:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRole=void 0;const n=o(5250),s=o(777);let c=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],c.prototype,"id",void 0),r([(0,n.Column)({unique:!0}),(0,n.Index)(),i("design:type",String)],c.prototype,"name",void 0),c=r([(0,n.Entity)({name:"office_role"})],c),t.OfficeRole=c},9842:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeRoleRepository=void 0;const r=o(5250),i=o(3913);t.createOfficeRoleRepository=function(){return(0,r.getCustomRepository)(i.OfficeRoleRepository)}},3913:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRoleRepository=void 0;const n=o(5250),s=o(1500),c=o(7325);let a=class extends c.BaseRepository{findOfficeRoleByName(e){return i(this,void 0,void 0,(function*(){return yield this.createQueryBuilder("office_role").where("office_role.name = :name",{name:e}).getOne()}))}};a=r([(0,n.EntityRepository)(s.OfficeRole)],a),t.OfficeRoleRepository=a},973:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateOfficeDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,n.Expose)(),(0,s.IsDefined)(),(0,s.Length)(1,255),i("design:type",String)],c.prototype,"name",void 0),t.CreateOfficeDto=c},7299:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateOfficeDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,n.Expose)(),(0,s.IsDefined)(),(0,s.Length)(1,255),i("design:type",String)],c.prototype,"name",void 0),t.UpdateOfficeDto=c},1747:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRouter=void 0;const r=o(9237);Object.defineProperty(t,"OfficeRouter",{enumerable:!0,get:function(){return r.OfficeRouter}})},9237:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRouter=void 0;const r=o(6860),i=o(6901),n=o(4903);t.OfficeRouter=()=>{const e=(0,n.createOfficeController)(),{protect:t}=(0,i.createAuthMiddleware)(),o=(0,r.Router)();return o.use(t),o.route("/:id/members").get(e.getOfficeMembersById),o.route("/:id/items").get(e.getOfficeItemsById),o.route("/:id").get(e.getOfficeDetailById).delete(e.deleteOfficeById).patch(e.updateOfficeById),o.route("/").get(e.getAllOfficesOverviewCurrentUserIsMember).post(e.createOffice).patch(e.updateOfficeById),o}},5308:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeController=void 0;const i=o(1624),n=o(7500),s=o(2720),c=o(3015),a=o(5718),d=o(973),f=o(7299);t.OfficeController=e=>({getOfficeDetailById:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,i=yield e.findOfficeDetailById(r);o.status(n.HttpStatusCode.OK).json({status:"success",office:i})})))),updateOfficeById:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,a.validateRequestBody)(f.UpdateOfficeDto,t.body);if(r.length>0)throw new s.IllegalArgumentError("Invalid update office data",r);const i=+t.params.id,c=t.body,d=yield e.updateOfficeById(i,c);o.status(n.HttpStatusCode.OK).json({status:"success",office:d})})))),deleteOfficeById:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id;yield e.deleteOfficeById(r),o.status(n.HttpStatusCode.OK).json({status:"success"})})))),getOfficeItemsById:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,i=yield e.findOfficeItemsById(r);o.status(n.HttpStatusCode.OK).json({status:"success",data:i})})))),getOfficeMembersById:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,i=yield e.findOfficeMembersById(r);o.status(n.HttpStatusCode.OK).json({status:"success",data:i})})))),getAllOfficesOverviewCurrentUserIsMember:(0,c.catchAsyncRequestHandler)(((t,o,s)=>r(void 0,void 0,void 0,(function*(){const r=(0,i.pageParser)(t.query,{defaultPage:1,defaultSize:10}),[s,c]=yield e.findAllOfficesOverviewUserIsMemberByUserId(t.user.id,r);o.status(n.HttpStatusCode.OK).json({status:"success",page:r.page,limit:r.size,total:c,offices:s})})))),createOffice:(0,c.catchAsyncRequestHandler)(((t,o,i)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,a.validateRequestBody)(d.CreateOfficeDto,t.body);if(r.length>0)throw new s.IllegalArgumentError("Invalid request body",r);const i=t.body,c=yield e.createOffice(t.user.id,i);o.status(n.HttpStatusCode.OK).json({status:"success",office:c})}))))})},3578:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeCreator=void 0;const i=o(9855);t.OfficeCreator=(e,t,o)=>({createOfficeOverviewById:t=>r(void 0,void 0,void 0,(function*(){const o=yield e.queryBuilder().findById(t).withCreator().build().getOne();return(0,i.mapOfficeToOfficeOverviewDto)(o)})),createOfficesOverviewsByIds:t=>r(void 0,void 0,void 0,(function*(){return(yield e.queryBuilder().findByIds(t).withCreator().build().getMany()).map((e=>(0,i.mapOfficeToOfficeOverviewDto)(e)))})),createOfficeDetailById:n=>r(void 0,void 0,void 0,(function*(){const r=yield e.queryBuilder().findById(n).withCreator().build().getOne(),s=yield t.queryBuilder().findByOfficeId(n).withMember().withTransform().build().getMany(),c=yield o.findOfficeItemsWithItemByOfficeId(n);return(0,i.mapOfficeToOfficeDetailDto)({office:r,officeItems:c,officeMembers:s})})),createOfficesOverview:t=>r(void 0,void 0,void 0,(function*(){return(yield e.queryBuilder().withCreator().withPageable(t).build().getMany()).map((e=>(0,i.mapOfficeToOfficeOverviewDto)(e)))}))})},4843:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.Office=void 0;const n=o(5250),s=o(777),c=o(2965),a=o(5970),d=o(4614);let f=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],f.prototype,"id",void 0),r([(0,n.Column)(),i("design:type",String)],f.prototype,"name",void 0),r([(0,n.Column)({unique:!0,name:"invitation_code"}),(0,n.Index)(),i("design:type",String)],f.prototype,"invitationCode",void 0),r([(0,n.Column)({name:"created_by_user_id"}),(0,n.Index)(),i("design:type",Number)],f.prototype,"createdByUserId",void 0),r([(0,n.OneToMany)((()=>c.OfficeItem),(e=>e.office),{cascade:!0}),i("design:type",Array)],f.prototype,"officeItems",void 0),r([(0,n.OneToMany)((()=>a.OfficeMember),(e=>e.office),{cascade:!0}),i("design:type",Array)],f.prototype,"officeMembers",void 0),r([(0,n.ManyToOne)((()=>d.User)),(0,n.JoinColumn)({name:"created_by_user_id"}),i("design:type",d.User)],f.prototype,"createdBy",void 0),f=r([(0,n.Entity)({name:"office"})],f),t.Office=f},2100:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeErrorMessages=void 0,t.OfficeErrorMessages={OFFICE_NOT_FOUND:"Office not found"}},4903:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createOfficeRepository=t.createOfficeCreator=t.createOfficeValidate=t.createOfficeGenerator=t.createOfficeService=t.createOfficeSocketHandler=t.createOfficeController=void 0;const i=o(5250),n=o(4509),s=o(4491),c=o(5308),a=o(3578),d=o(9772),f=o(7174),u=o(1241),l=o(9842),v=r(o(8293)),p=o(6456);function y(){const e=O(),t=(0,n.createOfficeItemRepository)(),o=(0,s.createOfficeMemberRepository)(),r=(0,l.createOfficeRoleRepository)(),i=h(),c=(0,s.createOfficeMemberCreator)(),a=_(),d=m();return(0,f.OfficeService)(e,t,o,r,i,c,a,d)}function m(){return v.default}function _(){const e=O();return(0,u.OfficeValidate)(e)}function h(){const e=O(),t=(0,n.createOfficeItemRepository)(),o=(0,s.createOfficeMemberRepository)();return(0,a.OfficeCreator)(e,o,t)}function O(){return(0,i.getCustomRepository)(d.OfficeRepository)}t.createOfficeController=function(){return(0,c.OfficeController)(y())},t.createOfficeSocketHandler=function(e,t){return(0,p.OfficeSocketHandler)(e,t)},t.createOfficeService=y,t.createOfficeGenerator=m,t.createOfficeValidate=_,t.createOfficeCreator=h,t.createOfficeRepository=O},9855:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapOfficeToOfficeDetailDto=t.mapOfficeToOfficeOverviewDto=void 0;const r=o(7437),i=o(8164),n=o(9857);t.mapOfficeToOfficeOverviewDto=e=>{const{id:t,createdAt:o,invitationCode:r,name:i,createdBy:s}=e;return{id:t,name:i,invitationCode:r,createdBy:(0,n.mapUserToUserOverviewDto)(s),createdAt:o}},t.mapOfficeToOfficeDetailDto=e=>{const{office:t,officeItems:o,officeMembers:s}=e,{id:c,createdAt:a,invitationCode:d,name:f,createdBy:u}=t,l=o.map((e=>(0,r.mapOfficeItemToOfficeItemOverviewDto)(e))),v=s.map((e=>(0,i.mapOfficeMemberToOfficeMemberOverviewDto)(e)));return{id:c,name:f,invitationCode:d,createdBy:(0,n.mapUserToUserOverviewDto)(u),officeItems:l,officeMembers:v,createdAt:a}}},9772:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRepository=void 0;const n=o(5250),s=o(7325),c=o(4843),a=o(1179);let d=class extends s.BaseRepository{queryBuilder(){return new a.OfficeRepositoryQueryBuilder(this)}existsOfficeByInvitationCode(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.createQueryBuilder("office").where("office.invitationCode = :invitationCode",{invitationCode:e}).getCount())}))}existsOfficeById(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.createQueryBuilder("office").where("office.id = :id",{id:e}).getCount())}))}};d=r([(0,n.EntityRepository)(c.Office)],d),t.OfficeRepository=d},1179:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeRepositoryQueryBuilder=void 0;const r=o(9456);class i extends r.RepositoryQueryBuilder{constructor(e){super(e,"office")}findById(e){return super.findById(e),this}findByIds(e){return this.query.where("office.id IN (:...ids)",{ids:e}),this}findByInvitationCode(e){return this.query.where("office.invitation_code = :invitationCode",{invitationCode:e}),this}findByCreatorId(e){return this.query.where("office.created_by_user_id = :creatorId",{creatorId:e}),this}withCreator(){return this.query.leftJoinAndSelect("office.createdBy","user"),this}withPageable(e){return super.withPageable(e),this}}t.OfficeRepositoryQueryBuilder=i},7174:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeService=void 0;const i=o(7437),n=o(1548),s=o(4843);t.OfficeService=(e,t,o,c,a,d,f,u)=>({createOffice:(t,i)=>r(void 0,void 0,void 0,(function*(){const r=u.generate(),d=yield c.findOfficeRoleByName(n.OfficeRoleType.OWNER),f=o.create({memberId:t,roles:[{officeRole:d}],transform:{}}),l=yield e.createQueryBuilder().insert().into(s.Office).values({invitationCode:r,createdByUserId:t,name:i.name,officeMembers:[f]}).execute();return yield a.createOfficeOverviewById(l.raw[0].id)})),findOfficeOverviewById:e=>r(void 0,void 0,void 0,(function*(){return yield f.checkOfficeExistsById(e),yield a.createOfficeOverviewById(e)})),findOfficeDetailById:e=>r(void 0,void 0,void 0,(function*(){return yield f.checkOfficeExistsById(e),yield a.createOfficeDetailById(e)})),findAllOfficesOverview:e=>r(void 0,void 0,void 0,(function*(){return yield a.createOfficesOverview(e)})),findAllOfficesOverviewUserIsMemberByUserId:(e,t)=>r(void 0,void 0,void 0,(function*(){const r=yield o.queryBuilder().findByMemberId(e).withPageable(t).build().getMany(),i=yield o.queryBuilder().findByMemberId(e).build().getCount();return[yield a.createOfficesOverviewsByIds(r.map((e=>e.officeId))),i]})),findOfficeItemsById:e=>r(void 0,void 0,void 0,(function*(){return yield f.checkOfficeExistsById(e),{office:yield a.createOfficeOverviewById(e),items:(yield t.findOfficeItemsWithItemByOfficeId(e)).map((e=>(0,i.mapOfficeItemToOfficeItemOverviewDto)(e)))}})),findOfficeMembersById:e=>r(void 0,void 0,void 0,(function*(){return yield f.checkOfficeExistsById(e),{office:yield a.createOfficeOverviewById(e),members:yield d.createOfficeMembersOverviewByOfficeId(e)}})),updateOfficeById:(t,o)=>r(void 0,void 0,void 0,(function*(){return yield f.checkOfficeExistsById(t),yield e.save({id:t,name:o.name}),a.createOfficeOverviewById(t)})),deleteOfficeById:t=>r(void 0,void 0,void 0,(function*(){yield f.checkOfficeExistsById(t),yield e.softDelete(t)}))})},6456:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeSocketHandler=void 0;const i=o(4491);t.OfficeSocketHandler=(e,t)=>{const o=(0,i.createOfficeMemberSocketService)(e,t);t.on("office_member:join",(e=>r(void 0,void 0,void 0,(function*(){try{yield o.onJoinToOfficeRoom(e),t.on("office_member:move",(e=>{o.onMemberMove(e)})),t.on("office_item:create",(e=>{})),t.on("office_item:move",(e=>{})),t.on("office_item:delete",(e=>{})),t.on("disconnect",(()=>{o.onMemberDisconnect()}))}catch(e){t.emit("office:error",e)}}))))}},1241:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.OfficeValidate=void 0;const i=o(2720),n=o(2100);t.OfficeValidate=e=>({checkOfficeExistsById:t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.existsOfficeById(t)))throw new i.NotFoundError(n.OfficeErrorMessages.OFFICE_NOT_FOUND)}))})},8547:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordEncoder=void 0;const i=r(o(2275)),n=o(7096);t.PasswordEncoder=()=>({encode:e=>(0,n.hashSync)(e,i.default.auth.BCRYPT_SALT_ROUNDS)})},2586:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenCreator=void 0,t.PasswordResetTokenCreator=()=>({mapPasswordResetTokenToPasswordResetTokenDto:e=>{const{id:t,userId:o,passwordResetToken:r,passwordResetTokenExpired:i,createdAt:n}=e;return{id:t,userId:o,passwordResetToken:r,passwordResetTokenExpired:i,createdAt:n}}})},3134:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetToken=void 0;const n=o(5250),s=o(777),c=o(4614);let a=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],a.prototype,"id",void 0),r([(0,n.Column)({name:"user_id"}),i("design:type",Number)],a.prototype,"userId",void 0),r([(0,n.Column)({unique:!0,name:"password_reset_token"}),i("design:type",String)],a.prototype,"passwordResetToken",void 0),r([(0,n.Column)({name:"password_reset_token_expired"}),i("design:type",Date)],a.prototype,"passwordResetTokenExpired",void 0),r([(0,n.OneToOne)((()=>c.User)),(0,n.JoinColumn)({name:"user_id"}),i("design:type",c.User)],a.prototype,"user",void 0),a=r([(0,n.Entity)({name:"password_reset_token"})],a),t.PasswordResetToken=a},2752:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenMessages=void 0,t.PasswordResetTokenMessages={TOKEN_EXPIRED:"Password reset token expired",TOKEN_INVALID:"Password reset token invalid"}},1538:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPasswordResetTokenCreator=t.createPasswordResetTokenService=t.createPasswordResetTokenRepository=void 0;const r=o(5250),i=o(2586),n=o(9070),s=o(9894);t.createPasswordResetTokenRepository=()=>(0,r.getCustomRepository)(n.PasswordResetTokenRepository),t.createPasswordResetTokenService=()=>{const e=(0,t.createPasswordResetTokenRepository)(),o=(0,t.createPasswordResetTokenCreator)();return(0,s.PasswordResetTokenService)(e,o)},t.createPasswordResetTokenCreator=()=>(0,i.PasswordResetTokenCreator)()},9070:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenRepository=void 0;const n=o(5250),s=o(7325),c=o(3134);let a=class extends s.BaseRepository{findByToken(e){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{passwordResetToken:e}})}))}deleteByUserId(e){return i(this,void 0,void 0,(function*(){yield this.softDelete({userId:e})}))}};a=r([(0,n.EntityRepository)(c.PasswordResetToken)],a),t.PasswordResetTokenRepository=a},9894:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordResetTokenService=void 0;const n=i(o(6113)),s=i(o(2275)),c=o(2720),a=o(2752);t.PasswordResetTokenService=(e,t)=>{function o(e){return n.default.createHash("sha256").update(e).digest("hex")}return{findByToken:o=>r(void 0,void 0,void 0,(function*(){const r=yield e.findByToken(o);if(!r)throw new c.NotFoundError(a.PasswordResetTokenMessages.TOKEN_INVALID);return t.mapPasswordResetTokenToPasswordResetTokenDto(r)})),createToken:i=>r(void 0,void 0,void 0,(function*(){const r=n.default.randomBytes(s.default.auth.RESET_PASSWORD_TOKEN_LENGTH).toString("hex"),c=o(r),a=yield e.save({userId:i,passwordResetToken:r,passwordResetTokenExpired:new Date(Date.now()+s.default.auth.RESET_PASSWORD_TOKEN_EXPIRES_TIME)});return t.mapPasswordResetTokenToPasswordResetTokenDto(Object.assign(Object.assign({},a),{passwordResetToken:c}))})),validateToken:t=>r(void 0,void 0,void 0,(function*(){const r=o(t),i=yield e.findByToken(r);if(!i)throw new c.IllegalArgumentError(a.PasswordResetTokenMessages.TOKEN_INVALID);if(i.passwordResetTokenExpired.getTime()<Date.now())throw new c.IllegalArgumentError(a.PasswordResetTokenMessages.TOKEN_EXPIRED);return!0})),deleteByUserId:t=>r(void 0,void 0,void 0,(function*(){yield e.softDelete(t)}))}}},4574:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenStatus=void 0,(o=t.RefreshTokenStatus||(t.RefreshTokenStatus={})).ACTIVE="active",o.BLOCKED="blocked"},3669:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshToken=void 0;const n=o(5250),s=o(4614),c=o(4574),a=o(777);let d=class extends a.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],d.prototype,"id",void 0),r([(0,n.Column)(),i("design:type",String)],d.prototype,"token",void 0),r([(0,n.Column)({name:"user_id"}),i("design:type",Number)],d.prototype,"userId",void 0),r([(0,n.Column)({type:"enum",enum:c.RefreshTokenStatus,default:c.RefreshTokenStatus.ACTIVE}),i("design:type",String)],d.prototype,"status",void 0),r([(0,n.Column)({name:"expires_at"}),i("design:type",Date)],d.prototype,"expiresAt",void 0),r([(0,n.ManyToOne)((()=>s.User)),(0,n.JoinColumn)({name:"user_id"}),i("design:type",s.User)],d.prototype,"user",void 0),d=r([(0,n.Entity)({name:"refresh_token"}),(0,n.Index)(["token","userId"],{unique:!0})],d),t.RefreshToken=d},1663:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenRepository=void 0;const n=o(5250),s=o(7325),c=o(3669),a=o(4574);let d=class extends s.BaseRepository{existsTokenByUserId(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.count({where:{userId:e}}))}))}findByTokenAndUserId(e,t){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{userId:e,token:t}})}))}findByToken(e){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{token:e}})}))}deleteByToken(e){return i(this,void 0,void 0,(function*(){yield this.softDelete({token:e})}))}blockByToken(e){return i(this,void 0,void 0,(function*(){yield this.update({token:e},{status:a.RefreshTokenStatus.BLOCKED})}))}};d=r([(0,n.EntityRepository)(c.RefreshToken)],d),t.RefreshTokenRepository=d},6237:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserLoginProvider=void 0,(o=t.UserLoginProvider||(t.UserLoginProvider={})).GOOGLE="google",o.FACEBOOK="facebook",o.LOCAL="local"},7927:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserRoleType=void 0,(o=t.UserRoleType||(t.UserRoleType={})).ADMIN="admin",o.USER="user"},6648:(e,t)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.UserStatus=void 0,(o=t.UserStatus||(t.UserStatus={})).ACTIVE="active",o.INACTIVE="inactive",o.BLOCKED="blocked"},8927:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.CreateUserDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"name",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"email",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"password",void 0),r([(0,s.IsDefined)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"passwordConfirm",void 0),t.CreateUserDto=c},4036:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateUserDto=void 0;const n=o(136),s=o(5849);class c{}r([(0,n.Expose)(),i("design:type",String)],c.prototype,"name",void 0),r([(0,s.IsPhoneNumber)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"phone",void 0),r([(0,s.IsUrl)(),(0,n.Expose)(),i("design:type",String)],c.prototype,"avatar",void 0),t.UpdateUserDto=c},6146:function(e,t,o){var r=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),i=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||r(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),i(o(7581),t)},7581:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserRouter=void 0;const r=o(6860),i=o(6901),n=o(7927),s=o(24),c=o(6586);t.UserRouter=()=>{const e=(0,r.Router)(),t=(0,i.createAuthMiddleware)(),o=(0,c.createUserService)(),a=(0,s.UserController)(o);return e.use("/",t.protect),e.route("/me/profile").get(a.getProfile).patch(a.updateProfile),e.route("/:id").all(t.restrictTo([n.UserRoleType.ADMIN])).get(a.getUserById).patch(a.updateUser).delete(a.deleteUser),e.route("/").all(t.restrictTo([n.UserRoleType.ADMIN])).post(a.createUser).get(a.getUsers),e}},24:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserController=void 0;const i=o(7500),n=o(2720),s=o(3015),c=o(5718),a=o(8927),d=o(4036);t.UserController=e=>({createUser:(0,s.catchAsyncRequestHandler)(((t,o,s)=>r(void 0,void 0,void 0,(function*(){const r=yield(0,c.validateRequestBody)(a.CreateUserDto,t.body);if(r.length>0)throw new n.IllegalArgumentError("Invalid user data",r);const s=t.body,d=yield e.createLocalUser(s);o.status(i.HttpStatusCode.CREATED).json({message:"User created successfully",user:d})})))),getProfile:(0,s.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=t.user.id,n=yield e.findUserById(r);o.status(i.HttpStatusCode.OK).json(n)})))),updateProfile:(0,s.catchAsyncRequestHandler)(((t,o,s)=>r(void 0,void 0,void 0,(function*(){const r=t.user.id,s=yield(0,c.validateRequestBody)(d.UpdateUserDto,t.body);if(s.length>0)throw new n.IllegalArgumentError("Invalid update user data",s);const a=t.body,f=yield e.updateUserById(r,a);o.status(i.HttpStatusCode.OK).json(f)})))),getUserById:(0,s.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,n=yield e.findUserById(r);o.status(i.HttpStatusCode.OK).json(n)})))),updateUser:(0,s.catchAsyncRequestHandler)(((t,o,s)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id,s=yield(0,c.validateRequestBody)(d.UpdateUserDto,t.body);if(s.length>0)throw new n.IllegalArgumentError("Invalid update user data",s);const a=t.body,f=yield e.updateUserById(r,a);o.status(i.HttpStatusCode.OK).json(f)})))),deleteUser:(0,s.catchAsyncRequestHandler)(((t,o,n)=>r(void 0,void 0,void 0,(function*(){const r=+t.params.id;yield e.deleteUserById(r),o.status(i.HttpStatusCode.OK).json({message:"User deleted successfully"})})))),getUsers:(0,s.catchAsyncRequestHandler)(((e,t,o)=>r(void 0,void 0,void 0,(function*(){}))))})},3066:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserCreator=void 0,t.UserCreator=()=>({userEntityToUserDto:e=>({id:e.id,name:e.name,email:e.email,avatar:e.avatar,phone:e.phone,status:e.status,provider:e.provider,externalId:e.externalId,createdAt:e.createdAt})})},4614:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;const n=o(5250),s=o(777),c=o(6237),a=o(7927),d=o(6648);let f=class extends s.BaseEntity{};r([(0,n.PrimaryGeneratedColumn)(),i("design:type",Number)],f.prototype,"id",void 0),r([(0,n.Column)(),i("design:type",String)],f.prototype,"name",void 0),r([(0,n.Column)(),(0,n.Index)("email_idx",{unique:!0}),i("design:type",String)],f.prototype,"email",void 0),r([(0,n.Column)({nullable:!0}),i("design:type",String)],f.prototype,"phone",void 0),r([(0,n.Column)({nullable:!0}),i("design:type",String)],f.prototype,"password",void 0),r([(0,n.Column)({nullable:!0}),i("design:type",String)],f.prototype,"avatar",void 0),r([(0,n.Column)({type:"enum",enum:c.UserLoginProvider,default:c.UserLoginProvider.LOCAL}),i("design:type",String)],f.prototype,"provider",void 0),r([(0,n.Column)({nullable:!0,name:"external_id"}),i("design:type",String)],f.prototype,"externalId",void 0),r([(0,n.Column)({type:"enum",enum:a.UserRoleType,default:a.UserRoleType.USER}),i("design:type",String)],f.prototype,"type",void 0),r([(0,n.Column)({type:"enum",enum:d.UserStatus,default:d.UserStatus.INACTIVE}),i("design:type",String)],f.prototype,"status",void 0),f=r([(0,n.Entity)({name:"user"})],f),t.User=f},2148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserErrorMessage=void 0,t.UserErrorMessage={REGISTRATION_MISMATCH_PASSWORD:"Password and confirm password do not match",REGISTRATION_EMAIL_EXISTED:"Email already exists",USER_NOT_FOUND:"User not found"}},6586:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createUserValidate=t.createUserCreator=t.createUserService=t.createUserRepository=void 0;const r=o(5250),i=o(8547),n=o(3066),s=o(7122),c=o(8111),a=o(3746);function d(){return(0,r.getCustomRepository)(s.UserRepository)}function f(){return(0,n.UserCreator)()}function u(){const e=d();return(0,a.UserValidate)(e)}t.createUserRepository=d,t.createUserService=function(){const e=d(),t=u(),o=f(),r=(0,i.PasswordEncoder)();return(0,c.UserService)(e,t,o,r)},t.createUserCreator=f,t.createUserValidate=u},9857:function(e,t){var o=this&&this.__rest||function(e,t){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(o[r[i]]=e[r[i]])}return o};Object.defineProperty(t,"__esModule",{value:!0}),t.mapUserToUserOverviewDto=t.mapUserToUserDto=void 0,t.mapUserToUserDto=e=>{const{password:t}=e;return o(e,["password"])},t.mapUserToUserOverviewDto=e=>{const{id:t,name:o,avatar:r}=e;return{id:t,name:o,avatar:r}}},7122:function(e,t,o){var r=this&&this.__decorate||function(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},i=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserRepository=void 0;const n=o(5250),s=o(4614),c=o(7325);let a=class extends c.BaseRepository{findUserByEmail(e){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{email:e}})}))}findUserByExternalId(e,t){return i(this,void 0,void 0,(function*(){return yield this.findOne({where:{externalId:e,provider:t}})}))}existsUserById(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.count({where:{id:e}}))}))}existsUserByEmail(e){return i(this,void 0,void 0,(function*(){return 1===(yield this.count({where:{email:e}}))}))}updatePasswordByUserId(e,t){return i(this,void 0,void 0,(function*(){yield this.update({id:e},{password:t})}))}};a=r([(0,n.EntityRepository)(s.User)],a),t.UserRepository=a},8111:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UserService=void 0;const n=i(o(2275)),s=o(7096),c=o(6648);t.UserService=(e,t,o,i)=>({createLocalUser:i=>r(void 0,void 0,void 0,(function*(){yield t.checkCreateUserData(i);const r=(0,s.hashSync)(i.password,n.default.auth.BCRYPT_SALT_ROUNDS),c=yield e.save(Object.assign(Object.assign({},i),{password:r}));return o.userEntityToUserDto(c)})),findOrCreateUserByExternal:t=>r(void 0,void 0,void 0,(function*(){const r=yield e.findUserByExternalId(t.externalId,t.provider);if(r)return o.userEntityToUserDto(r);const i=yield e.save(Object.assign({},t));return o.userEntityToUserDto(i)})),findUserById:i=>r(void 0,void 0,void 0,(function*(){yield t.checkUserExistsById(i);const r=yield e.findById(i);return o.userEntityToUserDto(r)})),findUserByEmail:i=>r(void 0,void 0,void 0,(function*(){yield t.checkUserExistsByEmail(i);const r=yield e.findUserByEmail(i);return o.userEntityToUserDto(r)})),updateUserById:(i,n)=>r(void 0,void 0,void 0,(function*(){yield t.checkUserExistsById(i);const r=yield e.findById(i),s=yield e.save(Object.assign(Object.assign({},r),n));return o.userEntityToUserDto(s)})),updatePasswordById:(n,s)=>r(void 0,void 0,void 0,(function*(){yield t.checkUpdatePasswordData(n,s);const r=yield e.findById(n),c=i.encode(s.password),a=yield e.save(Object.assign(Object.assign({},r),{password:c}));return o.userEntityToUserDto(a)})),deleteUserById:o=>r(void 0,void 0,void 0,(function*(){yield t.checkUserExistsById(o),yield e.softDelete(o)})),blockUserById:t=>r(void 0,void 0,void 0,(function*(){return(yield e.update(t,{status:c.UserStatus.BLOCKED})).affected||0})),activeNewUser:t=>r(void 0,void 0,void 0,(function*(){return yield e.save({id:t,status:c.UserStatus.ACTIVE})}))})},3746:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.UserValidate=void 0;const i=o(2720),n=o(2148);t.UserValidate=e=>{const t=t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.existsUserById(t)))throw new i.IllegalArgumentError(n.UserErrorMessage.USER_NOT_FOUND)})),o=(e,t)=>{if(e!==t)throw new i.IllegalArgumentError(n.UserErrorMessage.REGISTRATION_MISMATCH_PASSWORD)};return{checkCreateUserData:t=>r(void 0,void 0,void 0,(function*(){const{email:s,password:c,passwordConfirm:a}=t;yield o(c,a),yield(t=>r(void 0,void 0,void 0,(function*(){if(yield e.existsUserByEmail(t))throw new i.IllegalArgumentError(n.UserErrorMessage.REGISTRATION_EMAIL_EXISTED)})))(s)})),checkUpdatePasswordData:(e,i)=>r(void 0,void 0,void 0,(function*(){const{password:r,confirmPassword:n}=i;yield t(e),yield o(r,n)})),checkUserExistsById:t,checkUserExistsByEmail:t=>r(void 0,void 0,void 0,(function*(){if(!(yield e.existsUserByEmail(t)))throw new i.IllegalArgumentError(n.UserErrorMessage.USER_NOT_FOUND)}))}}},206:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.appConfig=void 0,r(o(5142)).default.config({path:".env"}),t.appConfig={NODE_ENV:"production",PORT:process.env.PORT||8e3,SERVER_DOMAIN:process.env.SERVER_DOMAIN,CLIENT_DOMAIN:process.env.CLIENT_DOMAIN}},747:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authConfig=void 0,r(o(5142)).default.config({path:".env"}),t.authConfig={JWT_ISSUER:"virtualspace.com",JWT_SECRET:process.env.JWT_SECRET,JWT_ACCESS_TOKEN_EXPIRES_TIME:+process.env.JWT_ACCESS_TOKEN_EXPIRES_TIME,REFRESH_TOKEN_EXPIRES_TIME:+process.env.REFRESH_TOKEN_EXPIRES_TIME,REFRESH_TOKEN_LENGTH:+process.env.REFRESH_TOKEN_LENGTH,BCRYPT_SALT_ROUNDS:12,ACTIVE_USER_TOKEN_LENGTH:+process.env.ACTIVE_USER_TOKEN_LENGTH,RESET_PASSWORD_TOKEN_LENGTH:+process.env.RESET_PASSWORD_TOKEN_LENGTH,RESET_PASSWORD_TOKEN_EXPIRES_TIME:+process.env.RESET_PASSWORD_TOKEN_EXPIRES_TIME,GOOGLE_CLIENT_ID:process.env.GOOGLE_CLIENT_ID,GOOGLE_CLIENT_SECRET:process.env.GOOGLE_CLIENT_SECRET,FACEBOOK_CLIENT_ID:process.env.FACEBOOK_CLIENT_ID,FACEBOOK_CLIENT_SECRET:process.env.FACEBOOK_CLIENT_SECRET,BASE_FRONTEND_URL:process.env.BASE_FRONTEND_URL}},7054:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cloudConfig=void 0,r(o(5142)).default.config({path:".env"}),t.cloudConfig={IMAGE_CLOUDINARY_CLOUD_NAME:process.env.IMAGE_CLOUDINARY_CLOUD_NAME,IMAGE_CLOUDINARY_API_KEY:process.env.IMAGE_CLOUDINARY_API_KEY,IMAGE_CLOUDINARY_API_SECRET:process.env.IMAGE_CLOUDINARY_API_SECRET,MODEL_AWS_BUCKET_REGION:process.env.MODEL_AWS_BUCKET_REGION,MODEL_AWS_BUCKET_NAME:process.env.MODEL_AWS_BUCKET_NAME,MODEL_AWS_BUCKET_ACCESS_KEY:process.env.MODEL_AWS_BUCKET_ACCESS_KEY,MODEL_AWS_BUCKET_SECRET_KEY:process.env.MODEL_AWS_BUCKET_SECRET_KEY}},6898:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(1721)),n=r(o(2797));t.default={mongo:i.default,pg:n.default}},1721:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(o(5142)).default.config({path:".env"});const i={DB_HOST:process.env.DB_MONGO_HOST,DB_USERNAME:process.env.DB_MONGO_USERNAME,DB_PASSWORD:process.env.DB_MONGO_PASSWORD,DB_NAME:process.env.DB_MONGO_NAME,DB_PORT:process.env.DB_MONGO_PORT?+process.env.DB_MONGO_PORT:5432};t.default=i},2797:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(o(5142)).default.config({path:".env"});const i={DB_HOST:process.env.DB_POSTGRES_HOST,DB_USERNAME:process.env.DB_POSTGRES_USERNAME,DB_PASSWORD:process.env.DB_POSTGRES_PASSWORD,DB_NAME:process.env.DB_POSTGRES_NAME,DB_PORT:process.env.DB_POSTGRES_PORT?+process.env.DB_POSTGRES_PORT:5432};t.default=i},8853:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.emailConfig=void 0,r(o(5142)).default.config({path:".env"}),t.emailConfig={EMAIL_SERVICE_NAME:process.env.EMAIL_SERVICE_NAME,EMAIL_SERVICE_HOST:process.env.EMAIL_SERVICE_HOST,EMAIL_SERVICE_PORT:+process.env.EMAIL_SERVICE_PORT,EMAIL_SERVICE_USERNAME:process.env.EMAIL_SERVICE_USERNAME,EMAIL_SERVICE_PASSWORD:process.env.EMAIL_SERVICE_PASSWORD}},2275:function(e,t,o){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=r(o(6898)),n=o(206),s=o(747),c=o(8853),a=o(7054),d={app:n.appConfig,db:i.default,auth:s.authConfig,mail:c.emailConfig,cloud:a.cloudConfig};t.default=d},6775:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderConstants=void 0,t.HeaderConstants={TOTAL_COUNT:"x-total-count",PAGE_NUMBER:"x-page-number",PAGE_SIZE:"x-page-size",REFRESH_TOKEN:"x-refresh-token",ACCESS_TOKEN:"Authorization",X_FORWARDED_FOR:"x-forwarded-for"}},7500:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HttpStatusCode=void 0;class o{}t.HttpStatusCode=o,o.OK=200,o.CREATED=201,o.BAD_REQUEST=400,o.INTERNAL_SERVER_ERROR=500,o.UNAUTHORIZED=401,o.FORBIDDEN=403,o.NOT_FOUND=404,o.TOO_MANY_REQUESTS=429},7728:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),o(3236);const n=i(o(3685)),s=i(o(6860)),c=o(206),a=o(7767),d=o(4925);r(void 0,void 0,void 0,(function*(){const e=(0,s.default)(),t=n.default.createServer(e);try{yield(0,d.mainAppLoaders)(e,a.serverLogger),(0,d.socketServerLoader)(t,a.serverLogger),(0,d.httpServerLoader)(t,c.appConfig.PORT,a.serverLogger)}catch(e){a.serverLogger.error(e)}}))},2720:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TooManyRequestError=t.UnauthorizedError=t.IllegalArgumentError=t.NotFoundError=t.AppError=void 0;const r=o(7500);class i extends Error{constructor(e,t,o){super(),this.isOperational=!0,this.status="error",this.statusCode=e,this.message=t,this.errors=o||[],Error.captureStackTrace(this,this.constructor)}}t.AppError=i,t.NotFoundError=class extends i{constructor(e){super(r.HttpStatusCode.NOT_FOUND,e)}},t.IllegalArgumentError=class extends i{constructor(e,t){super(r.HttpStatusCode.BAD_REQUEST,e,t)}},t.UnauthorizedError=class extends i{constructor(e){super(r.HttpStatusCode.UNAUTHORIZED,e)}},t.TooManyRequestError=class extends i{constructor(e){super(r.HttpStatusCode.TOO_MANY_REQUESTS,e)}}},3015:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchAsyncRequestHandler=void 0,t.catchAsyncRequestHandler=e=>(t,o,r)=>{e(t,o,r).catch((e=>r(e)))}},5021:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchAsyncSocketMiddleware=void 0,t.catchAsyncSocketMiddleware=e=>(t,o)=>{e(t,o).catch((e=>o(e)))}},1624:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pageParser=void 0,t.pageParser=(e,t)=>{const{defaultPage:o=1,defaultSize:r=10}=t,{page:i,size:n}=e;return{page:i||o,size:n||r}}},5718:function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(i,n){function s(e){try{a(r.next(e))}catch(e){n(e)}}function c(e){try{a(r.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,c)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.validateRequestBody=void 0;const i=o(136),n=o(5849);t.validateRequestBody=(e,t)=>r(void 0,void 0,void 0,(function*(){const o=(0,i.plainToInstance)(e,t),r=yield(0,n.validate)(o,{skipMissingProperties:!0}),s=[];return r.forEach((e=>{const{property:t,constraints:o}=e;if(o){const e=Object.keys(o)[0];s.push({[t]:o[e]})}})),s}))},9336:e=>{e.exports=require("aws-sdk")},7096:e=>{e.exports=require("bcrypt")},7068:e=>{e.exports=require("bull")},136:e=>{e.exports=require("class-transformer")},5849:e=>{e.exports=require("class-validator")},3518:e=>{e.exports=require("cloudinary")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},2097:e=>{e.exports=require("handlebars")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},9470:e=>{e.exports=require("morgan")},1738:e=>{e.exports=require("multer")},754:e=>{e.exports=require("nanoid")},5184:e=>{e.exports=require("nodemailer")},3511:e=>{e.exports=require("passport")},3210:e=>{e.exports=require("passport-facebook")},8117:e=>{e.exports=require("passport-google-oauth2")},9103:e=>{e.exports=require("query-string")},7558:e=>{e.exports=require("redis")},3236:e=>{e.exports=require("reflect-metadata")},3952:e=>{e.exports=require("socket.io")},4708:e=>{e.exports=require("streamifier")},5250:e=>{e.exports=require("typeorm")},5828:e=>{e.exports=require("uuid")},7773:e=>{e.exports=require("winston")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},1017:e=>{e.exports=require("path")},3837:e=>{e.exports=require("util")}},t={},o=function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,o),n.exports}(7728);module.exports=o})();